<div class="flex items-start justify-between bg-primary sidepanel-header">
    <div class="text-on-primary" style="padding-top: 6px">Forecast Edit</div>
    <div style="padding-top: 2px">
        <a (click)="projecthubservice.toggleDrawerOpen('', '',[],'', true)" href="javascript:void(0)" title="Close">
            <mat-icon class="text-on-primary" svgIcon="heroicons_outline:x"></mat-icon>
        </a>
    </div>
</div>
<div class="space-y-4" >
    <form [formGroup]="budgetForecastForm" class="grid m-2 grid-cols-3 gap-x-6 gap-y-0 w-19/20" *ngIf="mode=='Capex'">
        <div >
            <mat-label class="flex"><strong>Total Forecast Projection TFP ({{this.localCurrency.localCurrencyAbbreviation}})</strong></mat-label>
            <div class="grid grid-cols-2 divide-x-2 w-full bg-[#f1f5f9] border border-gray-300 mt-1 h-12 rounded items-center">
                <div class="pl-4" [ngStyle]="{'color': tfpColor}">
                    {{ budgetForecastForm.controls.tfpPercentage.value }}  %
                </div>
                <div class="flex justify-end" [ngStyle]="{'color': tfpColor}">
                    <div class="mr-4">
                        {{budgetForecastForm.controls.tfpValue.value}}
                    </div>
                </div>
            </div>
        </div>
        <div>
            <mat-label class="flex"><strong>Annual Forecast Performance AFP ({{this.localCurrency.localCurrencyAbbreviation}})</strong></mat-label>
            <div class="grid grid-cols-2 divide-x-2 w-full bg-[#f1f5f9] border border-gray-300 mt-1 h-12 rounded items-center">
                <div class="pl-4" [ngStyle]="{'color': afpColor}">
                    {{ budgetForecastForm.controls.afpPercentage.value }}  %
                </div>
                <div class="flex justify-end" [ngStyle]="{'color': afpColor}">
                    <div class="mr-4">
                        {{ budgetForecastForm.controls.afpValue.value }}
                    </div>
                </div>
            </div>
        </div>
        <spot-singleselect-autocomplete class="w-full" formControlName="afpDeviationCode"
                                        [label]="'AFP Deviation Code'" [placeholder]="'AFP Deviation Code'" [valuePointer]="'lookUpName'"  [Required]="false"
                                        [dropDownArray]="getAfdDeviationCodes()" [sortByType]="'custom'" [customSortPointer]="'lookUpOrder'">
        </spot-singleselect-autocomplete>
        <div>
            <mat-label class="flex"><strong>Year To Date Performance YTDP ({{this.localCurrency.localCurrencyAbbreviation}})</strong></mat-label>
            <div class="grid grid-cols-2 divide-x-2 w-full bg-[#f1f5f9] border border-gray-300 mt-1 h-12 rounded items-center">
                <div class="pl-4" [ngStyle]="{'color': ydtpColor}">
                    {{ budgetForecastForm.controls.ytdpPercentage.value }}  %
                </div>
                <div class="flex justify-end" [ngStyle]="{'color': ydtpColor}">
                    <div class="mr-4">
                        {{ budgetForecastForm.controls.ytdpValue.value }}
                    </div>
                </div>
            </div>
        </div>
        <div>
            <mat-label class="flex"><strong>Month To Date Performance MTDP ({{this.localCurrency.localCurrencyAbbreviation}})</strong></mat-label>
            <div class="grid grid-cols-2 divide-x-2 w-full bg-[#f1f5f9] border border-gray-300 mt-1 h-12 rounded items-center">
                <div class="pl-4" [ngStyle]="{'color': mdtpColor}">
                    {{ budgetForecastForm.controls.mtdpPercentage.value }}  %
                </div>
                <div class="flex justify-end" [ngStyle]="{'color': mdtpColor}">
                    <div class="mr-4">
                        {{ budgetForecastForm.controls.mtdpValue.value }}
                    </div>
                </div>
            </div>
        </div>
        <spot-singleselect-autocomplete class="w-full" formControlName="mtdpDeviationCode"
                                        [label]="'MTDP Deviation Code'" [placeholder]="'MTP Deviation Code'" [valuePointer]="'lookUpName'"  [Required]="false"
                                        [dropDownArray]="getMtdpDeviationCodes()" [sortByType]="'custom'" [customSortPointer]="'lookUpOrder'">
        </spot-singleselect-autocomplete>
    </form>
    <div class="pl-3">
        <ngx-datatable [headerHeight]="'auto'" [rowHeight]="'auto'" [scrollbarV]="false" [scrollbarH]="true"
                       columnMode="force"
                       class="material w-[93vw] font-medium text-sm whitespace-nowrap cursor-pointer"
                       [rows]="forecasts" >
            <ngx-datatable-column name="Reference" prop="active" [width]="150" [resizeable]="false"
                                  [sortable]="false" [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                    <a (click)="fTableEditRow(rowIndex)">
                        <p *ngIf="!value">&nbsp;</p>
                        <p>{{value}}</p>
                    </a>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Currency" prop="localCurrencyAbbreviation" [width]="150" [resizeable]="false"
                                  [sortable]="false" [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                    <a
                       (click)="fTableEditRow(rowIndex)">
                        <p *ngIf="!value">&nbsp;</p>
                        <p>{{value}}</p>
                    </a>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Historical" prop="historical"  [width]="150" [resizeable]="false" [headerClass]="getNgxDatatableNumberHeader"
                                  [sortable]="false" [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template >
                    <a (click)="fTableEditRow(rowIndex)" [ngClass]="'closed'">
                        <p *ngIf="!value && value!=0">&nbsp;</p>
                        <p style="text-align:right">{{value | number : fractionSize}}</p>
                    </a>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [sortable]="false" name="Apr" prop="apr"  [width]="150" [resizeable]="false" [headerClass]="getNgxDatatableNumberHeader"
                                  [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                    <a *ngIf="!fTableEditStack.includes(rowIndex) || !aprEditable" (click)="fTableEditRow(rowIndex)" [ngClass]="{'closed': aprEditable == false || row.isopen==false}">
                        <p *ngIf="!value && value!=0">&nbsp;</p>
                        <p style="text-align:right">{{value}}</p>
                    </a>
                    <form [formGroup]="forecastsForm.controls[rowIndex]" class="mt-4"
                          *ngIf="fTableEditStack.includes(rowIndex) && aprEditable">
                        <mat-form-field class="w-full px-1" [floatLabel]="'always'">
                            <input matInput formControlName="apr" type="number"  min="0" (input)="recalculateAnnualTotal()" (paste)="onPaste($event, rowIndex,'apr')" class="no-spinners"
                                   placeholder="0" pattern="\d*" />
                        </mat-form-field>
                    </form>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [sortable]="false" name="May" prop="may" [width]="150" [resizeable]="false" [headerClass]="getNgxDatatableNumberHeader"
                                  [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                    <a *ngIf="!fTableEditStack.includes(rowIndex) || !mayEditable" (click)="fTableEditRow(rowIndex)" [ngClass]="{'closed': mayEditable == false || row.isopen==false}">
                        <p *ngIf="!value && value!=0">&nbsp;</p>
                        <p style="text-align:right">{{(value ?  value : 0 ) | number : fractionSize}}</p>
                    </a>
                    <form [formGroup]="forecastsForm.controls[rowIndex]" class="mt-4"
                          *ngIf="fTableEditStack.includes(rowIndex) && mayEditable">
                        <mat-form-field class="w-full px-1" [floatLabel]="'always'">
                            <input matInput formControlName="may" type="number"  min="0"  (input)="recalculateAnnualTotal()"  (paste)="onPaste($event, rowIndex,'may')" class="no-spinners"
                                   placeholder="0" pattern="\d*" />
                        </mat-form-field>
                    </form>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [sortable]="false" name="Jun" prop="jun" [width]="150" [resizeable]="false" [headerClass]="getNgxDatatableNumberHeader"
                                  [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                    <a *ngIf="!fTableEditStack.includes(rowIndex) || !junEditable" (click)="fTableEditRow(rowIndex)" [ngClass]="{'closed': junEditable == false || row.isopen==false}">
                        <p *ngIf="!value && value!=0">&nbsp;</p>
                        <p style="text-align:right">{{(value ?  value : 0 ) | number : fractionSize}}</p>
                    </a>
                    <form [formGroup]="forecastsForm.controls[rowIndex]" class="mt-4"
                          *ngIf="fTableEditStack.includes(rowIndex) && junEditable">
                        <mat-form-field class="w-full px-1" [floatLabel]="'always'">
                            <input matInput formControlName="jun" type="number"  min="0"  (input)="recalculateAnnualTotal()"  (paste)="onPaste($event, rowIndex,'jun')" class="no-spinners"
                                   placeholder="0" pattern="\d*" />
                        </mat-form-field>
                    </form>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [sortable]="false" name="Jul" prop="jul" [width]="150" [resizeable]="false" [headerClass]="getNgxDatatableNumberHeader"
                                  [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                    <a *ngIf="!fTableEditStack.includes(rowIndex) || !julEditable" (click)="fTableEditRow(rowIndex)" [ngClass]="{'closed': julEditable == false || row.isopen==false}">
                        <p *ngIf="!value && value!=0">&nbsp;</p>
                        <p style="text-align:right">{{(value ?  value : 0 ) | number : fractionSize}}</p>
                    </a>
                    <form [formGroup]="forecastsForm.controls[rowIndex]" class="mt-4"
                          *ngIf="fTableEditStack.includes(rowIndex) && julEditable">
                        <mat-form-field class="w-full px-1" [floatLabel]="'always'">
                            <input matInput formControlName="jul" type="number"  min="0"  (input)="recalculateAnnualTotal()"  (paste)="onPaste($event, rowIndex,'jul')" class="no-spinners"
                                   placeholder="0" pattern="\d*" />
                        </mat-form-field>
                    </form>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [sortable]="false" name="Aug" prop="aug" [width]="150" [resizeable]="false" [headerClass]="getNgxDatatableNumberHeader"
                                  [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                    <a *ngIf="!fTableEditStack.includes(rowIndex) || !augEditable" (click)="fTableEditRow(rowIndex)" [ngClass]="{'closed': augEditable == false || row.isopen==false}">
                        <p *ngIf="!value && value!=0">&nbsp;</p>
                        <p style="text-align:right">{{(value ?  value : 0 ) | number : fractionSize}}</p>
                    </a>
                    <form [formGroup]="forecastsForm.controls[rowIndex]" class="mt-4"
                          *ngIf="fTableEditStack.includes(rowIndex) && augEditable">
                        <mat-form-field class="w-full px-1" [floatLabel]="'always'">
                            <input matInput formControlName="aug" type="number"  min="0"  (input)="recalculateAnnualTotal()" (paste)="onPaste($event, rowIndex,'aug')" class="no-spinners"
                                   placeholder="0" pattern="\d*" />
                        </mat-form-field>
                    </form>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [sortable]="false" name="Sep" prop="sep" [width]="150" [resizeable]="false" [headerClass]="getNgxDatatableNumberHeader"
                                  [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                    <a *ngIf="!fTableEditStack.includes(rowIndex) || !sepEditable" (click)="fTableEditRow(rowIndex)" [ngClass]="{'closed': sepEditable == false || row.isopen==false}">
                        <p *ngIf="!value && value!=0">&nbsp;</p>
                        <p style="text-align:right">{{(value ?  value : 0 ) | number : fractionSize}}</p>
                    </a>
                    <form [formGroup]="forecastsForm.controls[rowIndex]"  class="mt-4"
                          *ngIf="fTableEditStack.includes(rowIndex) && sepEditable">
                        <mat-form-field class="w-full px-1" [floatLabel]="'always'">
                            <input matInput formControlName="sep" type="number"  min="0"  (input)="recalculateAnnualTotal()"  (paste)="onPaste($event, rowIndex,'sep')" class="no-spinners"
                                   placeholder="0" pattern="\d*" />
                        </mat-form-field>
                    </form>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [sortable]="false" name="Oct" prop="oct" [width]="150" [resizeable]="false" [headerClass]="getNgxDatatableNumberHeader"
                                  [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                    <a *ngIf="!fTableEditStack.includes(rowIndex) || !octEditable" (click)="fTableEditRow(rowIndex)" [ngClass]="{'closed': octEditable == false || row.isopen==false}">
                        <p *ngIf="!value && value!=0">&nbsp;</p>
                        <p style="text-align:right">{{(value ?  value : 0 ) | number : fractionSize}}</p>
                    </a>
                    <form [formGroup]="forecastsForm.controls[rowIndex]" class="mt-4"
                          *ngIf="fTableEditStack.includes(rowIndex) && octEditable">
                        <mat-form-field class="w-full  px-1" [floatLabel]="'always'">
                            <input matInput formControlName="oct" type="number"  min="0"  (input)="recalculateAnnualTotal()"  (paste)="onPaste($event, rowIndex,'oct')" class="no-spinners"
                                   placeholder="0" pattern="\d*" />
                        </mat-form-field>
                    </form>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [sortable]="false" name="Nov" prop="nov" [width]="150" [resizeable]="false" [headerClass]="getNgxDatatableNumberHeader"
                                  [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                    <a *ngIf="!fTableEditStack.includes(rowIndex) || !novEditable" (click)="fTableEditRow(rowIndex)" [ngClass]="{'closed': novEditable == false || row.isopen==false}">
                        <p *ngIf="!value && value!=0">&nbsp;</p>
                        <p style="text-align:right">{{value}}</p>
                    </a>
                    <form [formGroup]="forecastsForm.controls[rowIndex]" class="mt-4"
                          *ngIf="fTableEditStack.includes(rowIndex) && novEditable">
                        <mat-form-field class="w-full  px-1" [floatLabel]="'always'">
                            <input matInput formControlName="nov" type="number"  min="0"  (input)="recalculateAnnualTotal()"  (paste)="onPaste($event, rowIndex,'nov')" class="no-spinners"
                                   placeholder="0" pattern="\d*" />
                        </mat-form-field>
                    </form>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [sortable]="false" name="Dec" prop="dec" [width]="150" [resizeable]="false" [headerClass]="getNgxDatatableNumberHeader"
                                  [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                    <a *ngIf="!fTableEditStack.includes(rowIndex) || !decEditable" (click)="fTableEditRow(rowIndex)" [ngClass]="{'closed': decEditable == false || row.isopen==false}">
                        <p *ngIf="!value && value!=0">&nbsp;</p>
                        <p style="text-align:right">{{(value ?  value : 0 ) | number : fractionSize}}</p>
                    </a>
                    <form [formGroup]="forecastsForm.controls[rowIndex]" class="mt-4"
                          *ngIf="fTableEditStack.includes(rowIndex) && decEditable">
                        <mat-form-field class="w-full px-1" [floatLabel]="'always'">
                            <input matInput formControlName="dec" type="number"  min="0"  (input)="recalculateAnnualTotal()"  (paste)="onPaste($event, rowIndex,'dec')" class="no-spinners"
                                   placeholder="0" pattern="\d*" />
                        </mat-form-field>
                    </form>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [sortable]="false" name="Jan" prop="jan" [width]="150" [resizeable]="false" [headerClass]="getNgxDatatableNumberHeader"
                                  [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                    <a *ngIf="!fTableEditStack.includes(rowIndex) || !janEditable" (click)="fTableEditRow(rowIndex)"  [ngClass]="{'closed': janEditable == false || row.isopen==false}">
                        <p *ngIf="!value && value!=0">&nbsp;</p>
                        <p style="text-align:right">{{(value ?  value : 0 ) | number : fractionSize}}</p>
                    </a>
                    <form [formGroup]="forecastsForm.controls[rowIndex]"  class="mt-4"
                          *ngIf="fTableEditStack.includes(rowIndex) && janEditable">
                        <mat-form-field class="w-full px-1" [floatLabel]="'always'">
                            <input matInput formControlName="jan" type="number"  min="0" (input)="recalculateAnnualTotal()"  (paste)="onPaste($event, rowIndex,'jan')" class="no-spinners"
                                   placeholder="0" pattern="\d*" />
                        </mat-form-field>
                    </form>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [sortable]="false" name="Feb" prop="feb" [width]="150" [resizeable]="false" [headerClass]="getNgxDatatableNumberHeader"
                                  [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                    <a *ngIf="!fTableEditStack.includes(rowIndex) || !febEditable" (click)="fTableEditRow(rowIndex)" [ngClass]="{'closed': febEditable == false || row.isopen==false}">
                        <p *ngIf="!value && value!=0">&nbsp;</p>
                        <p style="text-align:right">{{(value ?  value : 0 ) | number : fractionSize}}</p>
                    </a>
                    <form [formGroup]="forecastsForm.controls[rowIndex]" class="mt-4"
                          *ngIf="fTableEditStack.includes(rowIndex) && febEditable">
                        <mat-form-field class="w-full px-1" [floatLabel]="'always'">
                            <input matInput formControlName="feb" type="number"  min="0" (input)="recalculateAnnualTotal()"  (paste)="onPaste($event, rowIndex,'feb')" class="no-spinners"
                                   placeholder="0" pattern="\d*" />
                        </mat-form-field>
                    </form>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [sortable]="false" name="Mar" prop="mar" [width]="150" [resizeable]="false" [headerClass]="getNgxDatatableNumberHeader"
                                  [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                    <a *ngIf="!fTableEditStack.includes(rowIndex) || !marEditable" (click)="fTableEditRow(rowIndex)" [ngClass]="{'closed': marEditable == false || row.isopen==false}">
                        <p *ngIf="!value && value!=0">&nbsp;</p>
                        <p style="text-align:right">{{(value ?  value : 0 ) | number : fractionSize}}</p>
                    </a>
                    <form [formGroup]="forecastsForm.controls[rowIndex]" class="mt-4"
                          *ngIf="fTableEditStack.includes(rowIndex) && marEditable">
                        <mat-form-field class="w-full px-1" [floatLabel]="'always'">
                            <input matInput formControlName="mar" type="number"  min="0"  (input)="recalculateAnnualTotal()"  (paste)="onPaste($event, rowIndex,'mar')" class="no-spinners"
                                   placeholder="0" pattern="\d*" />
                        </mat-form-field>
                    </form>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [sortable]="false" name="FY2023" prop="annualTotal" [width]="150" [resizeable]="false" [headerClass]="getNgxDatatableNumberHeader"
                                  [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                    <a  (click)="fTableEditRow(rowIndex)" [ngClass]="'closed'">
                        <p *ngIf="!value && value!=0">&nbsp;</p>
                        <p style="text-align:right">{{(value ?  value : 0 ) | number : fractionSize}}</p>
                    </a>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [sortable]="false" name="FY2024" prop="y1" [width]="150" [resizeable]="false" [headerClass]="getNgxDatatableNumberHeader"
                                  [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                    <a (click)="fTableEditRow(rowIndex)" [ngClass]="'closed'">
                        <p *ngIf="!value && value!=0">&nbsp;</p>
                        <p style="text-align:right">{{(value ?  value : 0 ) | number : fractionSize}}</p>
                    </a>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [sortable]="false" name="FY2025" prop="y2" [width]="150" [resizeable]="false" [headerClass]="getNgxDatatableNumberHeader"
                                  [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template >
                    <a *ngIf="!fTableEditStack.includes(rowIndex)" (click)="fTableEditRow(rowIndex)" [ngClass]="{'closed': row.isopen==false}">
                        <p *ngIf="!value && value!=0">&nbsp;</p>
                        <p style="text-align:right">{{(value ?  value : 0 ) | number : fractionSize}}</p>
                    </a>
                    <form [formGroup]="forecastsForm.controls[rowIndex]" class="mt-4"
                          *ngIf="fTableEditStack.includes(rowIndex)">
                        <mat-form-field class="w-full px-1" [floatLabel]="'always'">
                            <input matInput formControlName="y2" type="number"  min="0"  (input)="recalculateTotalCapex()" class="no-spinners"
                                   placeholder="0" pattern="\d*" />
                        </mat-form-field>
                    </form>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [sortable]="false" name="FY2026" prop="y3" [width]="150" [resizeable]="false" [headerClass]="getNgxDatatableNumberHeader"
                                  [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                    <a *ngIf="!fTableEditStack.includes(rowIndex)" (click)="fTableEditRow(rowIndex)" [ngClass]="{'closed': row.isopen==false}">
                        <p *ngIf="!value && value!=0">&nbsp;</p>
                        <p style="text-align:right">{{(value ?  value : 0 ) | number : fractionSize}}</p>
                    </a>
                    <form [formGroup]="forecastsForm.controls[rowIndex]" class="mt-4"
                          *ngIf="fTableEditStack.includes(rowIndex)">
                        <mat-form-field class="w-full px-1" [floatLabel]="'always'">
                            <input matInput formControlName="y3" type="number"  min="0" (input)="recalculateTotalCapex()" class="no-spinners"
                                   placeholder="0" pattern="\d*" />
                        </mat-form-field>
                    </form>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [sortable]="false" name="FY2027" prop="y4" [width]="150" [resizeable]="false" [headerClass]="getNgxDatatableNumberHeader"
                                  [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                    <a *ngIf="!fTableEditStack.includes(rowIndex)" (click)="fTableEditRow(rowIndex)" [ngClass]="{'closed': row.isopen==false}">
                        <p *ngIf="!value && value!=0">&nbsp;</p>
                        <p style="text-align:right">{{(value ?  value : 0 ) | number : fractionSize}}</p>
                    </a>
                    <form [formGroup]="forecastsForm.controls[rowIndex]" class="mt-4"
                          *ngIf="fTableEditStack.includes(rowIndex)">
                        <mat-form-field class="w-full px-1" [floatLabel]="'always'">
                            <input matInput formControlName="y4" type="number"  min="0" (input)="recalculateTotalCapex()" class="no-spinners"
                                   placeholder="0" pattern="\d*" />
                        </mat-form-field>
                    </form>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [sortable]="false" name="FY2028+" prop="y5" [width]="150" [resizeable]="false" [headerClass]="getNgxDatatableNumberHeader"
                                  [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                    <a *ngIf="!fTableEditStack.includes(rowIndex)" (click)="fTableEditRow(rowIndex)" [ngClass]="{'closed': row.isopen==false}">
                        <p *ngIf="!value && value!=0">&nbsp;</p>
                        <p style="text-align:right">{{(value ?  value : 0 ) | number : fractionSize}}</p>
                    </a>
                    <form [formGroup]="forecastsForm.controls[rowIndex]" class="mt-4"
                          *ngIf="fTableEditStack.includes(rowIndex)">
                        <mat-form-field class="w-full  px-1" [floatLabel]="'always'">
                            <input matInput formControlName="y5" type="number"  min="0" (input)="recalculateTotalCapex()" class="no-spinners"
                                   placeholder="0" pattern="\d*" />
                        </mat-form-field>
                    </form>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [sortable]="false" name="TotalCapex" prop="cumulativeTotal" [width]="150" [resizeable]="false" [headerClass]="getNgxDatatableNumberHeader"
                                  [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                    <a (click)="fTableEditRow(rowIndex)" [ngClass]="'closed'">
                        <p *ngIf="!value && value!=0">&nbsp;</p>
                        <p style="text-align:right">{{(value ?  value : 0 ) | number : fractionSize}}</p>
                    </a>
                </ng-template>
            </ngx-datatable-column>
        </ngx-datatable>
    </div>
<!--    Delimiter-->
    <div class="pl-3">
        <div class="flex items-center justify-start gap-3 pt-3 pr-3 ">
            <span class="text-bg font-semibold tracking-wider text-secondary">Y1</span>
        </div>
        <ngx-datatable [headerHeight]="'auto'" [rowHeight]="'auto'" [scrollbarV]="false" [scrollbarH]="true"
                       columnMode="force"
                       class="material w-[93vw] font-medium text-sm whitespace-nowrap cursor-pointer"
                       [rows]="forecastsY1" >
            <ngx-datatable-column name="Reference" prop="active" [width]="150" [resizeable]="false"
                                  [sortable]="false" [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                    <a (click)="fy1TableEditRow(rowIndex)">
                        <p *ngIf="!value">&nbsp;</p>
                        <p>{{value}}</p>
                    </a>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column name="Currency" prop="localCurrencyAbbreviation" [width]="150" [resizeable]="false"
                                  [sortable]="false" [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                    <a
                        (click)="fy1TableEditRow(rowIndex)">
                        <p *ngIf="!value">&nbsp;</p>
                        <p>{{value}}</p>
                    </a>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [sortable]="false" name="Apr" prop="apr"  [width]="150" [resizeable]="false" [headerClass]="getNgxDatatableNumberHeader"
                                  [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                    <a *ngIf="!fy1TableEditStack.includes(rowIndex)" (click)="fy1TableEditRow(rowIndex)">
                        <p *ngIf="!value && value!=0">&nbsp;</p>
                        <p style="text-align:right">{{value ?  value : 0}}</p>
                    </a>
                    <form [formGroup]="forecastsY1Form.controls[rowIndex]"
                          *ngIf="fy1TableEditStack.includes(rowIndex)">
                        <mat-form-field class="w-full" [floatLabel]="'always'">
                            <input matInput formControlName="apr" type="number"  min="0" (input)="recalculateY1()"
                                   placeholder="0" pattern="\d*" />
                        </mat-form-field>
                    </form>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [sortable]="false" name="May" prop="may" [width]="150" [resizeable]="false" [headerClass]="getNgxDatatableNumberHeader"
                                  [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                    <a *ngIf="!fy1TableEditStack.includes(rowIndex)" (click)="fy1TableEditRow(rowIndex)">
                        <p *ngIf="!value && value!=0">&nbsp;</p>
                        <p style="text-align:right">{{value ?  value : 0}}</p>
                    </a>
                    <form [formGroup]="forecastsY1Form.controls[rowIndex]"
                          *ngIf="fy1TableEditStack.includes(rowIndex) ">
                        <mat-form-field class="w-full" [floatLabel]="'always'">
                            <input matInput formControlName="may" type="number"  min="0"  (input)="recalculateY1()"
                                   placeholder="0" pattern="\d*" />
                        </mat-form-field>
                    </form>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [sortable]="false" name="Jun" prop="jun" [width]="150" [resizeable]="false" [headerClass]="getNgxDatatableNumberHeader"
                                  [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                    <a *ngIf="!fy1TableEditStack.includes(rowIndex) " (click)="fy1TableEditRow(rowIndex)">
                        <p *ngIf="!value && value!=0">&nbsp;</p>
                        <p style="text-align:right">{{value ?  value : 0}}</p>
                    </a>
                    <form [formGroup]="forecastsY1Form.controls[rowIndex]"
                          *ngIf="fy1TableEditStack.includes(rowIndex)">
                        <mat-form-field class="w-full" [floatLabel]="'always'">
                            <input matInput formControlName="jun" type="number"  min="0"  (input)="recalculateY1()"
                                   placeholder="0" pattern="\d*" />
                        </mat-form-field>
                    </form>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [sortable]="false" name="Jul" prop="jul" [width]="150" [resizeable]="false" [headerClass]="getNgxDatatableNumberHeader"
                                  [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                    <a *ngIf="!fy1TableEditStack.includes(rowIndex)" (click)="fy1TableEditRow(rowIndex)">
                        <p *ngIf="!value && value!=0">&nbsp;</p>
                        <p style="text-align:right">{{value ?  value : 0}}</p>
                    </a>
                    <form [formGroup]="forecastsY1Form.controls[rowIndex]"
                          *ngIf="fy1TableEditStack.includes(rowIndex)">
                        <mat-form-field class="w-full" [floatLabel]="'always'">
                            <input matInput formControlName="jul" type="number"  min="0"  (input)="recalculateY1()"
                                   placeholder="0" pattern="\d*" />
                        </mat-form-field>
                    </form>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [sortable]="false" name="Aug" prop="aug" [width]="150" [resizeable]="false" [headerClass]="getNgxDatatableNumberHeader"
                                  [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                    <a *ngIf="!fy1TableEditStack.includes(rowIndex)" (click)="fy1TableEditRow(rowIndex)">
                        <p *ngIf="!value && value!=0">&nbsp;</p>
                        <p style="text-align:right">{{value ?  value : 0}}</p>
                    </a>
                    <form [formGroup]="forecastsY1Form.controls[rowIndex]"
                          *ngIf="fy1TableEditStack.includes(rowIndex)">
                        <mat-form-field class="w-full" [floatLabel]="'always'">
                            <input matInput formControlName="aug" type="number"  min="0"  (input)="recalculateY1()"
                                   placeholder="0" pattern="\d*" />
                        </mat-form-field>
                    </form>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [sortable]="false" name="Sep" prop="sep" [width]="150" [resizeable]="false" [headerClass]="getNgxDatatableNumberHeader"
                                  [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                    <a *ngIf="!fy1TableEditStack.includes(rowIndex)" (click)="fy1TableEditRow(rowIndex)">
                        <p *ngIf="!value && value!=0">&nbsp;</p>
                        <p style="text-align:right">{{value ?  value : 0}}</p>
                    </a>
                    <form [formGroup]="forecastsY1Form.controls[rowIndex]"
                          *ngIf="fy1TableEditStack.includes(rowIndex)">
                        <mat-form-field class="w-full" [floatLabel]="'always'">
                            <input matInput formControlName="sep" type="number"  min="0"  (input)="recalculateY1()"
                                   placeholder="0" pattern="\d*" />
                        </mat-form-field>
                    </form>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [sortable]="false" name="Oct" prop="oct" [width]="150" [resizeable]="false" [headerClass]="getNgxDatatableNumberHeader"
                                  [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                    <a *ngIf="!fy1TableEditStack.includes(rowIndex) " (click)="fy1TableEditRow(rowIndex)">
                        <p *ngIf="!value && value!=0">&nbsp;</p>
                        <p style="text-align:right">{{value ?  value : 0}}</p>
                    </a>
                    <form [formGroup]="forecastsY1Form.controls[rowIndex]"
                          *ngIf="fy1TableEditStack.includes(rowIndex)">
                        <mat-form-field class="w-full" [floatLabel]="'always'">
                            <input matInput formControlName="oct" type="number"  min="0"  (input)="recalculateY1()"
                                   placeholder="0" pattern="\d*" />
                        </mat-form-field>
                    </form>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [sortable]="false" name="Nov" prop="nov" [width]="150" [resizeable]="false" [headerClass]="getNgxDatatableNumberHeader"
                                  [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                    <a *ngIf="!fy1TableEditStack.includes(rowIndex) " (click)="fy1TableEditRow(rowIndex)">
                        <p *ngIf="!value && value!=0">&nbsp;</p>
                        <p style="text-align:right">{{value ?  value : 0}}</p>
                    </a>
                    <form [formGroup]="forecastsY1Form.controls[rowIndex]"
                          *ngIf="fy1TableEditStack.includes(rowIndex) ">
                        <mat-form-field class="w-full" [floatLabel]="'always'">
                            <input matInput formControlName="nov" type="number"  min="0"  (input)="recalculateY1()"
                                   placeholder="0" pattern="\d*" />
                        </mat-form-field>
                    </form>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [sortable]="false" name="Dec" prop="dec" [width]="150" [resizeable]="false" [headerClass]="getNgxDatatableNumberHeader"
                                  [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                    <a *ngIf="!fy1TableEditStack.includes(rowIndex)" (click)="fy1TableEditRow(rowIndex)">
                        <p *ngIf="!value && value!=0">&nbsp;</p>
                        <p style="text-align:right">{{value ?  value : 0}}</p>
                    </a>
                    <form [formGroup]="forecastsY1Form.controls[rowIndex]"
                          *ngIf="fy1TableEditStack.includes(rowIndex) ">
                        <mat-form-field class="w-full" [floatLabel]="'always'">
                            <input matInput formControlName="dec" type="number"  min="0"  (input)="recalculateY1()"
                                   placeholder="0" pattern="\d*" />
                        </mat-form-field>
                    </form>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [sortable]="false" name="Jan" prop="jan" [width]="150" [resizeable]="false" [headerClass]="getNgxDatatableNumberHeader"
                                  [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                    <a *ngIf="!fy1TableEditStack.includes(rowIndex)" (click)="fy1TableEditRow(rowIndex)">
                        <p *ngIf="!value && value!=0">&nbsp;</p>
                        <p style="text-align:right">{{value ?  value : 0}}</p>
                    </a>
                    <form [formGroup]="forecastsY1Form.controls[rowIndex]"
                          *ngIf="fy1TableEditStack.includes(rowIndex) ">
                        <mat-form-field class="w-full" [floatLabel]="'always'">
                            <input matInput formControlName="jan" type="number"  min="0" (input)="recalculateY1()"
                                   placeholder="0" pattern="\d*" />
                        </mat-form-field>
                    </form>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [sortable]="false" name="Feb" prop="feb" [width]="150" [resizeable]="false" [headerClass]="getNgxDatatableNumberHeader"
                                  [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                    <a *ngIf="!fy1TableEditStack.includes(rowIndex) " (click)="fy1TableEditRow(rowIndex)">
                        <p *ngIf="!value && value!=0">&nbsp;</p>
                        <p style="text-align:right">{{value ?  value : 0}}</p>
                    </a>
                    <form [formGroup]="forecastsY1Form.controls[rowIndex]"
                          *ngIf="fy1TableEditStack.includes(rowIndex) ">
                        <mat-form-field class="w-full" [floatLabel]="'always'">
                            <input matInput formControlName="feb" type="number"  min="0" (input)="recalculateY1()"
                                   placeholder="0" pattern="\d*" />
                        </mat-form-field>
                    </form>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [sortable]="false" name="Mar" prop="mar" [width]="150" [resizeable]="false" [headerClass]="getNgxDatatableNumberHeader"
                                  [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                    <a *ngIf="!fy1TableEditStack.includes(rowIndex)" (click)="fy1TableEditRow(rowIndex)">
                        <p *ngIf="!value && value!=0">&nbsp;</p>
                        <p style="text-align:right">{{value ?  value : 0}}</p>
                    </a>
                    <form [formGroup]="forecastsY1Form.controls[rowIndex]"
                          *ngIf="fy1TableEditStack.includes(rowIndex)">
                        <mat-form-field class="w-full" [floatLabel]="'always'">
                            <input matInput formControlName="mar" type="number"  min="0"  (input)="recalculateY1()"
                                   placeholder="0" pattern="\d*" />
                        </mat-form-field>
                    </form>
                </ng-template>
            </ngx-datatable-column>
        </ngx-datatable>
    </div>
    <div class="pl-3" *ngIf="mode=='Capex'">
        <ngx-datatable [headerHeight]="'auto'" [rowHeight]="'auto'" [scrollbarV]="false" [scrollbarH]="true"
                       columnMode="force"
                       class="material w-64 font-medium text-sm whitespace-nowrap cursor-pointer"
                       [rows]="csTable" >
            <ngx-datatable-column [sortable]="false" name="Commited Spend" prop="committedSpend" [width]="150" [resizeable]="false" [headerClass]="getNgxDatatableNumberHeader"
                                  [draggable]="false">
                <ng-template let-row="row" let-rowIndex="rowIndex" let-value="value" ngx-datatable-cell-template>
                    <a *ngIf="!csTableEditStack.includes(rowIndex)" (click)="csTableEditRow(rowIndex)">
                        <p *ngIf="!value && value!=0">&nbsp;</p>
                        <p style="text-align:right">{{value ?  value : 0}}</p>
                    </a>
                    <form [formGroup]="csForm.controls[rowIndex]"
                          *ngIf="csTableEditStack.includes(rowIndex)">
                        <mat-form-field class="w-full" [floatLabel]="'always'">
                            <input matInput formControlName="committedSpend" type="number"  min="0"
                                   placeholder="0" pattern="\d*" />
                        </mat-form-field>
                    </form>
                </ng-template>
            </ngx-datatable-column>
        </ngx-datatable>
    </div>
    <div class="absolute bottom-2 w-full px-3">
        <div class="pr-3 flex items-start justify-between mt-6">
            <a class="min-w-26" mat-flat-button [color]="'primary'" type="button"
               (click)="projecthubservice.toggleDrawerOpen('', '',[],'',true)">
                Cancel
            </a>
            <button class="min-w-26" mat-flat-button [color]="'primary'" (click)="submitForecasts()" type="button">
                Submit
            </button>
        </div>
    </div>
</div>
