<div class="w-full min-w-0 p-8 pt-0" *ngIf="viewContent">
    <div class="space-y-6">
        <form [formGroup]="budgetForm"  class="space-y-6">
            <div class="flex flex-col flex-auto bg-card p-6 pt-4 shadow rounded-2xl overflow-hidden">
                <div class=" pb-4 pt-0 flex items-center justify-between">
                    <div class="mr-4 text-xl font-medium tracking-tight leading-6 truncate text-primary">Budget</div>
                    <div class="flex items-start justify-between">
                        <div style="padding-right: 5px;" >
                                <button class="text-primary bg-gray-200" mat-flat-button [color]="'primary-200'"
                                        (click)="projectHubService.toggleDrawerOpen('BudgetFxRates', '', budgetPageInfo, id)">
                                    <mat-icon svgIcon="heroicons_solid:currency-dollar"></mat-icon>&nbsp; FxRates
                                </button>
                            <button class="ml-4 text-primary bg-gray-200" mat-flat-button [color]="'primary-200'" *ngIf="projectHubService.roleControllerControl.projectHub.projectBoard.riskIssuesEdit"
                                    (click)="projectHubService.toggleDrawerOpen('BudgetAssetPlacedServiceEdit', '', budgetPageInfo , id)">
                                <mat-icon svgIcon="heroicons_solid:pencil"></mat-icon>&nbsp; Edit
                            </button>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-x-6 gap-y-0 w-full">
                    <spot-input class="w-full" formControlName="parentProgram" [label]="'Parent Program'">
                    </spot-input>
                    <spot-input class="w-full" formControlName="localCurrency" [label]="'Local Currency'" [showHint]="true" [hint]="'Currency Info'">
                    </spot-input>
                    <spot-input-date class="w-full read-only" formControlName="apisdate" [label]="'Asset Placed In Service (Estimate)'" >
                    </spot-input-date>
                </div>
            </div>
            <div class="flex flex-col flex-auto bg-card p-6 pt-4 shadow rounded-2xl overflow-hidden">
                <div class="pb-4 pt-0 flex items-center justify-between">
                    <div class="mr-4 text-xl font-medium tracking-tight leading-6 truncate text-primary">Required for CAPEX Project</div>
                    <div class="flex items-start justify-between">
                        <div style="padding-right: 5px;" *ngIf ="projectHubService.roleControllerControl.projectHub.projectBoard.riskIssuesEdit">
                            <button class="ml-4 text-primary bg-gray-200" mat-flat-button [color]="'primary-200'"
                                    (click)="projectHubService.toggleDrawerOpen('BudgetRequiredForCapexEdit', '', filterCriteria , id)">
                                <mat-icon svgIcon="heroicons_solid:pencil"></mat-icon>&nbsp; Edit
                            </button>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-x-6 gap-y-0 w-full mb-4">
                    <div
                        class="flex justify-start w-full gap-3 items-center font-medium">
                        CAPEX Required
                        <mat-icon svgIcon="heroicons_outline:x-circle"
                                  *ngIf="!budgetForm.controls.capexRequired.value"></mat-icon>
                        <mat-icon class="text-green-500" svgIcon="heroicons_outline:check-circle"
                                  *ngIf="budgetForm.controls.capexRequired.value">
                        </mat-icon>
                    </div>
                    <div></div>
                    <div>
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-x-6 gap-y-0 w-full">
                    <spot-input class="w-full read-only" formControlName="budgetId" [label]="'Budget ID'">
                    </spot-input>
                    <spot-input class="w-full read-only" formControlName="gmsBudgetowner" [label]="'GMS Budget Owner'">
                    </spot-input>
                    <spot-input class="w-full read-only" formControlName="predefinedInvestmentId" [label]="'Global/Regional Predefined Investment'">
                    </spot-input>
                    <spot-input class="w-full read-only" formControlName="where" [label]="'Where'">
                    </spot-input>
                    <spot-input class="w-full read-only" formControlName="why" [label]="'Why'">
                    </spot-input>
                    <spot-input-date class="w-full read-only" formControlName="fundingApprovalNeedDate" [label]="'Funding Approval Need Date'">
                    </spot-input-date>
                </div>
            </div>
            <div class="flex flex-col flex-auto bg-card p-6 pt-4 shadow rounded-2xl overflow-hidden">
                <div class=" pb-4 pt-0 flex items-center justify-between">
                    <div class="mr-4 text-xl font-medium tracking-tight leading-6 truncate text-primary">OPEX</div>
                    <div class="flex items-start justify-between">
                        <div style="padding-right: 5px;">
                            <button class="ml-4 text-primary bg-gray-200" mat-flat-button [color]="'primary-200'"
                                    *ngIf ="projectHubService.roleControllerControl.projectHub.projectBoard.riskIssuesEdit"
                                    (click)="projectHubService.toggleDrawerOpen('BudgetOPEXEdit', '', budgetPageInfo ,'' )">
                                <mat-icon svgIcon="heroicons_solid:pencil"></mat-icon>&nbsp; Edit
                            </button>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-x-6 gap-y-0 w-full">
                    <div
                        class="flex justify-start w-full gap-3 items-center font-medium">
                        OPEX Required
                        <mat-icon svgIcon="heroicons_outline:x-circle"
                                  *ngIf="!budgetForm.controls.opexRequired.value"></mat-icon>
                        <mat-icon class="text-green-500" svgIcon="heroicons_outline:check-circle"
                                  *ngIf="budgetForm.controls.opexRequired.value">
                        </mat-icon>
                    </div>
                    <div></div>
                    <div></div>
                </div>
            </div>
            <div class="flex flex-col flex-auto bg-card p-6 pt-4 shadow rounded-2xl overflow-hidden">
                <div class="text-primary text-xl mb-4">Funding Information</div>
                <div class="grid grid-cols-3 gap-x-6 gap-y-0 w-full">
                    <spot-input class="w-full" formControlName="projectFundingStatus" [label]="'Project Funding Status'">
                    </spot-input>
                    <spot-input class="w-full" formControlName="totalApprovedCapex" [autoAddDecimal]="false" [inputType]="'Number'" [decimalCount]="0"
                                [label]="'Total Approved CAPEX (' + this.localCurrency.localCurrencyAbbreviation + ')'"
                                [hint]="'Enter the total amount or CAPEX approved at the time of Definitive Funding approval. If only Developmental Funding was approved, then enter the total CAPEX estimate endorsed at the time Developmental Funding was approved (adjust later to match total Definitive Funding approved)'">
                    </spot-input>
                    <spot-input class="w-full"  [autoAddDecimal]="false" [inputType]="'Number'" [decimalCount]="0" formControlName="totalApprovedOpex" [label]="'Total Approved OPEX (' + this.localCurrency.localCurrencyAbbreviation + ')'">
                    </spot-input>
                </div>
                <app-budget-funding-information-table [editable]="projectHubService.roleControllerControl.projectHub.projectBoard.riskIssuesEdit" [budgetInfo]="budgetPageInfo" [addButtonShow]="showAddNewButton"></app-budget-funding-information-table>
            </div>
            <div class="flex flex-col flex-auto bg-card p-6 pt-4 shadow rounded-2xl overflow-hidden">
            <div class=" pb-4 pt-0 flex items-center justify-between">
                <div class="mr-4 text-xl font-medium tracking-tight leading-6 truncate text-primary">Budget Commentary</div>
                <div class="flex items-start justify-between">
                    <div style="padding-right: 5px;">
                        <button class="ml-4 text-primary bg-gray-200" mat-flat-button [color]="'primary-200'" *ngIf ="projectHubService.roleControllerControl.projectHub.projectBoard.riskIssuesEdit"
                                (click)="projectHubService.toggleDrawerOpen('BudgetCommentaryEdit', '', budgetPageInfo ,'' )">
                            <mat-icon svgIcon="heroicons_solid:pencil"></mat-icon>&nbsp; Edit
                        </button>
                    </div>
                </div>
            </div>
            <div class="grid  gap-x-6 gap-y-0 w-full">
                <spot-textarea class="w-full read-only" formControlName="budgetCommentary"  [showLabel]="false">
                </spot-textarea>
            </div>
        </div>
        </form>
        <form [formGroup]="budgetForecastForm" class="space-y-6">
            <div [formGroup]="budgetForecastForm" >
                <h1 *ngIf="capexField; then capexTrueBlock else capexFalseBlock"></h1>
                <ng-template #capexTrueBlock>
                    <div class="flex flex-col flex-auto bg-card p-6 pt-4 shadow rounded-2xl overflow-hidden space-y-4">
                        <div class="grid grid-cols-5 gap-x-6 gap-y-0 w-full">
                            <div class="col-span-5">
                                <div class="grid grid-cols-4 gap-x-6 gap-y-0 w-full">
                                    <div><strong>Reference</strong></div>
                                    <div><strong>Period</strong></div>
                                    <div><strong>Last Submitted</strong></div>
                                    <div><strong>Submited By</strong></div>
                                    <div></div>
                                </div>
                                <div class="grid grid-cols-4 gap-x-6 gap-y-0 w-full -mt-4">
                                    <spot-input class="w-full" formControlName="referenceCurrent"  showLabel="false" >
                                    </spot-input>
                                    <spot-input class="w-full" formControlName="periodCurrent" showLabel="false">
                                    </spot-input>
                                    <spot-input-date class="w-full" formControlName="lastSubmittedCurrent" showLabel="false" >
                                    </spot-input-date>
                                    <spot-input class="w-full" formControlName="submittedByCurrent" showLabel="false">
                                    </spot-input>
                                </div>
                                <div *ngIf="preliminaryExists" class="grid grid-cols-4 gap-x-6 gap-y-0 w-full -mt-4">
                                    <spot-input class="w-full" formControlName="referencePreliminary"  showLabel="false" >
                                    </spot-input>
                                    <spot-input class="w-full" formControlName="periodPreliminary" showLabel="false">
                                    </spot-input>
                                    <spot-input-date class="w-full" formControlName="lastSubmittedPreliminary" showLabel="false" >
                                    </spot-input-date>
                                    <spot-input class="w-full" formControlName="submittedByPreliminary" showLabel="false" >
                                    </spot-input>
                                </div>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-x-6 gap-y-0 w-full">
                            <div class="mr-4 text-xl font-medium tracking-tight leading-6 truncate text-primary">CAPEX</div>
                            <div  class="flex justify-end" >
                                <button class="ml-4 text-primary bg-gray-200" mat-flat-button [color]="'primary-200'"
                                        (click)="lbePeriodCalendar()">
                                    <mat-icon svgIcon="heroicons_solid:information-circle"></mat-icon>&nbsp; LBE Period Calendar
                                </button>
                                <div *ngIf="projectHubService.projectState!='Cancelled'">
                                    <button class="ml-4 text-primary bg-gray-200" mat-flat-button [color]="'primary-200'"
                                            (click)="projectHubService.toggleDrawerOpen('BudgetForecastCapexBulkEdit', '', budgetForecasts, id, true)">
                                        <mat-icon svgIcon="heroicons_solid:pencil"></mat-icon>&nbsp; Forecast Edit
                                    </button>
                                </div>
<!--                                <button class="ml-4 text-primary bg-gray-200" mat-flat-button [color]="'primary-200'" *ngIf="projectHubService.roleControllerControl.projectHub.projectBoard.riskIssuesEdit"-->
<!--                                        (click)="projectHubService.toggleDrawerOpen('BudgetDeviationCodeEdit', '', budgetPageInfo , id)">-->
<!--                                    <mat-icon svgIcon="heroicons_solid:pencil"></mat-icon>&nbsp; Edit-->
<!--                                </button>-->
                            </div>
                        </div>
                        <div class="text-l font-medium tracking-tight leading-6 truncate text-secondary">{{headerLabel}}</div>
                        <div class="grid grid-cols-2 gap-x-6 gap-y-4 w-full">
                            <div >
                                <mat-label class="flex"><strong>Total Forecast Projection TFP ({{this.localCurrency.localCurrencyAbbreviation}})</strong></mat-label>
                                <div class="grid grid-cols-2 divide-x-2 w-full bg-[#f1f5f9] border border-gray-300 mt-1 h-12 rounded items-center">
                                    <div class="pl-4" [ngStyle]="{'color': tfpColor}">
                                        {{ budgetForecastForm.controls.tfpPercentage.value | number : fractionSize  }}  %
                                    </div>
                                    <div class="flex justify-end" [ngStyle]="{'color': tfpColor}">
                                        <div class="mr-4">
                                            {{budgetForecastForm.controls.tfpValue.value | number : fractionSize}}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <mat-label class="flex"><strong>Annual Forecast Performance AFP ({{this.localCurrency.localCurrencyAbbreviation}})</strong></mat-label>
                                <div class="grid grid-cols-2 divide-x-2 w-full bg-[#f1f5f9] border border-gray-300 mt-1 h-12 rounded items-center">
                                    <div class="pl-4" [ngStyle]="{'color': afpColor}">
                                        {{ budgetForecastForm.controls.afpPercentage.value | number : fractionSize  }}  %
                                    </div>
                                    <div class="flex justify-end" [ngStyle]="{'color': afpColor}">
                                        <div class="mr-4">
                                            {{ budgetForecastForm.controls.afpValue.value | number : fractionSize  }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <mat-label class="flex"><strong>Year To Date Performance YTDP ({{this.localCurrency.localCurrencyAbbreviation}})</strong></mat-label>
                                <div class="grid grid-cols-2 divide-x-2 w-full bg-[#f1f5f9] border border-gray-300 mt-1 h-12 rounded items-center">
                                    <div class="pl-4" [ngStyle]="{'color': ydtpColor}">
                                        {{ budgetForecastForm.controls.ytdpPercentage.value | number : fractionSize }}  %
                                    </div>
                                    <div class="flex justify-end" [ngStyle]="{'color': ydtpColor}">
                                        <div class="mr-4">
                                            {{ budgetForecastForm.controls.ytdpValue.value | number : fractionSize}}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <mat-label class="flex"><strong>Month To Date Performance MTDP ({{this.localCurrency.localCurrencyAbbreviation}})</strong></mat-label>
                                <div class="grid grid-cols-2 divide-x-2 w-full bg-[#f1f5f9] border border-gray-300 mt-1 h-12 rounded items-center">
                                    <div class="pl-4" [ngStyle]="{'color': mdtpColor}">
                                        {{ budgetForecastForm.controls.mtdpPercentage.value | number : fractionSize }}  %
                                    </div>
                                    <div class="flex justify-end" [ngStyle]="{'color': mdtpColor}">
                                        <div class="mr-4">
                                            {{ budgetForecastForm.controls.mtdpValue.value | number : fractionSize}}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <app-budget-capex-opex-table [mode]="'Capex'" [inputData]="budgetForecasts"></app-budget-capex-opex-table>
                        <div class="grid grid-cols-3 gap-x-6 gap-y-0 w-full">
                            <div>
                                <div class="grid justify-items-stretch ">
                                    <label class="justify-self-end"><strong>Committed Spend</strong></label>
                                </div>
                                <mat-form-field class=" grid w-full">
                                    <input matInput formControlName="committedSpend" [ngClass]="'text-right'">
                                </mat-form-field>
                            </div>
                            <mat-form-field  class="flex w-full" [floatLabel]="'always'">
                                <mat-label class="flex"><strong>AFP Deviation Code</strong></mat-label>
                                <div class="grid grid-cols-2 divide-x-2 w-full">
                                    <div><input  matInput formControlName="afpCodeId"></div>
                                </div>
                            </mat-form-field>
                            <mat-form-field  class="flex w-full" [floatLabel]="'always'">
                                <mat-label class="flex"><strong>MTDP Deviation Code</strong></mat-label>
                                <div class="grid grid-cols-2 divide-x-2 w-full">
                                    <div><input  matInput formControlName="mtdpCodeId"></div>
                                </div>
                            </mat-form-field>
                        </div>
                    </div>
                </ng-template>
                <ng-template #capexFalseBlock>
                    <div  class="flex flex-col flex-auto bg-card p-6 shadow rounded-2xl overflow-hidden">
                        <div class="pt-0 flex items-center justify-between">
                            <div class="mr-4 text-xl font-medium tracking-tight leading-6 truncate text-primary">CAPEX</div>
                            <div>
                                Capex Forecast Tables are displayed only when CAPEX Required is "Saved" to Yes
                            </div>
                            <div></div>
                        </div>
                    </div>
                </ng-template>
            </div>
            <div>
                <h1 *ngIf="opexField; then opexTrueBlock else opexFalseBlock"></h1>
                <ng-template #opexTrueBlock>
                    <div class="flex flex-col flex-auto bg-card p-6 pt-4 shadow rounded-2xl overflow-hidden">
                        <app-budget-capex-opex-table [mode]="'Opex'"  [inputData]="budgetForecasts"></app-budget-capex-opex-table>
<!--                        <app-budget-capex-opex-table [mode]="'Y1'" [inputData]="budgetForecastsY1Opex"></app-budget-capex-opex-table>-->
                    </div>
                </ng-template>
                <ng-template #opexFalseBlock>
                    <div  class="flex flex-col flex-auto bg-card p-6 shadow rounded-2xl overflow-hidden">
                        <div class="pt-0 flex items-center justify-between">
                            <div class="mr-4 text-xl font-medium tracking-tight leading-6 truncate text-primary">Non-FTE OPEX</div>
                            <div>
                                Opex Forecast Tables are displayed only when OPEX Required is "Saved" to Yes
                            </div>
                            <div></div>
                        </div>
                    </div>
                </ng-template>
            </div>
        </form>
    </div>
</div>
