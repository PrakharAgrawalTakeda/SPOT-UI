function ProjectCharterCtrl(n,t,i,r,u,f){function g(n){if(n=="gridCapsWaterWasteCharter"&&$("#"+n).data("kendoGrid").dataSource.data().length>=10){alert(moreThanTenRowsInGrid);return}var t=$("#"+n).data("kendoGrid"),i=t.dataSource.sort();i&&t.dataSource.sort(null);t.addRow()}function ii(){o.isEditable&&(g("gridProjectCharterKeySuccessCriteria"),g("gridProjectCharterMilestone"),g("gridProjectTeam"),g("gridProjectCharterRisk"),g("gridProjectCharterAssumption"),g("gridProjectCharterFunding1"))}function wi(n,t){n==!0?o.agileVisibleCharter=!0:confirm(agileTypeClearMessage)?(o.agileVisibleCharter=!1,o.selectedAgilePrimaryWorkstream="",o.agileSecWorkstreamIds="",o.selectedAgileWave=""):t.preventDefault()}function bi(n){$("#"+n).on("change",function(){var n=!1,t=$("#"+$(this).attr("id")).val();parseDate(t)&&(n=!0);n&&(o.pcApprovedDateError=!1);i.$digest()})}function ri(){var n,t,u;try{n=[{field:"KPIID",title:"Associated KPI",values:st,editor:ir},{field:"Metric",title:"Metric"},{field:"CurrentState",title:"Baseline"},{field:"TargetPerformance",title:"Target Performance"},{title:"Include in Charter (Max 3)",headerAttributes:{"class":"wrap-header"},template:function(n){return o.isEditable==!1?n.IncludeInCharter==!0?h(n,"IncludeInCharter")+'<input disabled="disabled" checked type="checkbox" class="successchkbx" />':h(n,"IncludeInCharter")+'<input disabled="disabled" type="checkbox" class="successchkbx" />':n.IncludeInCharter==!0?h(n,"IncludeInCharter")+'<input type="checkbox" checked class="successchkbx" />':h(n,"IncludeInCharter")+'<input type="checkbox" class="successchkbx" />'}},{hidden:!o.isEditable,command:[{name:" ",iconClass:"k-icon k-i-close",width:"10%",click:function(n){var r,t,u,s;try{confirm(gridDeleteMessage)?(n.preventDefault(),r=$(n.target).closest("tr"),t=this.dataItem(r),t.KeySuccessUniqueID!="undefined"&&t.KeySuccessUniqueID!=""&&o.deletedKeySuccessData.push({KeySuccessUniqueID:t.KeySuccessUniqueID}),u=$("#gridProjectCharterKeySuccessCriteria").data("kendoGrid"),u.removeRow(r),i.$digest()):n.preventDefault()}catch(e){hideLoading();s={method:"InitkGridProjectCharterKeySuccessCriteria_click",exceptionMessage:"message:"+e.message+" stack:"+e.stack,ErrorParameter:c};$.when(f.postDataWCFAsync("WriteErrorLog",s)).then(function(){alert(errormessage)})}}}]}];t=new kendo.data.DataSource({transport:{read:function(n){n.success(it)}},batch:!0,schema:{model:{id:"KeySuccessUniqueID",fields:{KeySuccessUniqueID:{editable:!1,nullable:!0},KPIID:{type:"string",editable:o.isEditable},Metric:{type:"string",editable:o.isEditable},CurrentState:{type:"string",editable:o.isEditable},TargetPerformance:{type:"string",editable:o.isEditable},IncludeInCharter:{type:"boolean",editable:o.isEditable}}}}});$("#gridProjectCharterKeySuccessCriteria").kendoGrid({dataSource:t,columns:n,navigatable:!0,editable:{createAt:"bottom"},dataBound:function(){$(".successchkbx").bind("change",function(n){var t=$("#gridProjectCharterKeySuccessCriteria").data("kendoGrid"),i=t.dataItem($(n.target).closest("tr")),r=n.target.closest("td");$(r).prepend("<span class='k-dirty'><\/span>");i.set("IncludeInCharter",this.checked)})}})}catch(r){hideLoading();u={method:"InitkGridProjectCharterKeySuccessCriteria",exceptionMessage:"message:"+r.message+" stack:"+r.stack,ErrorParameter:c};$.when(f.postDataWCFAsync("WriteErrorLog",u)).then(function(){alert(errormessage)})}}function ir(n,t){$('<input name="'+t.field+'"/>').appendTo(n).kendoComboBox({autoBind:!1,dataTextField:"text",dataValueField:"value",valuePrimitive:!0,dataSource:st,change:function(n){var t=n.sender;t.value()&&t.select()===-1&&t.value("")},select:function(n){var t=n.sender;t.value()&&t.select()===-1&&t.select("-1")}})}function ui(){var n,t,u;try{n=[{title:" ",width:"4%",template:function(n){return n.link==1?"<span class='k-icon k-i-link-vertical'><\/span>":n.ChildLink==1?"<span class='k-icon k-i-unlink-horizontal' style='color:blue;'><\/span>":""}},{field:"Milestone",title:"Milestone",template:function(n){return n.MilestoneType==1?(n.Milestone=n.Milestone.replace(MilestoneStartPrefix,""),n.Milestone==MilestoneExecutionInsert||n.Milestone.trim()==""?"<span class='RedQuality'><b>"+MilestoneStartPrefix+"<\/b>"+MilestoneExecutionInsert+"<\/span>":"<b>"+MilestoneStartPrefix+"<\/b>"+n.Milestone):n.MilestoneType==2?(n.Milestone=n.Milestone.replace(MilestoneEndPrefix,""),n.Milestone==MilestoneExecutionInsert||n.Milestone.trim()==""?"<span class='RedQuality'><b>"+MilestoneEndPrefix+"<\/b>"+MilestoneExecutionInsert+"<\/span>":"<b>"+MilestoneEndPrefix+"<\/b>"+n.Milestone):n.Milestone}},{field:"PlannedFinish",title:"Planned Finish (mm/dd/yyyy)",format:"{0:MM/dd/yyyy}"},{field:"FunctionGroupID",title:"Functional Owner",values:et,editor:rr},{title:"Include In Charter (Max 10)",headerAttributes:{"class":"wrap-header"},template:ki},{hidden:!o.isEditable,command:[{name:" ",iconClass:"k-icon k-i-close",width:"10%",visible:function(n){return n.MilestoneType==1?!1:n.MilestoneType==2?!1:!0},click:function(n){var r,t,u;confirm(gridDeleteMessage)?(n.preventDefault(),r=$(n.target).closest("tr"),t=this.dataItem(r),t.ScheduleUniqueID!="undefined"&&t.ScheduleUniqueID!=""&&o.deletedMilestoneData.push({ScheduleUniqueID:t.ScheduleUniqueID}),u=$("#gridProjectCharterMilestone").data("kendoGrid"),u.removeRow(r),i.$digest()):n.preventDefault()}}]}];t=new kendo.data.DataSource({transport:{read:function(n){n.success(s)}},sort:[{field:"PlannedFinish",dir:"asc"}],batch:!0,schema:{model:{id:"ScheduleUniqueID",fields:{ScheduleUniqueID:{editable:!1,nullable:!0},Milestone:{type:"string",editable:o.isEditable},PlannedFinish:{type:"date",defaultValue:null,editable:o.isEditable},FunctionGroupID:{type:"string",editable:o.isEditable},IncludeInCharter:{type:"boolean",editable:o.isEditable}}}}});$("#gridProjectCharterMilestone").kendoGrid({dataSource:t,columns:n,selectable:!0,sortable:!0,navigatable:!0,editable:{createAt:"bottom"},dataBound:function(){$(".milestoneChkbx").bind("change",function(n){var t=$("#gridProjectCharterMilestone").data("kendoGrid"),i=t.dataItem($(n.target).closest("tr"));i.set("IncludeInCharter",this.checked)})}});$("#gridProjectCharterMilestone").kendoTooltip({filter:"td:nth-child(1)",position:"absolute",width:400,show:function(){this.content.text().length>0?this.content.parent().css("visibility","visible"):this.content.parent().css("visibility","hidden")},content:function(n){var t=$("#gridProjectCharterMilestone").data("kendoGrid").dataItem(n.target.closest("tr")),i="";return IsProgram?(t.ChildLink==0&&t.LinkedProjects!=""&&(i="<div class='prgmtooltip'>"+linkedFromMilestone+t.LinkedProjects+"<\/div>"),t.ChildLink==1&&t.LinkedProjects!=""&&(i="<div class='prgmtooltip'>"+linkedToMilestone+t.LinkedProjects+"<\/div>")):t.ChildLink==1&&t.LinkedParentProjects!=""&&(i="<div class='prgmtooltip'>"+linkedToMilestone+t.LinkedParentProjects+"<\/div>"),i}}).data("kendoTooltip")}catch(r){hideLoading();u={method:"InitkGridProjectCharterMilestone",exceptionMessage:"message:"+r.message+" stack:"+r.stack,ErrorParameter:c};$.when(f.postDataWCFAsync("WriteErrorLog",u)).then(function(){alert(errormessage)})}}function rr(n,t){$('<input name="'+t.field+'"/>').appendTo(n).kendoComboBox({autoBind:!1,dataTextField:"text",dataValueField:"value",filter:"contains",valuePrimitive:!0,dataSource:et})}function fi(){var n,t,u;try{a=[];angular.forEach(k,function(n){var i,t;n.TeamMemberAdId!=null&&n.TeamMemberAdId!=""&&(i=a.filter(function(t){return t.value===n.TeamMemberAdId}),i.length==0&&(t={},t.text=n.TeamMemberName,t.value=n.TeamMemberAdId,t.UserCountry=n.UserCountry,t.UserImageUrl=n.UserImageUrl,t.UserEmailAddress=n.UserEmailAddress,t.UserDepartment=n.UserDepartment,a.push(t)))});n=[{field:"RoleID",title:"Role Name",values:ot,editor:ur,width:"20%"},{field:"TeamMemberAdId",title:"Team Member",values:a,editor:fr,template:function(n){if(n.TeamMemberAdId!=null){var t;t=a.filter(function(t){return t.value==n.TeamMemberAdId});t.length>0?n.TeamMemberName=t[0].text:(n.TeamMemberName="",n.TeamMemberAdId="")}return n.TeamMemberName},width:"35%"},{field:"TeamPermissionID",title:"Permission",values:at,width:"0%",hidden:!0},{field:"PercentTime",title:"% Time",width:"12%",attributes:{"class":"txt-float-R"},headerAttributes:{"class":"wrap-header align-right"}},{field:"Duration",title:"Duration (Months)",width:"12%",format:"{0:n0}",decimals:0,min:0,restrictDecimals:!1,attributes:{"class":"txt-float-R"},headerAttributes:{"class":"wrap-header align-right"}},{title:"Include in Charter (Max 10)",headerAttributes:{"class":"wrap-header"},template:di,width:"17%"},{hidden:!o.isEditable,command:[{name:" ",iconClass:"k-icon k-i-close",width:"5%",click:function(n){var r,t,u;confirm(gridDeleteMessage)?(n.preventDefault(),r=$(n.target).closest("tr"),t=this.dataItem(r),t.ProjectTeamUniqueID!="undefined"&&t.ProjectTeamUniqueID!=""&&o.deletedTeamsData.push({ProjectTeamUniqueID:t.ProjectTeamUniqueID}),u=$("#gridProjectTeam").data("kendoGrid"),u.removeRow(r),i.$digest()):n.preventDefault()}}]}];t=new kendo.data.DataSource({transport:{read:function(n){n.success(k)}},sort:[{field:"Role",dir:"asc"}],batch:!0,schema:{model:{id:"ProjectTeamUniqueID",fields:{ProjectTeamUniqueID:{editable:!1,nullable:!0},RoleID:{type:"string",editable:o.isEditable},Role:{type:"string",editable:o.isEditable},TeamMemberAdId:{type:"string",editable:o.isEditable},TeamMemberName:{type:"string",editable:o.isEditable},PercentTime:{type:"number",validation:{min:0,max:100,maxlength:4},editable:o.isEditable},Duration:{type:"number",validation:{min:0,maxlength:6},editable:o.isEditable},IncludeInCharter:{type:"boolean",editable:o.isEditable},TeamPermissionID:{type:"string",editable:o.isEditable}}}}});$("#gridProjectTeam").kendoGrid({dataSource:t,columns:n,selectable:!0,editable:{createAt:"bottom"},dataBound:function(){$(".teamChkbx").bind("change",function(n){var t=$("#gridProjectTeam").data("kendoGrid"),i=t.dataItem($(n.target).closest("tr"));i.set("IncludeInCharter",this.checked)})},edit:function(n){var i=this,t=n.model.RoleID,u=n.model.TeamMemberAdId,r=i.columns[n.container.index()].field;r=="RoleID"&&(t==projectmanager||t==projectSponsor)&&this.closeCell()}})}catch(r){hideLoading();u={method:"InitkGridProjectTeam",exceptionMessage:"message:"+r.message+" stack:"+r.stack,ErrorParameter:c};$.when(f.postDataWCFAsync("WriteErrorLog",u)).then(function(){alert(errormessage)})}}function ur(n,t){$('<input class="peoplePickerNoImage" name="'+t.field+'"/>').appendTo(n).kendoDropDownList({autoBind:!1,dataTextField:"text",dataValueField:"value",placeholder:"Select and/or Type to Search",valuePrimitive:!0,dataSource:ot,select:function(n){n.dataItem.isDisabled&&n.preventDefault();n.dataItem.set("isDisabled",!0)},template:"# if (isDisabled) { #<span class='k-state-disabled peoplePickerNoImage'>#: text#<\/span># } else{#<span class='peoplePickerNoImage'>#: text#<\/span>#}#"})}function fr(n,t){$('<input name="'+t.field+'" id="'+t.field+'"/>').appendTo(n).kendoComboBox({autoBind:!1,placeholder:peoplepickerPlaceholder,dataTextField:"text",dataValueField:"value",valuePrimitive:!0,minLength:3,filtering:function(n){n.preventDefault()},filter:"contains",dataSource:a,change:function(n){if(n.sender.selectedIndex!=-1){var t=a.filter(function(t){return t.value==n.sender.dataItem(n.item).value});t.length==0&&a.push({text:n.sender.dataItem(n.item).text,value:n.sender.dataItem(n.item).value,UserCountry:n.sender.dataItem(n.item).UserCountry,UserImageUrl:n.sender.dataItem(n.item).UserImageUrl,UserEmailAddress:n.sender.dataItem(n.item).UserEmailAddress,UserDepartment:n.sender.dataItem(n.item).UserDepartment})}},valueTemplate:'<span class="selected-value" style="background-image:url(#: UserImageUrl#)"><\/span><span>#: text#<\/span>',template:"<span class='k-state-default' style=background-image:url(#: UserImageUrl#)><\/span><span class='k-state-default'><h3>#: text#<\/h3># if (UserEmailAddress != null) {#<p>#: UserEmailAddress#<\/p># } if (UserDepartment != null) {# <p><span> #:UserDepartment#<\/span># }if (UserCountry != null) {# <span>#:UserCountry#<\/span><\/p># } #<\/span>"});$("#"+t.field).data("kendoComboBox").input.on("keydown",function(n){n.currentTarget.name!=null&&f.searchPeopleBulkEdit(n,n.currentTarget.name.replace("_input","")).then(function(n){var i,r;n.length>0&&(i=[],angular.copy(a,i),angular.forEach(n,function(n){var t=a.filter(function(t){return t.value===n.UserADId});t.length==0&&i.push({text:n.UserDisplayName,value:n.UserADId,UserCountry:n.UserCountry,UserImageUrl:n.UserImageUrl,UserEmailAddress:n.UserEmailAddress,UserDepartment:n.UserDepartment})}),i.reverse(),r=$("#"+t.field).data("kendoComboBox"),r.setDataSource(i),r.dataSource.read())})})}function ei(){var n,r;try{var u=[{field:"KeyAssumption",title:"Key Assumption"},{field:"AssumptionRationale",title:"Why Is This Assumption Valid?"},{title:"Include in Charter (Max 5)",headerAttributes:{"class":"wrap-header"},template:tr},{hidden:!o.isEditable,command:[{name:" ",iconClass:"k-icon k-i-close",width:"5%",click:function(n){var r,t,u;confirm(gridDeleteMessage)?(n.preventDefault(),r=$(n.target).closest("tr"),t=this.dataItem(r),t.KeyAssumptionUniqueID!="undefined"&&t.KeyAssumptionUniqueID!=""&&o.deletedAssumptionData.push({KeyAssumptionUniqueID:t.KeyAssumptionUniqueID}),u=$("#gridProjectCharterAssumption").data("kendoGrid"),u.removeRow(r),i.$digest()):n.preventDefault()}}]}],e=[{field:"RiskIssueUniqueID",title:"Id",hidden:!0},{field:"ProjectID",title:"ProjectID",editable:!1,hidden:!0},{title:" ",width:"4%",template:function(n){return IsProgram?n.link==1?"<span class='k-icon k-i-link-vertical'><\/span>":"":""}},{field:"IfHappens",title:"If This Happens",headerAttributes:{"class":"wrap-header"},width:"20%",editable:function(){return o.isEditable}},{field:"RiskIssueResult",title:"This Is The Result",headerAttributes:{"class":"wrap-header"},width:"18%",editable:function(){return o.isEditable}},{field:"Mitigation",title:"Mitigation",width:"15%",editable:function(){return o.isEditable}},{field:"RiskIssueTypeID",title:"Type",values:wt,editable:function(){return o.isEditable}},{title:"Include in Charter (Max 5)",headerAttributes:{"class":"wrap-header"},width:"12%",template:gi},{hidden:!o.isEditable,command:[{name:" ",iconClass:"k-icon k-i-close",width:"5%",click:function(n){var r,t,u;confirm(gridDeleteMessage)?(n.preventDefault(),r=$(n.target).closest("tr"),t=this.dataItem(r),t.RiskIssueUniqueID!="undefined"&&t.RiskIssueUniqueID!=""&&o.deletedRiskData.push({RiskIssueUniqueID:t.RiskIssueUniqueID}),u=$("#gridProjectCharterRisk").data("kendoGrid"),u.removeRow(r),i.$digest()):n.preventDefault()}}]}],s=new kendo.data.DataSource({transport:{read:function(n){n.success(tt)}},batch:!0,schema:{model:{id:"RiskIssueUniqueID",fields:{ProjectID:{editable:!1,hidden:!0,defaultValue:SeletedProjectId},RiskIssueUniqueID:{editable:!1,hidden:!0},IfHappens:{type:"string",editable:o.isEditable},RiskIssueResult:{type:"string",editable:o.isEditable},Mitigation:{type:"string",editable:o.isEditable},RiskIssueTypeID:{editable:o.isEditable},IncludeInCharter:{type:"boolean",editable:o.isEditable}}}}});$("#gridProjectCharterRisk").kendoGrid({dataSource:s,selectable:!0,navigatable:!0,editable:{createAt:"bottom"},columns:e,dataBound:function(){$(".riskChkbx").bind("change",function(n){var t=$("#gridProjectCharterRisk").data("kendoGrid"),i=t.dataItem($(n.target).closest("tr"));i.set("IncludeInCharter",this.checked)})}});IsProgram&&$("#gridProjectCharterRisk").kendoTooltip({filter:"td:nth-child(3)",position:"absolute",width:300,content:function(n){var t=$("#gridProjectCharterRisk").data("kendoGrid").dataItem(n.target.closest("tr"));return t.ProblemID!=null?"<div class='prgmtooltip'>"+t.ProblemID+" - "+t.ProjectName+"<\/div>":""}}).data("kendoTooltip");n=new kendo.data.DataSource({transport:{read:function(n){n.success(rt)}},batch:!0,schema:{model:{id:"KeyAssumptionUniqueID",fields:{KeyAssumptionUniqueID:{editable:!1,nullable:!0},KeyAssumption:{type:"string",editable:o.isEditable},AssumptionRationale:{type:"string",editable:o.isEditable},IncludeInCharter:{type:"boolean",editable:o.isEditable}}}}});$("#gridProjectCharterAssumption").kendoGrid({dataSource:n,columns:u,navigatable:!0,editable:{createAt:"bottom"},dataBound:function(){$(".assumptionChkbx").bind("change",function(n){var t=$("#gridProjectCharterAssumption").data("kendoGrid"),i=t.dataItem($(n.target).closest("tr"));i.set("IncludeInCharter",this.checked)})}})}catch(t){hideLoading();r={method:"InitkGridProjectCharterRisk",exceptionMessage:"message:"+t.message+" stack:"+t.stack,ErrorParameter:c};$.when(f.postDataWCFAsync("WriteErrorLog",r)).then(function(){alert(errormessage)})}}function oi(){var n,t,r;try{n=er();t=new kendo.data.DataSource({transport:{read:function(n){n.success(ut)}},batch:!0,schema:{model:{id:"FundingUniqueID",fields:{FundingUniqueID:{editable:!1,nullable:!0},FundingTypeID:{type:"string",editable:o.isEditable},FundingSourceID:{type:"string",editable:o.isEditable},FundingIntheplan:{type:"boolean",editable:o.isEditable},FundingAmount:{type:"number",validation:{min:0,maxlength:12},editable:o.isEditable},FundingNotes:{type:"string",editable:o.isEditable},IncludeInCharter:{type:"boolean",editable:o.isEditable}}}}});$("#gridProjectCharterFunding1").kendoGrid({dataSource:t,columns:n,navigatable:!0,editable:{createAt:"bottom"},dataBound:function(){$(".fundChkbx").bind("click",function(n){var t=$("#gridProjectCharterFunding1").data("kendoGrid"),i=t.dataItem($(n.target).closest("tr"));i.set("IncludeInCharter",this.checked)})}})}catch(i){hideLoading();r={method:"InitkGridProjectCharterFunding",exceptionMessage:"message:"+i.message+" stack:"+i.stack,ErrorParameter:c};$.when(f.postDataWCFAsync("WriteErrorLog",r)).then(function(){alert(errormessage)})}}function er(){return[{field:"FundingTypeID",title:"Funding Type",values:bt},{field:"FundingSourceID",title:"Funding Source",values:kt},{field:"FundingIntheplan",title:"In the Plan",values:[{text:"Yes",value:!0},{text:"No",value:!1}]},{field:"FundingAmount",title:"Amount "+o.localCurrencyAbbre,format:"{0:n0}",decimals:0,min:0,restrictDecimals:!0,attributes:{"class":"txt-float-R"},headerAttributes:{"class":"wrap-header align-right"}},{field:"FundingNotes",title:"Notes"},{field:"IncludeInCharter",title:"Include in Charter (Max 3)",headerAttributes:{"class":"wrap-header"},template:nr},{hidden:!o.isEditable,command:[{name:" ",iconClass:"k-icon k-i-close",width:"10%",click:function(n){var r,t,u;confirm(gridDeleteMessage)?(n.preventDefault(),r=$(n.target).closest("tr"),t=this.dataItem(r),t.FundingUniqueID!="undefined"&&t.FundingUniqueID!=""&&o.deletedFundingData.push({FundingUniqueID:t.FundingUniqueID}),u=$("#gridProjectCharterFunding1").data("kendoGrid"),u.removeRow(r),i.$digest()):n.preventDefault()}}]}]}function hi(){var n=new kendo.data.DataSource({transport:{read:function(n){n.success(v)}},schema:{model:{id:"EmissionSourceID",fields:{EMSourceID:{hidden:!0},EMSourceName:{type:"string",editable:!1},EMUnit:{type:"number",validation:{maxlength:10},editable:o.isEditable},UnitOfMeasure:{type:"string",editable:!1},UnitCost:{type:"number",editable:o.isEditable},EMBasisOfEstimate:{type:"string",editable:o.isEditable},EMFactorImpact:{hidden:!0}}}}});$("#gridCapsCharter").kendoGrid({dataSource:n,groupable:!1,sortable:!0,editable:o.isEditable,edit:function(n){o.projectCharterInfoSelected.startonImpact==!0&&$("#gridCapsCharter").data("kendoGrid").closeCell();var t=this,r=t.columns[n.container.index()].field;n.container.find('[name="UnitCost"]').length>0&&n.container.find('[name="UnitCost"]').data("kendoNumericTextBox").bind("change",function(){if(NullValueExist=!0,r=="UnitCost"){var n=$("#gridCapsCharter").data("kendoGrid"),u=n.dataSource.data(),t=$("#gridCapsCharter").data("kendoGrid").dataSource.data();angular.forEach(t,function(n){if(n.UnitCost!=null){NullValueExist=!1;return}});NullValueExist?(o.isUnitCost=null,o.projectCharterInfoSelected.EnergyCostImpactPerYear=0):o.isUnitCost=!0}i.$digest()})},columns:[{field:"EMSourceName",title:"Emission Source",headerAttributes:{"class":"wrap-header"},width:"8%"},{field:"EMUnit",title:"Units",editor:ci,width:"5%",format:"{0:n0}",attributes:{"class":"txt-float-R"},headerAttributes:{"class":"wrap-header align-right"},headerTemplate:'<div>Units<span title="Input gross change in emissions type here in the unit provided using whole numbers. Positive values for increase, negative values for decrease" class="k-icon k-i-question"><\/span><\/div>'},{field:"UnitOfMeasure",title:"UoM",width:"2%"},{field:"UnitCost",title:"Unit Cost",width:"4%",attributes:{"class":"txt-float-R"},headerAttributes:{"class":"wrap-header align-right"},headerTemplate:"<div>Unit Cost <span>("+o.projectCharterInfoSelected.LocalCurrencyAbbreviation+')<\/span><span title="Input the cost of each energy unit using up to 4 decimal places, positive values only." class="k-icon k-i-question"><\/span><\/div>',editor:li,format:"{0:n4}",editable:function(){return o.isUnitCost==null?!0:o.isUnitCost}},{field:"EMBasisOfEstimate",title:"Basis of Estimate",width:"13%"}]})}function ci(n,t){$('<input name="'+t.field+'" data-bind="value:'+t.field+'"/>').appendTo(n).kendoNumericTextBox({decimals:0,format:"{0:n0}",restrictDecimals:!0,max:9999999,min:-9999999})}function li(n,t){$('<input name="'+t.field+'" data-bind="value:'+t.field+'"/>').appendTo(n).kendoNumericTextBox({decimals:4,format:"{0:n4}",restrictDecimals:!0,max:9999999999,min:0})}function or(){if(o.projectCharterInfoSelected.NoCarbonImpact==!0)for(var n=0;n<v.length;n++)v[n].EMUnit=null,v[n].EMBasisOfEstimate=null,v[n].UnitCost=null,o.projectCharterInfoSelected.EnergyCostImpactPerYear=null;else angular.copy(vt,v),o.isUnitCost=beforeSaveIsUnit,o.projectCharterInfoSelected.EnergyCostImpactPerYear=beforeSaveEnergy;$("#gridCapsCharter").data("kendoGrid").dataSource.read()}function sr(){o.isUnitCost=o.projectCharterInfoSelected.EnergyCostImpactPerYear!=null&&o.projectCharterInfoSelected.EnergyCostImpactPerYear!=""?!1:null}function hr(){o.isUnitCostWWC=o.projectCharterInfoSelected.EnergyWaterImpactCostPerYear!=null&&o.projectCharterInfoSelected.EnergyWaterImpactCostPerYear!=""||o.projectCharterInfoSelected.EnergyWasteImpactCostPerYear!=null&&o.projectCharterInfoSelected.EnergyWasteImpactCostPerYear!=""?!1:null;i.$digest()}function ai(){var n=new kendo.data.DataSource({transport:{read:function(n){n.success(ft)}},sort:[{field:"WWStream",dir:"asc"},{field:"WWType",dir:"asc"},{field:"Category",dir:"asc"}],schema:{model:{id:"EMDataWWID",fields:{EMDataWWID:{hidden:!0},WWStream:{type:"string",editable:o.isEditable},EMWWUnit:{type:"number",validation:{maxlength:10},editable:o.isEditable},StandardUoM:{type:"string",editable:o.isEditable},UnitCost:{type:"number",editable:o.isEditable,defaultValue:null},WWType:{type:"string",editable:o.isEditable},Category:{type:"string",editable:o.isEditable},EMBasisOfEstimate:{type:"string",editable:o.isEditable}}}}});$("#gridCapsWaterWasteCharter").kendoGrid({dataSource:n,groupable:!1,sortable:!0,editable:{createAt:"bottom"},edit:function(n){var t=this,r=t.columns[n.container.index()].field;n.container.find('[name="UnitCost"]').length>0&&n.container.find('[name="UnitCost"]').data("kendoNumericTextBox").bind("change",function(){if(NullValueExist=!0,r=="UnitCost"){var n=$("#gridCapsWaterWasteCharter").data("kendoGrid").dataSource.data();angular.forEach(n,function(n){if(n.UnitCost!=null){NullValueExist=!1;return}});NullValueExist?(o.isUnitCostWWC=null,o.projectCharterInfoSelected.EnergyWaterImpactCostPerYear=0,o.projectCharterInfoSelected.EnergyWasteImpactCostPerYear=0):o.isUnitCostWWC=!0}i.$digest()})},columns:[{field:"WWStream",title:"Water/Waste",headerAttributes:{"class":"wrap-header"},width:"15%",editor:cr,values:lt},{field:"WWType",title:"Type",headerAttributes:{"class":"wrap-header"},width:"15%",editor:lr,values:ni},{field:"Category",title:"Category",headerAttributes:{"class":"wrap-header"},width:"15%",editor:ar,values:ti},{field:"EMWWUnit",title:"Units",editor:ci,width:"10%",format:"{0:n0}",attributes:{"class":"txt-float-R"},headerAttributes:{"class":"wrap-header align-right"},headerTemplate:'<div>Units<span title="Input gross change in emissions type here in the unit provided using whole numbers. Positive values for increase, negative values for decrease" class="k-icon k-i-question"><\/span><\/div>'},{field:"StandardUoM",title:"UoM",width:"10%"},{field:"UnitCost",title:"Unit Cost",width:"10%",attributes:{"class":"txt-float-R"},headerAttributes:{"class":"wrap-header align-right"},headerTemplate:"<div>Unit Cost <span>("+o.projectCharterInfoSelected.LocalCurrencyAbbreviation+')<\/span><span title="Input the cost of each energy unit using up to 4 decimal places, positive values only." class="k-icon k-i-question"><\/span><\/div>',editor:li,format:"{0:n4}",editable:function(){return o.isUnitCostWWC==null?!0:o.isUnitCostWWC}},{field:"EMBasisOfEstimate",title:"Basis of Estimate",width:"20%"},{hidden:!o.isEditable,width:"5%",command:[{name:" ",iconClass:"k-icon k-i-close",click:function(n){var r,t,u,o;try{confirm(gridDeleteMessage)?(n.preventDefault(),r=$(n.target).closest("tr"),t=this.dataItem(r),t.EMDataWWID!="undefined"&&t.EMDataWWID!=""&&si.push({EMDataWWID:t.EMDataWWID}),u=$("#gridCapsWaterWasteCharter").data("kendoGrid"),u.removeRow(r),i.$digest()):n.preventDefault()}catch(e){hideLoading();o={method:"InitKendoGridCapsWaterWasteCharter",exceptionMessage:"message:"+e.message+" stack:"+e.stack,ErrorParameter:c};$.when(f.postDataWCFAsync("WriteErrorLog",o)).then(function(){alert(errormessage)})}}}]}]})}function cr(n,t){$('<input id="'+t.field+t.model.EMDataWWID+'" name="'+t.field+'"/>').appendTo(n).kendoComboBox({autoBind:!1,filter:"contains",valuePrimitive:!0,dataSource:lt,change:function(n){var i=n.sender.element.closest(".k-grid").data("kendoGrid"),r=n.sender.element.closest("tr"),t=i.dataItem(r),u=y.filter(function(n){return n.WWStream==t.WWStream});t.Category="";t.WWType="";t.StandardUoM=u[0].StandardUoM;t.dirty=!0;$("#gridCapsWaterWasteCharter").data("kendoGrid").refresh()}})}function lr(n,t){var i=t.model.WWStream,r=y.filter(function(n){return n.WWStream==i}),u=Array.from(new Set(r.map(n=>n.WWType)));$('<input  id="'+t.field+t.model.EMDataWWID+'"name="'+t.field+'"/>').appendTo(n).kendoComboBox({autoBind:!1,filter:"contains",valuePrimitive:!0,dataSource:u,change:function(n){var i=n.sender.element.closest(".k-grid").data("kendoGrid"),r=n.sender.element.closest("tr"),t=i.dataItem(r);t.Category="";t.dirty=!0;$("#gridCapsWaterWasteCharter").data("kendoGrid").refresh()}})}function ar(n,t){var i=t.model.WWStream,r=t.model.WWType,u=y.filter(function(n){return n.WWStream==i&&n.WWType==r});$('<input  id="'+t.field+t.model.EMDataWWID+'" name="'+t.field+'"/>').appendTo(n).kendoComboBox({autoBind:!1,dataTextField:"Category",dataValueField:"WWSourceMasterUniqueID",template:"#:Category#",filter:"contains",valuePrimitive:!0,dataSource:u,change:function(n){var i=n.sender.element.closest(".k-grid").data("kendoGrid"),r=n.sender.element.closest("tr"),t=i.dataItem(r);t.WWSourceMasterUniqueID=n.sender.value();t.Category=n.sender.text()}})}function vr(){var n,r,u,h;o.deletedMilestoneData=[];o.deletedRiskData=[];o.deletedKeySuccessData=[];o.deletedAssumptionData=[];o.deletedTeamsData=[];o.deletedFundingData=[];o.pcApprovedDateError=!1;o.isPortfolioOwnerEditablePC=canPortfolioOwnerEdit;o.CharterRealizationDateCaps=!1;o.isEMPortfolio=!1;n={ProjectID:SeletedProjectId,DataType:"TemplateDetails"};r={ProjectID:SeletedProjectId,DataType:"Template"};try{SeletedProjectId=getParameterByName(window.location.search,"ProblemID");u=product+","+portfolioOwner+","+CapitalProjectClassification+","+topsFunctionRequired+","+riskIssueType+","+businessCaseFundingType+","+funtionalGroup+","+executionScope+","+teamPermission+","+topsPrimaryKpi+","+agileAttribute+","+agileWave;$.when(f.postDataWCFAsync("getLookupData",u),f.getDataWCFAsync("getRiskIssue/"+SeletedProjectId),f.getDataWCFAsync("getProjectTeam/"+SeletedProjectId),f.getDataWCFAsync("getSchedule/"+SeletedProjectId),f.postDataWCFAsync("getProjectCharterKeySuccess",SeletedProjectId),f.postDataWCFAsync("getProjectCharterFunding",SeletedProjectId),f.postDataWCFAsync("getProjectCharterInfoByID",SeletedProjectId),f.postDataWCFAsync("getProjectCharterAssumption",SeletedProjectId),f.getDataWCFAsync("getUserPermissionByProjectUserId/"+currentUserId+"/"+SeletedProjectId),f.postDataWCFAsync("getProjectCapsDetails",SeletedProjectId),f.postDataWCFAsync("getMilestoneSetProjectHub",r),f.postDataWCFAsync("getMilestoneSetProjectHub",n),f.postDataWCFAsync("getCAPSWaterWasteByProjectID",SeletedProjectId),f.postDataWCFAsync("getCAPSWaterWaste")).then(function(n,r,u,e,h,l,a,d,g,ct,pt,dt,gt,si){var ki,ir,rr,ur,fr,er,or,sr,li,vi,wi,di,gi,ar,vr,yr,pr,nr,bi,ci,wr,tr,br,gr,nu,dr;try{for(o.dsPermission=JSON.parse(g.getUserPermissionByProjectUserIdResult),o.isEditable=o.dsPermission[0].canEdit==!0?!0:!1,o.dsPrimaryProduct=JSON.parse(n.getLookupDataResult).filter(function(n){return n.LookUpName===product}),o.dsOwner=JSON.parse(n.getLookupDataResult).filter(function(n){return n.LookUpName===portfolioOwner}),o.dsExecutionScope=t("orderBy")(JSON.parse(n.getLookupDataResult).filter(function(n){return n.LookUpName==executionScope}),"LookUpMemberOrder"),o.dsProjectClassification=JSON.parse(n.getLookupDataResult).filter(function(n){return n.LookUpName===CapitalProjectClassification}),o.dsAgilePrimaryWorkstation=JSON.parse(n.getLookupDataResult).filter(function(n){return n.LookUpName==agileAttribute}),o.dsAgileWave=JSON.parse(n.getLookupDataResult).filter(function(n){return n.LookUpName==agileWave}),o.dsPrimaryKPI=t("orderBy")(JSON.parse(n.getLookupDataResult).filter(function(n){return n.LookUpName==topsPrimaryKpi}),"LookUpMemberOrder"),o.functionRequired=JSON.parse(n.getLookupDataResult).filter(function(n){return n.LookUpName===topsFunctionRequired}),o.dsProjectClassification=t("orderBy")(o.dsProjectClassification,"LookUpMemberOrder"),o.dsPrimaryProduct=t("orderBy")(o.dsPrimaryProduct,"LookUpMemberOrder"),o.dsFundingType=JSON.parse(n.getLookupDataResult).filter(function(n){return n.LookUpName===businessCaseFundingType}),ki=JSON.parse(a.getProjectCharterInfoByIDResult),ki.length>0&&(o.projectCharterInfoSelected=ki[0]),o.localCurrencyAbbrePlaceholder=o.projectCharterInfoSelected.LocalCurrencyAbbreviation,o.projectCharterInfoSelected.LocalCurrencyAbbreviation!=null&&(o.localCurrencyAbbre="("+o.projectCharterInfoSelected.LocalCurrencyAbbreviation+")"),ir=o.projectCharterInfoSelected.ParentProgramName,rr=o.projectCharterInfoSelected.ParentProgramID,yi(rr,ir),o.projectCharterInfoSelected.PrimaryProductID!=null&&o.projectCharterInfoSelected.PrimaryProductID!=""&&(ur=o.dsPrimaryProduct.filter(function(n){return n.LookUpMemberID==o.projectCharterInfoSelected.PrimaryProductID}),o.projectCharterInfoSelected.PrimaryProductID=ur[0]),o.projectCharterInfoSelected.PortfolioOwnerID!=null&&o.projectCharterInfoSelected.PortfolioOwnerID!=""&&(fr=o.dsOwner.filter(function(n){return n.LookUpMemberID==o.projectCharterInfoSelected.PortfolioOwnerID}),o.projectCharterInfoSelected.PortfolioOwnerID=fr[0]),o.projectCharterInfoSelected.GovernanceBodyTypeID!=null&&o.projectCharterInfoSelected.GovernanceBodyTypeID!=""&&(er=o.dsOwner.filter(function(n){return n.LookUpMemberID==o.projectCharterInfoSelected.GovernanceBodyTypeID}),o.projectCharterInfoSelected.GovernanceBodyTypeID=er[0]),o.projectCharterInfoSelected.FunctionsRequiredID!=null&&o.projectCharterInfoSelected.FunctionsRequiredID!=""&&(or=o.functionRequired.filter(function(n){return n.LookUpMemberID==o.projectCharterInfoSelected.FunctionsRequiredID}),o.projectCharterInfoSelected.FunctionsRequiredID=or[0]),o.projectCharterInfoSelected.PrimaryKPI!=null&&o.projectCharterInfoSelected.PrimaryKPI!=""&&(sr=t("orderBy")(o.dsPrimaryKPI.filter(function(n){return n.LookUpMemberID==o.projectCharterInfoSelected.PrimaryKPI}),"LookUpMemberOrder"),o.projectCharterInfoSelected.PrimaryKPI=sr[0]),li=[],o.projectCharterInfoSelected.AgilePrimaryWorkstream!=null&&o.projectCharterInfoSelected.AgilePrimaryWorkstream!=""&&(li=o.dsAgilePrimaryWorkstation.filter(function(n){return n.LookUpMemberID==o.projectCharterInfoSelected.AgilePrimaryWorkstream})),o.selectedAgilePrimaryWorkstream=li.length>0?li[0]:"",vi=[],o.projectCharterInfoSelected.AgileWave!=null&&o.projectCharterInfoSelected.AgileWave!=""&&(vi=o.dsAgileWave.filter(function(n){return n.LookUpMemberID==o.projectCharterInfoSelected.AgileWave})),o.selectedAgileWave=vi.length>0?vi[0]:"",wi=JSON.parse(n.getLookupDataResult).filter(function(n){return n.LookUpName===teamPermission&&n.LookUpMemberName!="None"}),ci=0;ci<wi.length;ci++)bi={text:wi[ci].LookUpMemberName,value:wi[ci].LookUpMemberID},at.push(bi);tt=JSON.parse(r.getRiskIssueResult);k=JSON.parse(u.getProjectTeamResult);s=JSON.parse(e.getScheduleResult);it=JSON.parse(h.getProjectCharterKeySuccessResult);rt=JSON.parse(d.getProjectCharterAssumptionResult);ut=JSON.parse(l.getProjectCharterFundingResult);p=JSON.parse(pt);nt=JSON.parse(dt);o.riskIssueType=JSON.parse(n.getLookupDataResult).filter(function(n){return n.LookUpName===riskIssueType});o.dsFuntionalGroup=JSON.parse(n.getLookupDataResult).filter(function(n){return n.LookUpName===funtionalGroup});o.agileVisibleCharter=o.projectCharterInfoSelected.IsAgile;var hr=[],cr=[],lr=[];if(o.projectCharterInfoSelected.OtherImpactedProducts!=null&&o.projectCharterInfoSelected.OtherImpactedProducts!="undefined"&&(hr=o.projectCharterInfoSelected.OtherImpactedProducts.split(",")),o.projectCharterInfoSelected.ExecutionScopeID!=null&&o.projectCharterInfoSelected.ExecutionScopeID!="undefined"&&(cr=o.projectCharterInfoSelected.ExecutionScopeID.split(",")),o.dsImpactedProducts={placeholder:"Select and/or Type to Search",dataTextField:"LookUpMemberName",dataValueField:"LookUpMemberID",valuePrimitive:!0,autoBind:!1,dataSource:o.dsPrimaryProduct,filter:"contains"},o.projectCharterInfoSelected.OtherImpactedProducts=hr,o.dsExecutionScope={placeholder:"Select scope...",dataTextField:"LookUpMemberName",dataValueField:"LookUpMemberID",valuePrimitive:!0,autoBind:!1,dataSource:o.dsExecutionScope,filter:"contains"},o.projectCharterInfoSelected.ExecutionScope=cr,o.projectCharterInfoSelected.AgileSecondaryWorkstream!=null&&o.projectCharterInfoSelected.AgileSecondaryWorkstream!="undefined"&&(lr=o.projectCharterInfoSelected.AgileSecondaryWorkstream.split(",")),o.dsAgileSecWorkstream={placeholder:"Select secondary workstream...",dataTextField:"LookUpMemberName",dataValueField:"LookUpMemberID",valuePrimitive:!0,autoBind:!1,dataSource:o.dsAgilePrimaryWorkstation,filter:"contains"},o.agileSecWorkstreamIds=lr,di=$("#ddl_PC_PrimaryProduct").data("kendoComboBox"),di.value(o.SelectedProject.PrimaryProductID),di.refresh(),gi=$("#ddl_PC_PortfolioOwner").data("kendoComboBox"),gi.value(o.SelectedProject.PortfolioOwnerID),gi.refresh(),b={},angular.copy(o.projectCharterInfoSelected,b),o.formattedCalculated=kendo.toString(o.projectCharterInfoSelected.CalculatedEmissionsImpact,"n1"),ft=JSON.parse(gt.getCAPSWaterWasteByProjectIDResult),y=JSON.parse(si.getCAPSWaterWasteResult),lt=Array.from(new Set(y.map(n=>n.WWStream))),ni=Array.from(new Set(y.map(n=>n.WWType))),ti=Array.from(new Set(y.map(n=>n.Category))),o.isUnitCostWWC=o.projectCharterInfoSelected.isUnitCostWWC,ht==0){for(ci=0;ci<o.riskIssueType.length;ci++)ar={text:o.riskIssueType[ci].LookUpMemberName,value:o.riskIssueType[ci].LookUpMemberID},wt.push(ar);for(ci=0;ci<o.dsFundingType.length;ci++)vr={text:o.dsFundingType[ci].LookUpMemberName,value:o.dsFundingType[ci].LookUpMemberID},bt.push(vr);for(ci=0;ci<o.dsOwner.length;ci++)yr={text:o.dsOwner[ci].LookUpMemberName,value:o.dsOwner[ci].LookUpMemberID},kt.push(yr);for(ci=0;ci<o.dsFuntionalGroup.length;ci++)pr={text:o.dsFuntionalGroup[ci].LookUpMemberName,value:o.dsFuntionalGroup[ci].LookUpMemberID},et.push(pr);for(ci=0;ci<o.dsFuntionalGroup.length;ci++)nr=!1,(o.dsFuntionalGroup[ci].LookUpMemberID==projectmanager||o.dsFuntionalGroup[ci].LookUpMemberID==projectSponsor)&&(nr=!0),bi={text:o.dsFuntionalGroup[ci].LookUpMemberName,value:o.dsFuntionalGroup[ci].LookUpMemberID,isDisabled:nr},ot.push(bi);for(ci=0;ci<o.dsPrimaryKPI.length;ci++)wr={text:o.dsPrimaryKPI[ci].LookUpMemberName,value:o.dsPrimaryKPI[ci].LookUpMemberID},st.push(wr);ri();ui();fi();ei();oi();pi();ai()}else yt(),$("#gridProjectCharterKeySuccessCriteria").data("kendoGrid").dataSource.read(),$("#gridProjectCharterMilestone").data("kendoGrid").dataSource.read(),$("#gridProjectTeam").data("kendoGrid").dataSource.read(),$("#gridProjectCharterRisk").data("kendoGrid").dataSource.read(),$("#gridProjectCharterAssumption").data("kendoGrid").dataSource.read(),$("#gridProjectCharterFunding1").data("kendoGrid").dataSource.read(),$("#gridCapsWaterWasteCharter").data("kendoGrid").dataSource.read(),tr=new kendo.data.DataSource({data:p}),br=$("#gridCharterAddMilestones").data("kendoGrid"),tr.read(),br.setDataSource(tr);gr=o.projectCharterInfoSelected.isUnitCost;o.isUnitCost=o.projectCharterInfoSelected.isUnitCost;nu=[];o.isEMPortfolio=o.projectCharterInfoSelected.EmissionPortfolioID!=null&&o.projectCharterInfoSelected.EmissionPortfolioID!=""?!0:!1;w=JSON.parse(ct.getProjectCapsDetailsResult);v=w.filter(function(n){return n.EMPortfolioOwnerID==o.projectCharterInfoSelected.EmissionPortfolioID});angular.copy(v,vt);beforeSaveIsUnit=o.isUnitCost;beforeSaveEnergy=o.projectCharterInfoSelected.EnergyCostImpactPerYear;o.formattedCalculated=kendo.toString(o.projectCharterInfoSelected.CalculatedEmissionsImpact,"n1");hi();bindChangeComboBox("functionRequired");ii();i.$digest();hideLoading();ht++}catch(kr){hideLoading();dr={method:"prepareDataForProjectCharter",exceptionMessage:"message:"+kr.message+" stack:"+kr.stack,ErrorParameter:c};$.when(f.postDataWCFAsync("WriteErrorLog",dr)).then(function(){alert(errormessage)})}})}catch(e){hideLoading();h={method:"prepareDataForProjectCharter",exceptionMessage:"message:"+e.message+" stack:"+e.stack,ErrorParameter:c};$.when(f.postDataWCFAsync("WriteErrorLog",h)).then(function(){alert(errormessage)})}}function yr(n){vi();var t=$("#gridProjectCharterMilestone").data("kendoGrid").dataSource.data().filter(function(n){return n.dirty}).map(function(n){return n}),i=$("#gridProjectCharterRisk").data("kendoGrid").dataSource.data().filter(function(n){return n.dirty}).map(function(n){return n}),r=$("#gridProjectTeam").data("kendoGrid").dataSource.data().filter(function(n){return n.dirty}).map(function(n){return n}),u=$("#gridProjectCharterKeySuccessCriteria").data("kendoGrid").dataSource.data().filter(function(n){return n.dirty}).map(function(n){return n}),f=$("#gridProjectCharterAssumption").data("kendoGrid").dataSource.data().filter(function(n){return n.dirty}).map(function(n){return n}),e=$("#gridProjectCharterFunding1").data("kendoGrid").dataSource.data().filter(function(n){return n.dirty}).map(function(n){return n}),s=$("#gridCapsCharter").data("kendoGrid").dataSource.data().filter(function(n){return n.dirty}).map(function(n){return n});(angular.equals(b,o.projectCharterInfoSelected)==!1||t.length>0||i.length>0||r.length>0||u.length>0||f.length>0||e.length>0||s.length>0)&&(confirm(dialogCloseMessage)||n.preventDefault())}function vi(){o.projectCharterInfoSelected.OtherImpactedProducts!=null&&o.projectCharterInfoSelected.OtherImpactedProducts!=""&&(o.projectCharterInfoSelected.OtherImpactedProducts=o.projectCharterInfoSelected.OtherImpactedProducts.lemgth>1?o.projectCharterInfoSelected.OtherImpactedProducts.split(","):o.projectCharterInfoSelected.OtherImpactedProducts);$("#pc_parentProject").data("kendoComboBox").select()===-1?(o.SelectedParentProject=null,$("#pc_parentProject").data("kendoComboBox").value(""),o.projectCharterInfoSelected.ParentProgramID=null,o.projectCharterInfoSelected.ParentProgramName=null):(o.projectCharterInfoSelected.ParentProgramID=$("#pc_parentProject").data("kendoComboBox").text()===""?null:$("#pc_parentProject").data("kendoComboBox").value(),o.projectCharterInfoSelected.ParentProgramName=$("#pc_parentProject").data("kendoComboBox").text()===""?null:$("#pc_parentProject").data("kendoComboBox").text());gt&&n.$emit("UpdateAssociatedProject")}function pr(n){trackEvent(n)}function wr(){var n,i;trackEvent("Project charter dialog opened");try{displayLoading();bi("PC_approvedDate");bindChangeComboBox("ddl_PC_PrimaryProduct");bindChangeComboBox("ddl_PC_PortfolioOwner");bindChangeComboBox("pc_governanceBody");bindChangeComboBox("ddl_Primary_KPI_Charter");bindChangeComboBox("ddl_Impacted_KPI");bindChangeComboBox("charterPrimaryWorkstation");bindChangeComboBox("agileSecondaryWorkstream");bindChangeComboBox("agileWaveCharter");pt==!1&&($("#dialogProjectCharter").data("kendoWindow").bind("close",function(n){yr(n)}),pt=!0);n=$("#dialogProjectCharter");IsProgram?dr():vr();n.data("kendoWindow").open()}catch(t){hideLoading();i={method:"openProjectCharterInfo",exceptionMessage:"message:"+t.message+" stack:"+t.stack,ErrorParameter:c};$.when(f.postDataWCFAsync("WriteErrorLog",i)).then(function(){alert(errormessage)})}}function br(){var u,ri,t,e,tt,it,rt,ut,ft,et,vt,yt,pt,wt,s,h,ni,ii;try{displayLoading();var v=[],y=[],p=[],w=[],k=[],g=[],nt=[];if(o.milestoneInsertListItems=[],o.milestoneUpdateListItems=[],o.riskInsertListItems=[],o.riskUpdateListItems=[],o.teamsInsertListItems=[],o.teamsUpdateListItems=[],o.keySuccessInsertListItems=[],o.keySuccessUpdateListItems=[],o.assumptionInsertListItems=[],o.assumptionUpdateListItems=[],o.fundindInsertListItems=[],o.fundindUpdateListItems=[],u=[],o.SelectedParentProject==null&&o.projectCharterInfoSelected.ParentProgramID!=null?gt=!0:o.projectCharterInfoSelected!=null&&o.projectCharterInfoSelected!=undefined&&o.SelectedParentProject!=null&&o.projectCharterInfoSelected.ParentProgramID!=o.SelectedParentProject.ProblemUniqueID&&(gt=!0),ri=$("#pc_parentProject").data("kendoComboBox"),$("#pc_parentProject").data("kendoComboBox").select()===-1&&(o.SelectedParentProject=null,$("#pc_parentProject").data("kendoComboBox").value("")),t=!0,e=o.projectCharterInfoSelected.ApprovedDate!=null&&o.projectCharterInfoSelected.ApprovedDate!=""?$("#PC_approvedDate").val():null,e!=null&&(parseDate(e)?o.pcApprovedDateError=!1:(t=!1,o.pcApprovedDateError=!0)),!t){hideLoading();return}if(tt=$("#gridProjectCharterKeySuccessCriteria").data("kendoGrid").tbody.find("input:checked").length,tt>keySuccessCharterCount)return alert(keySuccessCountMessage),hideLoading(),!1;if(it=$("#gridProjectCharterMilestone").data("kendoGrid").tbody.find("input:checked").length,it>milestoneCharterCount)return alert(milestoneCountMessage),hideLoading(),!1;if(rt=$("#gridProjectTeam").data("kendoGrid").tbody.find("input:checked").length,rt>teamCharterCount)return alert(teamCountMessage),hideLoading(),!1;if(ut=$("#gridProjectCharterRisk").data("kendoGrid").tbody.find("input:checked").length,ut>riskCharterCount)return alert(riskCountMessage),hideLoading(),!1;if(ft=$("#gridProjectCharterAssumption").data("kendoGrid").tbody.find("input:checked").length,ft>assumptionCharterCount)return alert(assumptionCountMessage),hideLoading(),!1;if(et=$("#gridProjectCharterFunding1").data("kendoGrid").tbody.find("input:checked").length,et>fundingCharterCount)return alert(fundingCountMessage),hideLoading(),!1;if($("#gridProjectCharterMilestone").data("kendoGrid")!=undefined){var r=$("#gridProjectCharterMilestone").data("kendoGrid").dataSource.data().filter(function(n){return n.dirty}).map(function(n){return n}),ui=r.filter(function(n){return n.id==""||n.id==null}).map(function(n){return n}),fi=r.filter(function(n){return n.id!=""&&n.id!=null}).map(function(n){return n});angular.forEach(ui,function(n){var t={};t.ScheduleUniqueID=n.ScheduleUniqueID;t.Milestone=n.Milestone;t.PlannedFinish=kendo.toString(n.PlannedFinish,"d");t.FunctionGroupID=n.FunctionGroupID;t.IncludeInCharter=n.IncludeInCharter;t.ProjectID=n.ProjectID;o.milestoneInsertListItems.push(t)});angular.forEach(fi,function(n){var t={};t.ScheduleUniqueID=n.ScheduleUniqueID;t.Milestone=n.Milestone;t.Milestone=n.MilestoneType==1?MilestoneStartPrefix+n.Milestone:n.MilestoneType==2?MilestoneEndPrefix+n.Milestone:n.Milestone;t.PlannedFinish=kendo.toString(n.PlannedFinish,"d");t.FunctionGroupID=n.FunctionGroupID;t.IncludeInCharter=n.IncludeInCharter;t.ProjectID=n.ProjectID;t.link=n.link;l.length>0&&(t.MilestoneTemplateID=n.MilestoneTemplateID,t.MilestoneID=n.MilestoneID,t.Comments=n.Comments);o.milestoneUpdateListItems.push(t)})}if(o.insertUpdateDeleteMilestone={insert:o.milestoneInsertListItems,update:o.milestoneUpdateListItems,"delete":o.deletedMilestoneData},$("#gridProjectCharterRisk").data("kendoGrid")!=undefined){var ot=$("#gridProjectCharterRisk").data("kendoGrid").dataSource.data().filter(function(n){return n.dirty}).map(function(n){return n}),ei=ot.filter(function(n){return n.id==""||n.id==null}).map(function(n){return n}),oi=ot.filter(function(n){return n.id!=""&&n.id!=null}).map(function(n){return n});angular.forEach(ei,function(n){var t={};t.RiskIssueUniqueID=n.RiskIssueUniqueID;t.IfHappens=n.IfHappens;t.RiskIssueResult=n.RiskIssueResult;t.Mitigation=n.Mitigation;t.RiskIssueTypeID=n.RiskIssueTypeID;t.IncludeInCharter=n.IncludeInCharter;t.ProjectID=n.ProjectID;o.riskInsertListItems.push(t)});angular.forEach(oi,function(n){var t={};t.RiskIssueUniqueID=n.RiskIssueUniqueID;t.IfHappens=n.IfHappens;t.RiskIssueResult=n.RiskIssueResult;t.Mitigation=n.Mitigation;t.RiskIssueTypeID=n.RiskIssueTypeID;t.IncludeInCharter=n.IncludeInCharter;t.ProjectID=n.ProjectID;t.link=n.link;o.riskUpdateListItems.push(t)})}if(o.insertUpdateDeleteRisk={insert:o.riskInsertListItems,update:o.riskUpdateListItems,"delete":o.deletedRiskData},$("#gridProjectTeam").data("kendoGrid")!=undefined){var st=$("#gridProjectTeam").data("kendoGrid").dataSource.data().filter(function(n){return n.dirty}).map(function(n){return n}),hi=st.filter(function(n){return n.id==""||n.id==null}).map(function(n){return n}),ci=st.filter(function(n){return n.id!=""&&n.id!=null}).map(function(n){return n});angular.forEach(hi,function(n){var t={},i;t.ProjectTeamUniqueID=n.ProjectTeamUniqueID;t.RoleID=n.RoleID;t.TeamMemberAdId=n.TeamMemberAdId;t.PercentTime=n.PercentTime;t.Duration=n.Duration;t.IncludeInCharter=n.IncludeInCharter;t.TeamPermissionID=n.TeamPermissionID!=null?n.TeamPermissionID:null;n.TeamMemberAdId!=null&&(i=a.filter(function(t){return t.value==n.TeamMemberAdId}),t.TeamMemberName=i.length>0?i[0].text:null);o.teamsInsertListItems.push(t)});angular.forEach(ci,function(n){var t={},i;t.ProjectTeamUniqueID=n.ProjectTeamUniqueID;t.RoleID=n.RoleID;t.TeamMemberAdId=n.TeamMemberAdId;t.PercentTime=n.PercentTime;t.Duration=n.Duration;t.IncludeInCharter=n.IncludeInCharter;t.TeamPermissionID=n.TeamPermissionID!=null?n.TeamPermissionID:null;n.TeamMemberAdId!=null&&(i=a.filter(function(t){return t.value==n.TeamMemberAdId}),t.TeamMemberName=i.length>0?i[0].text:null);o.teamsUpdateListItems.push(t)})}if(o.insertUpdateDeleteTeams={insert:o.teamsInsertListItems,update:o.teamsUpdateListItems,"delete":o.deletedTeamsData},$("#gridProjectCharterKeySuccessCriteria").data("kendoGrid")!=undefined){var ht=$("#gridProjectCharterKeySuccessCriteria").data("kendoGrid").dataSource.data().filter(function(n){return n.dirty}).map(function(n){return n}),li=ht.filter(function(n){return n.id==""||n.id==null}).map(function(n){return n}),ai=ht.filter(function(n){return n.id!=""&&n.id!=null}).map(function(n){return n});angular.forEach(li,function(n){var t={};t.KeySuccessUniqueID=n.KeySuccessUniqueID;t.KPIID=n.KPIID;t.Metric=n.Metric;t.CurrentState=n.CurrentState;t.TargetPerformance=n.TargetPerformance;t.IncludeInCharter=n.IncludeInCharter;o.keySuccessInsertListItems.push(t)});angular.forEach(ai,function(n){var t={};t.KeySuccessUniqueID=n.KeySuccessUniqueID;t.KPIID=n.KPIID;t.Metric=n.Metric;t.CurrentState=n.CurrentState;t.TargetPerformance=n.TargetPerformance;t.IncludeInCharter=n.IncludeInCharter;o.keySuccessUpdateListItems.push(t)})}if(o.insertUpdateDeleteKeySuccess={insert:o.keySuccessInsertListItems,update:o.keySuccessUpdateListItems,"delete":o.deletedKeySuccessData},$("#gridProjectCharterAssumption").data("kendoGrid")!=undefined){var ct=$("#gridProjectCharterAssumption").data("kendoGrid").dataSource.data().filter(function(n){return n.dirty}).map(function(n){return n}),yi=ct.filter(function(n){return n.id==""||n.id==null}).map(function(n){return n}),pi=ct.filter(function(n){return n.id!=""&&n.id!=null}).map(function(n){return n});angular.forEach(yi,function(n){var t={};t.KeyAssumptionUniqueID=n.KeyAssumptionUniqueID;t.KeyAssumption=n.KeyAssumption;t.AssumptionRationale=n.AssumptionRationale;t.IncludeInCharter=n.IncludeInCharter;o.assumptionInsertListItems.push(t)});angular.forEach(pi,function(n){var t={};t.KeyAssumptionUniqueID=n.KeyAssumptionUniqueID;t.KeyAssumption=n.KeyAssumption;t.AssumptionRationale=n.AssumptionRationale;t.IncludeInCharter=n.IncludeInCharter;o.assumptionUpdateListItems.push(t)})}if(o.insertUpdateDeleteAssumption={insert:o.assumptionInsertListItems,update:o.assumptionUpdateListItems,"delete":o.deletedAssumptionData},$("#gridProjectCharterFunding1").data("kendoGrid")!=undefined){var lt=$("#gridProjectCharterFunding1").data("kendoGrid").dataSource.data().filter(function(n){return n.dirty}).map(function(n){return n}),wi=lt.filter(function(n){return n.id==""||n.id==null}).map(function(n){return n}),bi=lt.filter(function(n){return n.id!=""&&n.id!=null}).map(function(n){return n});angular.forEach(wi,function(n){var t={};t.FundingUniqueID=n.FundingUniqueID;t.FundingTypeID=n.FundingTypeID;t.FundingSourceID=n.FundingSourceID;t.FundingIntheplan=n.FundingIntheplan;t.FundingAmount=n.FundingAmount;t.FundingNotes=n.FundingNotes;t.IncludeInCharter=n.IncludeInCharter;o.fundindInsertListItems.push(t)});angular.forEach(bi,function(n){var t={};t.FundingUniqueID=n.FundingUniqueID;t.FundingTypeID=n.FundingTypeID;t.FundingSourceID=n.FundingSourceID;t.FundingIntheplan=n.FundingIntheplan;t.FundingAmount=n.FundingAmount;t.FundingNotes=n.FundingNotes;t.IncludeInCharter=n.IncludeInCharter;o.fundindUpdateListItems.push(t)})}var t=!0,at=o.projectCharterInfoSelected.EmissionsImpactRealizationDate!=null&&o.projectCharterInfoSelected.EmissionsImpactRealizationDate!=""?$("#charterRealizationDate").val():null;if(at!=null&&(parseDate(at)?o.CharterRealizationDateCaps=!1:(t=!1,o.CharterRealizationDateCaps=!0)),!t){hideLoading();return}if($("#gridCapsCharter").data("kendoGrid")!=undefined&&(vt=$("#gridCapsCharter").data("kendoGrid").dataSource.data().map(function(n){return n}),angular.forEach(vt,function(n){temp={EMSourceID:n.EMSourceID,EMSourceName:n.EMSourceName,EMUnit:n.EMUnit,UnitOfMeasure:n.UnitOfMeasure,UnitCost:n.UnitCost,EMBasisOfEstimate:n.EMBasisOfEstimate,EMFactorImpact:n.EMFactorImpact};u.push(temp)})),yt=[],wt=$("#gridCapsWaterWasteCharter").data("kendoGrid").dataSource.data().map(function(n){return n}),angular.forEach(wt,function(n){if(t!=!1){if(n.WWStream==null||n.WWType==null||n.Category==null||n.WWStream==""||n.WWType==""||n.Category==""){t=!1;alert(waterWasteErrorMsg);return}pt={EMDataWWID:n.EMDataWWID,WWSourceMasterUniqueID:n.WWSourceMasterUniqueID,WWStream:n.WWStream,WWType:n.WWType,Category:n.Category,EMWWUnit:n.EMWWUnit,StandardUoM:n.StandardUoM,UnitCost:n.UnitCost,EMBasisOfEstimate:n.EMBasisOfEstimate};yt.push(pt)}}),!t){hideLoading();return}if(s=[],h=[],$("#gridCapsWaterWasteCharter").data("kendoGrid")!=undefined){var r=$("#gridCapsWaterWasteCharter").data("kendoGrid").dataSource.data().filter(function(n){return n.dirty}).map(function(n){return n}),ki=r.filter(function(n){return n.id==""||n.id==null}).map(function(n){return n}),di=r.filter(function(n){return n.id!=""&&n.id!=null}).map(function(n){return n});angular.forEach(ki,function(n){var t={};t.EMDataWWID=n.EMDataWWID;t.WWSourceMasterUniqueID=n.WWSourceMasterUniqueID;t.WWStream=n.WWStream;t.WWType=n.WWType;t.Category=n.Category;t.EMWWUnit=n.EMWWUnit;t.StandardUoM=n.StandardUoM;t.UnitCost=n.UnitCost;t.EMBasisOfEstimate=n.EMBasisOfEstimate;s.push(t)});angular.forEach(di,function(n){var t={};t.EMDataWWID=n.EMDataWWID;t.WWSourceMasterUniqueID=n.WWSourceMasterUniqueID;t.WWStream=n.WWStream;t.WWType=n.WWType;t.Category=n.Category;t.EMWWUnit=n.EMWWUnit;t.StandardUoM=n.StandardUoM;t.UnitCost=n.UnitCost;t.EMBasisOfEstimate=n.EMBasisOfEstimate;h.push(t)})}o.insertUpdateDeleteWaterWaste={insert:s,update:h,"delete":si};o.insertUpdateDeleteFunding={insert:o.fundindInsertListItems,update:o.fundindUpdateListItems,"delete":o.deletedFundingData};var bt=[],kt=[],dt=[];o.projectCharterInfoSelected.OtherImpactedProducts!=null&&(bt=o.projectCharterInfoSelected.OtherImpactedProducts.length>1?o.projectCharterInfoSelected.OtherImpactedProducts.join(","):o.projectCharterInfoSelected.OtherImpactedProducts[0]);o.projectCharterInfoSelected.ExecutionScope!=null&&(kt=o.projectCharterInfoSelected.ExecutionScope.length>1?o.projectCharterInfoSelected.ExecutionScope.join(","):o.projectCharterInfoSelected.ExecutionScope[0]);o.agileSecWorkstreamIds!=null&&o.agileSecWorkstreamIds!=""&&(dt=o.agileSecWorkstreamIds.join(","));o.projectCharterInfoSelectedData={ProjectID:o.projectCharterInfoSelected.ProjectID!=null?o.projectCharterInfoSelected.ProjectID:null,ProjectName:o.projectCharterInfoSelected.ProjectName,PrimaryProductID:o.projectCharterInfoSelected.PrimaryProductID!=null?o.projectCharterInfoSelected.PrimaryProductID.LookUpMemberID:null,OtherImpactedProducts:o.projectCharterInfoSelected.OtherImpactedProducts!=null?bt:null,PortfolioOwnerID:o.projectCharterInfoSelected.PortfolioOwnerID!=null?o.projectCharterInfoSelected.PortfolioOwnerID.LookUpMemberID:null,ExecutionScopeID:o.projectCharterInfoSelected.ExecutionScope!=null?kt:null,SponsorADID:o.projectCharterInfoSelected.SponsorADID!=null?o.projectCharterInfoSelected.SponsorADID.UserADId:null,ProjectManagerADID:o.projectCharterInfoSelected.ProjectManagerADID!=null?o.projectCharterInfoSelected.ProjectManagerADID.UserADId:null,ProposalStatement:o.projectCharterInfoSelected.ProposalStatement!=null?o.projectCharterInfoSelected.ProposalStatement:null,DetailedDescription:o.projectCharterInfoSelected.DetailedDescription!=null?o.projectCharterInfoSelected.DetailedDescription:null,InScope:o.projectCharterInfoSelected.InScope!=null?o.projectCharterInfoSelected.InScope:null,OutOfScope:o.projectCharterInfoSelected.OutOfScope!=null?o.projectCharterInfoSelected.OutOfScope:null,DurationBaseCase:o.projectCharterInfoSelected.DurationBaseCase!=null&&o.projectCharterInfoSelected.DurationBaseCase!=""?o.projectCharterInfoSelected.DurationBaseCase:null,DurationHighCase:o.projectCharterInfoSelected.DurationHighCase!=null&&o.projectCharterInfoSelected.DurationHighCase!=""?o.projectCharterInfoSelected.DurationHighCase:null,PeopleFTEMonthsRequiredBaseCase:o.projectCharterInfoSelected.PeopleFTEMonthsRequiredBaseCase!=null&&o.projectCharterInfoSelected.PeopleFTEMonthsRequiredBaseCase!=""?o.projectCharterInfoSelected.PeopleFTEMonthsRequiredBaseCase:null,PeopleFTEMonthsRequiredHighCase:o.projectCharterInfoSelected.PeopleFTEMonthsRequiredHighCase!=null&&o.projectCharterInfoSelected.PeopleFTEMonthsRequiredHighCase!=""?o.projectCharterInfoSelected.PeopleFTEMonthsRequiredHighCase:null,TotalCapExBaseCase:o.projectCharterInfoSelected.TotalCapExBaseCase!=null&&o.projectCharterInfoSelected.TotalCapExBaseCase!==""?o.projectCharterInfoSelected.TotalCapExBaseCase:null,TotalCapExHighCase:o.projectCharterInfoSelected.TotalCapExHighCase!=null&&o.projectCharterInfoSelected.TotalCapExHighCase!==""?o.projectCharterInfoSelected.TotalCapExHighCase:null,TotalNonFTEOpExBaseCase:o.projectCharterInfoSelected.TotalNonFTEOpExBaseCase!=null&&o.projectCharterInfoSelected.TotalNonFTEOpExBaseCase!==""?o.projectCharterInfoSelected.TotalNonFTEOpExBaseCase:null,TotalNonFTEOpExHighCase:o.projectCharterInfoSelected.TotalNonFTEOpExHighCase!=null&&o.projectCharterInfoSelected.TotalNonFTEOpExHighCase!==""?o.projectCharterInfoSelected.TotalNonFTEOpExHighCase:null,ParentProgramID:o.SelectedParentProject!=null&&o.SelectedParentProject.ProblemUniqueID!=""?o.SelectedParentProject.ProblemUniqueID:null,FunctionsRequiredID:o.projectCharterInfoSelected.FunctionsRequiredID!=null?o.projectCharterInfoSelected.FunctionsRequiredID.LookUpMemberID:null,ApprovedDate:o.projectCharterInfoSelected.ApprovedDate!=null&&o.projectCharterInfoSelected.ApprovedDate!=""?o.projectCharterInfoSelected.ApprovedDate:null,AgilePrimaryWorkstream:o.selectedAgilePrimaryWorkstream!=null&&o.selectedAgilePrimaryWorkstream!=""?o.selectedAgilePrimaryWorkstream.LookUpMemberID:null,AgileSecondaryWorkstream:dt,AgileWave:o.selectedAgileWave!=null&&o.selectedAgileWave!=""?o.selectedAgileWave.LookUpMemberID:null,PrimaryKPI:o.projectCharterInfoSelected.PrimaryKPI!=null?o.projectCharterInfoSelected.PrimaryKPI.LookUpMemberID:null,ProjectDescription:o.projectCharterInfoSelected.ProjectDescription!=null?o.projectCharterInfoSelected.ProjectDescription:null,TargetEndState:o.projectCharterInfoSelected.TargetEndState!=null?o.projectCharterInfoSelected.TargetEndState:null,IsCapsProject:o.projectCharterInfoSelected.IsCapsProject,CalculatedEmissionsImpact:o.projectCharterInfoSelected.CalculatedEmissionsImpact!=null&&o.projectCharterInfoSelected.CalculatedEmissionsImpact!==""?o.projectCharterInfoSelected.CalculatedEmissionsImpact:null,EmissionPortfolioID:o.projectCharterInfoSelected.EmissionPortfolioID!=null&&o.projectCharterInfoSelected.EmissionPortfolioID!==""?o.projectCharterInfoSelected.EmissionPortfolioID:null,EmissionsImpactRealizationDate:o.projectCharterInfoSelected.EmissionsImpactRealizationDate!=null&&o.projectCharterInfoSelected.EmissionsImpactRealizationDate!==""?o.projectCharterInfoSelected.EmissionsImpactRealizationDate:null,NoCarbonImpact:o.projectCharterInfoSelected.NoCarbonImpact!=null&&o.projectCharterInfoSelected.NoCarbonImpact!==""?o.projectCharterInfoSelected.NoCarbonImpact:null,EnergyCostImpactPerYear:o.projectCharterInfoSelected.EnergyCostImpactPerYear!=null&&o.projectCharterInfoSelected.EnergyCostImpactPerYear!==""?o.projectCharterInfoSelected.EnergyCostImpactPerYear:null,EnergyImpact:o.projectCharterInfoSelected.EnergyImpact,EnergyWasteImpactCostPerYear:o.projectCharterInfoSelected.EnergyWasteImpactCostPerYear!=null&&o.projectCharterInfoSelected.EnergyWasteImpactCostPerYear!==""?o.projectCharterInfoSelected.EnergyWasteImpactCostPerYear:null,EnergyWasteImpactPerYear:o.projectCharterInfoSelected.EnergyWasteImpactPerYear,EnergyWaterImpactCostPerYear:o.projectCharterInfoSelected.EnergyWaterImpactCostPerYear!=null&&o.projectCharterInfoSelected.EnergyWaterImpactCostPerYear!==""?o.projectCharterInfoSelected.EnergyWaterImpactCostPerYear:null,EnergyWaterImpactPerYear:o.projectCharterInfoSelected.EnergyWaterImpactPerYear};v.push(o.insertUpdateDeleteMilestone);y.push(o.insertUpdateDeleteRisk);k.push(o.insertUpdateDeleteTeams);w.push(o.insertUpdateDeleteKeySuccess);p.push(o.insertUpdateDeleteAssumption);g.push(o.insertUpdateDeleteFunding);nt.push(o.projectCharterInfoSelectedData);ni={ProjectID:o.projectCharterInfoSelected.ProjectID,objRiskIssue:JSON.stringify(y),objMilestone:JSON.stringify(v),objProjectTeam:JSON.stringify(k),objKeySuccess:JSON.stringify(w),objAssumption:JSON.stringify(p),objFunding:JSON.stringify(g),objProjectCharterInfo:JSON.stringify(nt),userId:currentUserId,objCapsCharter:JSON.stringify(u),CapsWaterWaste:JSON.stringify(o.insertUpdateDeleteWaterWaste)};f.postDataWCFAsync("projectCharterUpdate",ni).then(function(t){if(t=="Success")angular.copy(o.SelectedParentProject,d),vi(),b={},hideLoading(),IsProgram?gr():kr(),$.when(f.postDataWCF("getProjectNameByID",SeletedProjectId),f.getDataWCF("getProjectTeam/"+SeletedProjectId),f.postDataWCFAsync("getProjectCharterInfoByID",SeletedProjectId)).then(function(t,i,r){var c=JSON.parse(r.getProjectCharterInfoByIDResult),u=c[0],l,a,s,e,h;o.projectCharterInfoSelected.ProjectManagerName=u.ProjectManagerName;o.projectCharterInfoSelected.SponsorName=u.SponsorName;l=u.isUnitCost;o.isUnitCost=u.isUnitCost;a=[];o.isEMPortfolio=u.EmissionPortfolioID!=null&&u.EmissionPortfolioID!=""?!0:!1;beforeSaveIsUnit=o.isUnitCost;o.projectCharterInfoSelected.EnergyImpact=u.EnergyImpact;o.projectCharterInfoSelected.EnergyCostImpactPerYear=u.EnergyCostImpactPerYear;o.projectCharterInfoSelected.EnergyWasteImpactCostPerYear=u.EnergyWasteImpactCostPerYear;o.projectCharterInfoSelected.EnergyWasteImpactPerYear=u.EnergyWasteImpactPerYear;o.projectCharterInfoSelected.EnergyWaterImpactCostPerYear=u.EnergyWaterImpactCostPerYear;o.projectCharterInfoSelected.EnergyWaterImpactPerYear=u.EnergyWaterImpactPerYear;o.formattedCalculated=kendo.toString(u.CalculatedEmissionsImpact,"n1");o.projectCharterInfoSelected.EmissionsImpactRealizationDate=u.EmissionsImpactRealizationDate;angular.copy(o.projectCharterInfoSelected,b);s=JSON.parse(t.getProjectNameByIDResult);SeletedProjectName=s[0].ProjectName;n.$emit("UpdateProjectNameHub",SeletedProjectName);n.$emit("ProjectHubGetCall",SeletedProjectName);n.$emit("overallStatusProjectCharter");IsProgram?n.$emit("getProgramHubOverallData"):n.$emit("getProjectHubOverallData");e=[];e=JSON.parse(i.getProjectTeamResult);ProjectSiteUrl!=""&&e.length>0&&s[0].IsConfidential==!0&&(h=[],angular.copy(e,h),f.getAllMembers(h))}),n.$emit("UpdateHubLoad",!0),n.$emit("UpdateGeneralInfo",!0),n.$emit("RefreshForDataQuality"),i.$digest(),alert(saveMessage);else{hideLoading();alert("Error occurred in Project Charter Update");var r={method:"updateProjectCharterInfo",exceptionMessage:"message:"+t,ErrorParameter:c};$.when(f.postDataWCFAsync("WriteErrorLog",r)).then(function(){console.log(errormessage)})}})}catch(ti){hideLoading();ii={method:"updateProjectCharterInfo",exceptionMessage:"message:"+ti.message+" stack:"+ti.stack,ErrorParameter:c};$.when(f.postDataWCFAsync("WriteErrorLog",ii)).then(function(){alert(errormessage)})}}function kr(){l=[];var n={ProjectID:SeletedProjectId,DataType:"TemplateDetails"},t={ProjectID:SeletedProjectId,DataType:"Template"};$.when(f.getDataWCFAsync("getRiskIssue/"+SeletedProjectId),f.getDataWCFAsync("getProjectTeam/"+SeletedProjectId),f.getDataWCFAsync("getSchedule/"+SeletedProjectId),f.postDataWCFAsync("getProjectCharterKeySuccess",SeletedProjectId),f.postDataWCFAsync("getProjectCharterFunding",SeletedProjectId),f.postDataWCFAsync("getProjectCharterAssumption",SeletedProjectId),f.postDataWCFAsync("getProjectCapsDetails",SeletedProjectId),f.postDataWCFAsync("getMilestoneSetProjectHub",t),f.postDataWCFAsync("getMilestoneSetProjectHub",n),f.postDataWCFAsync("getCAPSWaterWasteByProjectID",SeletedProjectId),f.postDataWCFAsync("getCAPSWaterWaste")).then(function(n,t,r,u,e,h,l,a,y,b){var d,g,ot;try{tt=JSON.parse(n.getRiskIssueResult);k=JSON.parse(t.getProjectTeamResult);s=JSON.parse(r.getScheduleResult);it=JSON.parse(u.getProjectCharterKeySuccessResult);rt=JSON.parse(h.getProjectCharterAssumptionResult);ut=JSON.parse(e.getProjectCharterFundingResult);w=JSON.parse(l.getProjectCapsDetailsResult);v=w.filter(function(n){return n.EMPortfolioOwnerID==o.projectCharterInfoSelected.EmissionPortfolioID});p=JSON.parse(a);nt=JSON.parse(y);ft=JSON.parse(b.getCAPSWaterWasteByProjectIDResult);yt();$("#gridProjectCharterKeySuccessCriteria").data("kendoGrid").dataSource.read();$("#gridProjectCharterMilestone").data("kendoGrid").dataSource.read();$("#gridProjectTeam").data("kendoGrid").dataSource.read();$("#gridProjectCharterRisk").data("kendoGrid").dataSource.read();$("#gridProjectCharterAssumption").data("kendoGrid").dataSource.read();$("#gridProjectCharterFunding1").data("kendoGrid").dataSource.read();$("#gridCapsCharter").data("kendoGrid").dataSource.read();$("#gridCapsWaterWasteCharter").data("kendoGrid").dataSource.read();d=new kendo.data.DataSource({data:p});g=$("#gridCharterAddMilestones").data("kendoGrid");d.read();g.setDataSource(d);i.$digest()}catch(et){hideLoading();ot={method:"getDataForGrids",exceptionMessage:"message:"+et.message+" stack:"+et.stack,ErrorParameter:c};$.when(f.postDataWCFAsync("WriteErrorLog",ot)).then(function(){alert(errormessage)})}})}function yt(){try{a=[];angular.forEach(k,function(n){var i,t;n.TeamMemberAdId!=null&&n.TeamMemberAdId!=""&&(i=a.filter(function(t){return t.value===n.TeamMemberAdId}),i.length==0&&(t={},t.text=n.TeamMemberName,t.value=n.TeamMemberAdId,t.UserCountry=n.UserCountry,t.UserImageUrl=n.UserImageUrl,t.UserEmailAddress=n.UserEmailAddress,t.UserDepartment=n.UserDepartment,a.push(t)))})}catch(n){hideLoading();var t={method:"UpdateProjectTeamUsers",exceptionMessage:"message:"+n.message+" stack:"+n.stack,ErrorParameter:c};$.when(f.postDataWCFAsync("WriteErrorLog",t)).then(function(){alert(errormessage)})}}function dr(){var n,r,u,h;o.deletedMilestoneData=[];o.deletedRiskData=[];o.deletedKeySuccessData=[];o.deletedAssumptionData=[];o.deletedTeamsData=[];o.deletedFundingData=[];o.pcApprovedDateError=!1;o.isPortfolioOwnerEditablePC=canPortfolioOwnerEdit;o.CharterRealizationDateCaps=!1;o.isEMPortfolio=!1;n={ProjectID:SeletedProjectId,DataType:"TemplateDetails"};r={ProjectID:SeletedProjectId,DataType:"Template"};try{SeletedProjectId=getParameterByName(window.location.search,"ProblemID");dt={ProjectID:SeletedProjectId,DataType:"RiskIssue"};ct={ProjectID:SeletedProjectId,DataType:"Schedule"};u=product+","+portfolioOwner+","+CapitalProjectClassification+","+topsFunctionRequired+","+riskIssueType+","+businessCaseFundingType+","+funtionalGroup+","+executionScope+","+teamPermission+","+topsPrimaryKpi+","+agileAttribute+","+agileWave;$.when(f.postDataWCFAsync("getLookupData",u),f.postDataWCFAsync("getProgramHubData",dt),f.getDataWCFAsync("getProjectTeam/"+SeletedProjectId),f.postDataWCFAsync("getProgramHubData",ct),f.postDataWCFAsync("getProjectCharterKeySuccess",SeletedProjectId),f.postDataWCFAsync("getProjectCharterFunding",SeletedProjectId),f.postDataWCFAsync("getProjectCharterInfoByID",SeletedProjectId),f.postDataWCFAsync("getProjectCharterAssumption",SeletedProjectId),f.getDataWCFAsync("getUserPermissionByProjectUserId/"+currentUserId+"/"+SeletedProjectId),f.postDataWCFAsync("getProjectCapsDetails",SeletedProjectId),f.postDataWCFAsync("getMilestoneSetProjectHub",r),f.postDataWCFAsync("getMilestoneSetProjectHub",n),f.postDataWCFAsync("getCAPSWaterWasteByProjectID",SeletedProjectId),f.postDataWCFAsync("getCAPSWaterWaste")).then(function(n,r,u,e,h,l,a,d,g,ct,pt,dt,gt,si){var ki,ir,rr,ur,fr,er,or,sr,li,vi,wi,di,gi,gr,nu,ar,vr,yr,pr,wr,ci,nr,bi,tr,br,dr;try{for(o.dsPermission=JSON.parse(g.getUserPermissionByProjectUserIdResult),o.isEditable=o.dsPermission[0].canEdit==!0?!0:!1,o.dsPrimaryProduct=JSON.parse(n.getLookupDataResult).filter(function(n){return n.LookUpName===product}),o.dsOwner=JSON.parse(n.getLookupDataResult).filter(function(n){return n.LookUpName===portfolioOwner}),o.dsExecutionScope=t("orderBy")(JSON.parse(n.getLookupDataResult).filter(function(n){return n.LookUpName==executionScope}),"LookUpMemberOrder"),o.dsProjectClassification=JSON.parse(n.getLookupDataResult).filter(function(n){return n.LookUpName===CapitalProjectClassification}),o.dsAgilePrimaryWorkstation=JSON.parse(n.getLookupDataResult).filter(function(n){return n.LookUpName==agileAttribute}),o.dsAgileWave=JSON.parse(n.getLookupDataResult).filter(function(n){return n.LookUpName==agileWave}),o.dsPrimaryKPI=t("orderBy")(JSON.parse(n.getLookupDataResult).filter(function(n){return n.LookUpName==topsPrimaryKpi}),"LookUpMemberOrder"),o.functionRequired=JSON.parse(n.getLookupDataResult).filter(function(n){return n.LookUpName===topsFunctionRequired}),o.dsProjectClassification=t("orderBy")(o.dsProjectClassification,"LookUpMemberOrder"),o.dsPrimaryProduct=t("orderBy")(o.dsPrimaryProduct,"LookUpMemberOrder"),o.dsFundingType=JSON.parse(n.getLookupDataResult).filter(function(n){return n.LookUpName===businessCaseFundingType}),ki=JSON.parse(a.getProjectCharterInfoByIDResult),ki.length>0&&(o.projectCharterInfoSelected=ki[0]),o.localCurrencyAbbrePlaceholder=o.projectCharterInfoSelected.LocalCurrencyAbbreviation,o.projectCharterInfoSelected.LocalCurrencyAbbreviation!=null&&(o.localCurrencyAbbre="("+o.projectCharterInfoSelected.LocalCurrencyAbbreviation+")"),ir=o.projectCharterInfoSelected.ParentProgramName,rr=o.projectCharterInfoSelected.ParentProgramID,yi(rr,ir),ft=JSON.parse(gt.getCAPSWaterWasteByProjectIDResult),y=JSON.parse(si.getCAPSWaterWasteResult),lt=Array.from(new Set(y.map(n=>n.WWStream))),ni=Array.from(new Set(y.map(n=>n.WWType))),ti=Array.from(new Set(y.map(n=>n.Category))),o.isUnitCostWWC=o.projectCharterInfoSelected.isUnitCostWWC,o.projectCharterInfoSelected.PrimaryProductID!=null&&o.projectCharterInfoSelected.PrimaryProductID!=""&&(ur=o.dsPrimaryProduct.filter(function(n){return n.LookUpMemberID==o.projectCharterInfoSelected.PrimaryProductID}),o.projectCharterInfoSelected.PrimaryProductID=ur[0]),o.projectCharterInfoSelected.PortfolioOwnerID!=null&&o.projectCharterInfoSelected.PortfolioOwnerID!=""&&(fr=o.dsOwner.filter(function(n){return n.LookUpMemberID==o.projectCharterInfoSelected.PortfolioOwnerID}),o.projectCharterInfoSelected.PortfolioOwnerID=fr[0]),o.projectCharterInfoSelected.GovernanceBodyTypeID!=null&&o.projectCharterInfoSelected.GovernanceBodyTypeID!=""&&(er=o.dsOwner.filter(function(n){return n.LookUpMemberID==o.projectCharterInfoSelected.GovernanceBodyTypeID}),o.projectCharterInfoSelected.GovernanceBodyTypeID=er[0]),o.projectCharterInfoSelected.FunctionsRequiredID!=null&&o.projectCharterInfoSelected.FunctionsRequiredID!=""&&(or=o.functionRequired.filter(function(n){return n.LookUpMemberID==o.projectCharterInfoSelected.FunctionsRequiredID}),o.projectCharterInfoSelected.FunctionsRequiredID=or[0]),o.projectCharterInfoSelected.PrimaryKPI!=null&&o.projectCharterInfoSelected.PrimaryKPI!=""&&(sr=o.dsPrimaryKPI.filter(function(n){return n.LookUpMemberID==o.projectCharterInfoSelected.PrimaryKPI}),o.projectCharterInfoSelected.PrimaryKPI=sr[0]),li=[],o.projectCharterInfoSelected.AgilePrimaryWorkstream!=null&&o.projectCharterInfoSelected.AgilePrimaryWorkstream!=""&&(li=o.dsAgilePrimaryWorkstation.filter(function(n){return n.LookUpMemberID==o.projectCharterInfoSelected.AgilePrimaryWorkstream})),o.selectedAgilePrimaryWorkstream=li.length>0?li[0]:"",vi=[],o.projectCharterInfoSelected.AgileWave!=null&&o.projectCharterInfoSelected.AgileWave!=""&&(vi=o.dsAgileWave.filter(function(n){return n.LookUpMemberID==o.projectCharterInfoSelected.AgileWave})),o.selectedAgileWave=vi.length>0?vi[0]:"",wi=JSON.parse(n.getLookupDataResult).filter(function(n){return n.LookUpName===teamPermission&&n.LookUpMemberName!="None"}),ci=0;ci<wi.length;ci++)bi={text:wi[ci].LookUpMemberName,value:wi[ci].LookUpMemberID},at.push(bi);tt=JSON.parse(r);k=JSON.parse(u.getProjectTeamResult);s=JSON.parse(e);it=JSON.parse(h.getProjectCharterKeySuccessResult);rt=JSON.parse(d.getProjectCharterAssumptionResult);ut=JSON.parse(l.getProjectCharterFundingResult);p=JSON.parse(pt);nt=JSON.parse(dt);o.riskIssueType=JSON.parse(n.getLookupDataResult).filter(function(n){return n.LookUpName===riskIssueType});o.dsFuntionalGroup=JSON.parse(n.getLookupDataResult).filter(function(n){return n.LookUpName===funtionalGroup});o.agileVisibleCharter=o.projectCharterInfoSelected.IsAgile;var hr=[],cr=[],lr=[];if(o.projectCharterInfoSelected.OtherImpactedProducts!=null&&o.projectCharterInfoSelected.OtherImpactedProducts!="undefined"&&(hr=o.projectCharterInfoSelected.OtherImpactedProducts.split(",")),o.projectCharterInfoSelected.ExecutionScopeID!=null&&o.projectCharterInfoSelected.ExecutionScopeID!="undefined"&&(cr=o.projectCharterInfoSelected.ExecutionScopeID.split(",")),o.dsImpactedProducts={placeholder:"Select and/or Type to Search",dataTextField:"LookUpMemberName",dataValueField:"LookUpMemberID",valuePrimitive:!0,autoBind:!1,dataSource:o.dsPrimaryProduct,filter:"contains"},o.projectCharterInfoSelected.OtherImpactedProducts=hr,o.dsExecutionScope={placeholder:"Select scope...",dataTextField:"LookUpMemberName",dataValueField:"LookUpMemberID",valuePrimitive:!0,autoBind:!1,dataSource:o.dsExecutionScope,filter:"contains"},o.projectCharterInfoSelected.ExecutionScope=cr,o.projectCharterInfoSelected.AgileSecondaryWorkstream!=null&&o.projectCharterInfoSelected.AgileSecondaryWorkstream!="undefined"&&(lr=o.projectCharterInfoSelected.AgileSecondaryWorkstream.split(",")),o.dsAgileSecWorkstream={placeholder:"Select secondary workstream...",dataTextField:"LookUpMemberName",dataValueField:"LookUpMemberID",valuePrimitive:!0,autoBind:!1,dataSource:o.dsAgilePrimaryWorkstation,filter:"contains"},o.agileSecWorkstreamIds=lr,di=$("#ddl_PC_PrimaryProduct").data("kendoComboBox"),di.value(o.SelectedProject.PrimaryProductID),di.refresh(),gi=$("#ddl_PC_PortfolioOwner").data("kendoComboBox"),gi.value(o.SelectedProject.PortfolioOwnerID),gi.refresh(),b={},angular.copy(o.projectCharterInfoSelected,b),gr=o.projectCharterInfoSelected.isUnitCost,o.isUnitCost=o.projectCharterInfoSelected.isUnitCost,nu=[],o.isEMPortfolio=o.projectCharterInfoSelected.EmissionPortfolioID!=null&&o.projectCharterInfoSelected.EmissionPortfolioID!=""?!0:!1,w=JSON.parse(ct.getProjectCapsDetailsResult),v=w.filter(function(n){return n.EMPortfolioOwnerID==o.projectCharterInfoSelected.EmissionPortfolioID}),angular.copy(v,vt),beforeSaveIsUnit=o.isUnitCost,beforeSaveEnergy=o.projectCharterInfoSelected.EnergyCostImpactPerYear,o.formattedCalculated=kendo.toString(o.projectCharterInfoSelected.CalculatedEmissionsImpact,"n1"),ht==0){for(ci=0;ci<o.riskIssueType.length;ci++)ar={text:o.riskIssueType[ci].LookUpMemberName,value:o.riskIssueType[ci].LookUpMemberID},wt.push(ar);for(ci=0;ci<o.dsFundingType.length;ci++)vr={text:o.dsFundingType[ci].LookUpMemberName,value:o.dsFundingType[ci].LookUpMemberID},bt.push(vr);for(ci=0;ci<o.dsOwner.length;ci++)yr={text:o.dsOwner[ci].LookUpMemberName,value:o.dsOwner[ci].LookUpMemberID},kt.push(yr);for(ci=0;ci<o.dsFuntionalGroup.length;ci++)pr={text:o.dsFuntionalGroup[ci].LookUpMemberName,value:o.dsFuntionalGroup[ci].LookUpMemberID},et.push(pr);for(ci=0;ci<o.dsPrimaryKPI.length;ci++)wr={text:o.dsPrimaryKPI[ci].LookUpMemberName,value:o.dsPrimaryKPI[ci].LookUpMemberID},st.push(wr);for(ci=0;ci<o.dsFuntionalGroup.length;ci++)nr=!1,(o.dsFuntionalGroup[ci].LookUpMemberID==projectmanager||o.dsFuntionalGroup[ci].LookUpMemberID==projectSponsor)&&(nr=!0),bi={text:o.dsFuntionalGroup[ci].LookUpMemberName,value:o.dsFuntionalGroup[ci].LookUpMemberID,isDisabled:nr},ot.push(bi);ri();ui();fi();ei();oi();pi();ai();hi()}else yt(),$("#gridProjectCharterKeySuccessCriteria").data("kendoGrid").dataSource.read(),$("#gridProjectCharterMilestone").data("kendoGrid").dataSource.read(),$("#gridProjectTeam").data("kendoGrid").dataSource.read(),$("#gridProjectCharterRisk").data("kendoGrid").dataSource.read(),$("#gridProjectCharterAssumption").data("kendoGrid").dataSource.read(),$("#gridProjectCharterFunding1").data("kendoGrid").dataSource.read(),$("#gridCapsCharter").data("kendoGrid").dataSource.read(),$("#gridCapsWaterWasteCharter").data("kendoGrid").dataSource.read(),tr=new kendo.data.DataSource({data:p}),br=$("#gridCharterAddMilestones").data("kendoGrid"),tr.read(),br.setDataSource(tr);bindChangeComboBox("functionRequired");ii();i.$digest();hideLoading();ht++}catch(kr){hideLoading();dr={method:"prepareDataForProgramCharter",exceptionMessage:"message:"+kr.message+" stack:"+kr.stack,ErrorParameter:c};$.when(f.postDataWCFAsync("WriteErrorLog",dr)).then(function(){alert(errormessage)})}})}catch(e){hideLoading();h={method:"prepareDataForProgramCharter",exceptionMessage:"message:"+e.message+" stack:"+e.stack,ErrorParameter:c};$.when(f.postDataWCFAsync("WriteErrorLog",h)).then(function(){alert(errormessage)})}}function gr(){l=[];var n={ProjectID:SeletedProjectId,DataType:"TemplateDetails"},t={ProjectID:SeletedProjectId,DataType:"Template"};$.when(f.postDataWCFAsync("getProgramHubData",dt),f.getDataWCFAsync("getProjectTeam/"+SeletedProjectId),f.postDataWCFAsync("getProgramHubData",ct),f.postDataWCFAsync("getProjectCharterKeySuccess",SeletedProjectId),f.postDataWCFAsync("getProjectCharterFunding",SeletedProjectId),f.postDataWCFAsync("getProjectCharterAssumption",SeletedProjectId),f.postDataWCFAsync("getProjectCapsDetails",SeletedProjectId),f.postDataWCFAsync("getMilestoneSetProjectHub",t),f.postDataWCFAsync("getMilestoneSetProjectHub",n),f.postDataWCFAsync("getCAPSWaterWasteByProjectID",SeletedProjectId),f.postDataWCFAsync("getCAPSWaterWaste")).then(function(n,t,r,u,e,h,l,a,y,b){var d,g,ot;try{tt=JSON.parse(n);k=JSON.parse(t.getProjectTeamResult);s=JSON.parse(r);it=JSON.parse(u.getProjectCharterKeySuccessResult);rt=JSON.parse(h.getProjectCharterAssumptionResult);ut=JSON.parse(e.getProjectCharterFundingResult);w=JSON.parse(l.getProjectCapsDetailsResult);v=w.filter(function(n){return n.EMPortfolioOwnerID==o.projectCharterInfoSelected.EmissionPortfolioID});p=JSON.parse(a);nt=JSON.parse(y);ft=JSON.parse(b.getCAPSWaterWasteByProjectIDResult);yt();$("#gridProjectCharterKeySuccessCriteria").data("kendoGrid").dataSource.read();$("#gridProjectCharterMilestone").data("kendoGrid").dataSource.read();$("#gridProjectTeam").data("kendoGrid").dataSource.read();$("#gridProjectCharterRisk").data("kendoGrid").dataSource.read();$("#gridProjectCharterAssumption").data("kendoGrid").dataSource.read();$("#gridProjectCharterFunding1").data("kendoGrid").dataSource.read();$("#gridCapsCharter").data("kendoGrid").dataSource.read();$("#gridCapsWaterWasteCharter").data("kendoGrid").dataSource.read();d=new kendo.data.DataSource({data:p});g=$("#gridCharterAddMilestones").data("kendoGrid");d.read();g.setDataSource(d);i.$digest()}catch(et){hideLoading();ot={method:"getProgramDataForGrids",exceptionMessage:"message:"+et.message+" stack:"+et.stack,ErrorParameter:c};$.when(f.postDataWCFAsync("WriteErrorLog",ot)).then(function(){alert(errormessage)})}})}function yi(n,t){var i=[{ProblemUniqueID:n,ProjectName:t}],u=SeletedProjectId,r=n;nu("pc_parentProject",i,"Parent",u,r);r=[];o.SelectedParentProject=i[0];angular.copy(o.SelectedParentProject,d)}function nu(n,t,r,u,e){var s=$("#"+n).data("kendoComboBox"),l;if(s==undefined){$("#"+n).kendoComboBox({dataTextField:"ProjectName",dataValueField:"ProblemUniqueID",dataSource:t,minLength:3,value:e,select:function(t){var r,u;o.SelectedParentProject={ProblemUniqueID:t.dataItem.ProblemUniqueID,ProjectName:t.dataItem.ProjectName};angular.equals(d,o.SelectedParentProject)===!1&&d.ProblemUniqueID!==undefined&&d.ProblemUniqueID!==null?confirm(parentProgChangMsg)?needHubreload=!0:(r=[],r.push(o.SelectedParentProject),angular.copy(d,o.SelectedParentProject),u=$("#"+n).data("kendoComboBox"),u.setDataSource(r),$("#"+n).data("kendoComboBox").value(d.ProblemUniqueID),i.$digest()):needHubreload=!0}});try{$("#"+n).data().kendoComboBox.input.on("keydown",function(i){var l,s,a,h,e;i.keyCode==13&&(e=$("#"+n).data("kendoComboBox"),l="",console.log(e.value()),s=e.input[0].value,a=o.projectCharterInfoSelected.IsConfidential===!0?"1":"0",console.log(s),s.length>=3?(displayLoading(),h={programUID:u,searchFor:r+"-"+o.projectCharterInfoSelected.IsConfidential,filterString:s},$.when(f.postDataWCFAsync("getAllProjectProgramListFilter",h)).then(function(n){try{t=JSON.parse(n);e.setDataSource(t);e.open();hideLoading()}catch(i){var r={method:"searchProjectParentCharter",exceptionMessage:"message:"+i.message+" stack:"+i.stack,ErrorParameter:c};$.when(f.postDataWCFAsync("WriteErrorLog",r)).then(function(){alert(errormessage)});hideLoading()}})):(alert(minThreeLetterMsg),t=[],e=$("#"+n).data("kendoComboBox"),e.setDataSource(t),e.close(),hideLoading()));i.keyCode==8||i.keyCode==46?$("#"+n).data("kendoComboBox").value(""):(t=[],e=$("#"+n).data("kendoComboBox"),e.setDataSource(t),e.close())})}catch(h){l={method:"searchProjectParentCharter",exceptionMessage:"message:"+h.message+" stack:"+h.stack,ErrorParameter:c};$.when(postDataWCFAsync("WriteErrorLog",l)).then(function(){alert(errormessage)});hideLoading()}}else s.setDataSource(t),s.value(e),hideLoading();return""}function pi(){var n=new kendo.data.DataSource({transport:{read:function(n){n.success(p)}},sort:[{field:"TemplateOrder",dir:"asc"}]});$("#gridCharterAddMilestones").kendoGrid({dataSource:n,sortable:!1,selectable:!0,navigatable:!0,detailInit:tu,columns:[{field:"MilestoneSet",title:"Milestone Set(s)",template:"<strong>#: MilestoneSet # <\/strong>",attributes:{"class":"ProgHub1"},headerAttributes:{"class":"wrap-header"}}]})}function tu(n){var r=nt.filter(function(t){return t.MilestoneTemplateID==n.data.MilestoneTemplateID}),i=!0;if(r.length==0&&(i=!1),i){var u={dataSource:{sort:[{field:"SortOrder",dir:"asc"}],transport:{read:function(n){n.success(nt)}},filter:{field:"MilestoneTemplateID",operator:"eq",value:n.data.MilestoneTemplateID}},scrollable:!1,editable:!1,navigatable:!0,columns:[{field:"Milestone",title:"Milestone",template:function(n){return n.MilestoneType==1||n.MilestoneType==2?n.Milestone.split("-")[1]==MilestoneExecutionInsert||n.Milestone.split("-")[1].trim()==""?n.Milestone!=null&&n.Milestone!=""?"<span class='RedQuality'>"+(n.MilestoneType==1?MilestoneStartPrefix:MilestoneEndPrefix)+MilestoneExecutionInsert+"<\/span>":"":n.Milestone!=null&&n.Milestone!=""?n.Milestone:"":n.Milestone!=null&&n.Milestone!=""?n.Milestone:""}},{field:"FunctionalGroupName",title:"Functional Owner"},{field:"Comments",title:"Comment"},{title:"Include In Charter",headerAttributes:{"class":"wrap-header"},width:"8%",template:function(n){return n.IncludeInReport==!0?'<input type="checkbox" checked disabled />':'<input type="checkbox" disabled />'}},{field:"IsLinked",title:"Add",headerAttributes:{"class":"wrap-header"},width:"5%",headerTemplate:'<label>Add<\/label><br><input type="checkbox" class="chkheader">',template:function(n){return n.IsLinked==!0?h(n,"IsLinked")+'<input type="checkbox" checked class="chkbxlink" />':h(n,"IsLinked")+'<input type="checkbox" class="chkbxlink" />'}},],dataBound:function(){var n=this;$(".chkbxlink").bind("change",function(n){var e=$(n.target).parent().parent(),r=$(n.target).closest(".k-detail-row").find(".k-grid").data("kendoGrid"),t,u,f,i;r!=undefined&&(t=r.dataItem(e),u=n.target.closest("td"),$(u).prepend("<span class='k-dirty'><\/span>"),t.set("IsLinked",this.checked),this.checked||(f=l.filter(function(n){return n.MilestoneID==t.MilestoneID}),f.length>0&&(i=l.findIndex(n=>n.MilestoneID==t.MilestoneID),l.splice(i,1),t.MilestoneType==null&&(i=s.findIndex(n=>n.MilestoneID==t.MilestoneID),s.splice(i,1))),$("#gridProjectCharterMilestone").data("kendoGrid").dataSource.read()))});$(".chkheader").change(function(n){var u=n.target.checked,e=$(n.target).closest(".k-detail-row").find(".k-grid").data("kendoGrid"),i,t,f,r;if(e!=undefined){for(i=$(n.target).closest(".k-detail-row").find(".k-grid").data("kendoGrid").dataSource.view(),t=0;t<i.length;t++)i[t].set("IsLinked",u),u==!1&&(f=l.filter(function(n){return n.MilestoneID==i[t].MilestoneID}),f.length>0&&(r=l.findIndex(n=>n.MilestoneID==i[t].MilestoneID),l.splice(r,1),i[t].MilestoneType==null&&(r=s.findIndex(n=>n.MilestoneID==i[t].MilestoneID),s.splice(r,1))));u==!1&&$("#gridProjectCharterMilestone").data("kendoGrid").dataSource.read()}})}},t=$("<div/>").appendTo(n.detailCell).kendoGrid(u).data("kendoGrid");t.tbody.on("keydown",function(n){var r=n.keyCode?n.keyCode:n.which,i;r==13&&(i=$(n.target).closest(".k-combobox").length,i&&(t.editCell(t.current()),$("[data-role='combobox']").data("kendoComboBox").dataSource.read()))})}else $("<div><span>No Milestones are added<\/span><\/div>").appendTo(n.detailCell)}function iu(){var t,i,r,u,v,e,p;try{var h=!1,a=$("#gridCharterAddMilestones").data("kendoGrid"),n=a.element.find(".k-detail-row");for(t=0;t<n.length;t++)r=$(n[t]).find(".k-grid").data("kendoGrid"),r!=undefined&&(u=$(n[t]).find(".k-grid").data("kendoGrid").dataSource.data().filter(function(n){return n.IsLinked==!0}).map(function(n){return n}),u.length>0&&(h=!0));if(h==!0&&confirm(setMilestoneConfirm)){var a=$("#gridCharterAddMilestones").data("kendoGrid"),n=a.element.find(".k-detail-row"),o=!1;for(i=0;i<n.length;i++)r=$(n[i]).find(".k-grid").data("kendoGrid"),r!=undefined&&(u=$(n[i]).find(".k-grid").data("kendoGrid").dataSource.data().filter(function(n){return n.IsLinked==!0}).map(function(n){return n}),angular.forEach(u,function(n){var t={},r,u,f,i;if(t.ScheduleUniqueID=NewGuid(),t.MilestoneTemplateID=n.MilestoneTemplateID,t.Milestone=n.Milestone,t.Comments=n.Comments,t.Variance="NA",t.FunctionGroupID=n.FunctionGroupID,t.IncludeInCharter=n.IncludeInReport,t.ProjectID=SeletedProjectId,t.PlannedFinish=null,t.BaselineFinish=null,t.CompletionDate=null,t.MilestoneType=n.MilestoneType,t.MilestoneID=n.MilestoneID,r=l.filter(function(t){return t.MilestoneID==n.MilestoneID}),r.length==0){if(n.MilestoneType!=null){if(u=l.filter(function(t){return t.MilestoneType==n.MilestoneType&&n.MilestoneType==1}),f=l.filter(function(t){return t.MilestoneType==n.MilestoneType&&n.MilestoneType==2}),u.length>0){o=!0;alert(exeStartMsg);return}if(f.length>0){o=!0;alert(exeEndMsg);return}}n.MilestoneType==1?(i=s.findIndex(n=>n.MilestoneType==1),s[i].Comments=s[i].Comments!=null&&s[i].Comments!=""?s[i].Comments:n.Comments,s[i].FunctionGroupID=n.FunctionGroupID!=null&&n.FunctionGroupID!=""?n.FunctionGroupID:s[i].FunctionGroupID,s[i].IncludeInCharter=s[i].IncludeInCharter!=null&&s[i].IncludeInCharter!=""?s[i].IncludeInCharter:n.IncludeInReport,s[i].Milestone=n.Milestone,s[i].MilestoneTemplateID=n.MilestoneTemplateID,s[i].MilestoneID=n.MilestoneID,t.ScheduleUniqueID=s[i].ScheduleUniqueID,t.MilestoneTemplateID=n.MilestoneTemplateID,t.Milestone=n.Milestone,t.Comments=n.Comments,t.Variance="NA",t.FunctionGroupID=n.FunctionGroupID,t.IncludeInCharter=n.IncludeInReport,t.ProjectID=SeletedProjectId,t.PlannedFinish=null,t.BaselineFinish=null,t.CompletionDate=null,t.MilestoneType=n.MilestoneType,t.MilestoneID=n.MilestoneID,l.push(t)):n.MilestoneType==2?(i=s.findIndex(n=>n.MilestoneType==2),s[i].Comments=s[i].Comments!=null&&s[i].Comments!=""?s[i].Comments:n.Comments,s[i].FunctionGroupID=n.FunctionGroupID!=null&&n.FunctionGroupID!=""?n.FunctionGroupID:s[i].FunctionGroupID,s[i].IncludeInCharter=s[i].IncludeInCharter!=null&&s[i].IncludeInCharter!=""?s[i].IncludeInCharter:n.IncludeInReport,s[i].Milestone=n.Milestone,s[i].MilestoneTemplateID=n.MilestoneTemplateID,s[i].MilestoneID=n.MilestoneID,t.ScheduleUniqueID=s[i].ScheduleUniqueID,t.MilestoneTemplateID=n.MilestoneTemplateID,t.Milestone=n.Milestone,t.Comments=n.Comments,t.Variance="NA",t.FunctionGroupID=n.FunctionGroupID,t.IncludeInCharter=n.IncludeInReport,t.ProjectID=SeletedProjectId,t.PlannedFinish=null,t.BaselineFinish=null,t.CompletionDate=null,t.MilestoneType=n.MilestoneType,t.MilestoneID=n.MilestoneID,l.push(t)):(l.push(t),s.push(t))}}));o||(l.length>0&&($("#gridProjectCharterMilestone").data("kendoGrid").dataSource.read(),v=$("#gridProjectCharterMilestone").data("kendoGrid"),angular.forEach(l,function(n){var t=v.dataSource.get(n.ScheduleUniqueID);t.dirty=!0})),$("#gridProjectCharterMilestone").data("kendoGrid").refresh(),e=$("#dialogAddMilestoneCharter"),e.data("kendoWindow").close())}else e=$("#dialogAddMilestoneCharter"),e.data("kendoWindow").close()}catch(y){p={method:"AddMilestoneCharter",exceptionMessage:"message:"+y.message+" stack:"+y.stack,ErrorParameter:c};$.when(f.postDataWCFAsync("WriteErrorLog",p)).then(function(){alert(errormessage)})}}function ru(n,t){var i,r,o;try{i=$("#"+n).data("kendoGrid");r=$("#"+t);document.activeElement.blur();i.dataSource.hasChanges()?t=="dialogAddMilestoneCharter"?fu(i.dataSource)?confirm(saveMilestoneConfirm)?uu():r.data("kendoWindow").open():r.data("kendoWindow").open():confirm(dialogCancelMessage)?(i.dataSource.cancelChanges(),i.dataSource.read(),r.data("kendoWindow").open()):e.preventDefault():r.data("kendoWindow").open()}catch(u){o={method:"CheckBulkEditGridUpdate",exceptionMessage:"message:"+u.message+" stack:"+u.stack,ErrorParameter:c};$.when(f.postDataWCFAsync("WriteErrorLog",o)).then(function(){})}}function uu(){var r,u,h,t;try{if(o.milestoneInsertListItems=[],o.milestoneUpdateListItems=[],r=[],u=$("#gridProjectCharterMilestone").data("kendoGrid").tbody.find("input:checked").length,u>milestoneCharterCount)return alert(milestoneCountMessage),hideLoading(),!1;if($("#gridProjectCharterMilestone").data("kendoGrid")!=undefined){var e=$("#gridProjectCharterMilestone").data("kendoGrid").dataSource.data().filter(function(n){return n.dirty}).map(function(n){return n}),v=e.filter(function(n){return n.id==""||n.id==null}).map(function(n){return n}),y=e.filter(function(n){return n.id!=""&&n.id!=null}).map(function(n){return n});angular.forEach(v,function(n){var t={};t.ScheduleUniqueID=n.ScheduleUniqueID;t.Milestone=n.Milestone;t.PlannedFinish=kendo.toString(n.PlannedFinish,"d");t.FunctionGroupID=n.FunctionGroupID;t.IncludeInCharter=n.IncludeInCharter;t.ProjectID=n.ProjectID;o.milestoneInsertListItems.push(t)});angular.forEach(y,function(n){var t={};t.ScheduleUniqueID=n.ScheduleUniqueID;t.Milestone=n.Milestone;t.Milestone=n.MilestoneType==1?MilestoneStartPrefix+n.Milestone:n.MilestoneType==2?MilestoneEndPrefix+n.Milestone:n.Milestone;t.PlannedFinish=kendo.toString(n.PlannedFinish,"d");t.FunctionGroupID=n.FunctionGroupID;t.IncludeInCharter=n.IncludeInCharter;t.ProjectID=n.ProjectID;t.link=n.link;l.length>0&&(t.MilestoneTemplateID=n.MilestoneTemplateID,t.MilestoneID=n.MilestoneID,t.Comments=n.Comments);o.milestoneUpdateListItems.push(t)})}o.insertUpdateDeleteMilestone={insert:o.milestoneInsertListItems,update:o.milestoneUpdateListItems,"delete":o.deletedMilestoneData};o.milestoneInsertListItems.length>0||o.milestoneUpdateListItems.length>0||o.deletedMilestoneData.length>0?(r.push(o.insertUpdateDeleteMilestone),t={ProjectID:o.projectCharterInfoSelected.ProjectID,objMilestone:JSON.stringify(r),userId:currentUserId},f.postDataWCFAsync("updateProjectCharterSchedule",t).then(function(t){if(t=="Success"){alert("Milestone data updated successfully");l=[];IsProgram?$.when(f.postDataWCFAsync("getProgramHubData",ct)).then(function(n){s=JSON.parse(n);$("#gridProjectCharterMilestone").data("kendoGrid").dataSource.read();$("#gridCharterAddMilestones").data("kendoGrid").refresh();i.$digest()}):$.when(f.getDataWCFAsync("getSchedule/"+SeletedProjectId)).then(function(n){s=JSON.parse(n.getScheduleResult);$("#gridProjectCharterMilestone").data("kendoGrid").dataSource.read();$("#gridCharterAddMilestones").data("kendoGrid").refresh();i.$digest()});n.$emit("UpdateHubLoad",!0);var r=$("#dialogAddMilestoneCharter");r.data("kendoWindow").open()}})):(h=$("#dialogAddMilestoneCharter"),h.data("kendoWindow").open())}catch(a){t={method:"UpdateMilestone",exceptionMessage:"message:"+a.message+" stack:"+a.stack,ErrorParameter:c};$.when(f.postDataWCFAsync("WriteErrorLog",t)).then(function(){})}}function fu(n){var t=!1;return $.each(n._data,function(){this.dirty==!0&&(t=!0)}),n._destroyed.length>0&&(t=!0),t}function eu(){}var o=this,pt,at,b,vt;o.agileVisibleCharter=!1;o.buildNo=buildNo;o.releaseDate=releaseDate;o.SelectedProject={};o.projectCharterInfoSelected={};o.dsProjectCharterInfo=[];o.riskIssueType=[];o.scheduleData=[];o.isEditable=!1;o.projectVisible=!0;o.programVisible=!1;pt=!1;o.isPortfolioOwnerEditablePC=!1;o.projectCharterPagepath=projectCharterPagepath;o.projectCharter=projectCharter;o.trackEventFunc=pr;o.deletedMilestoneData=[];o.deletedRiskData=[];o.deletedKeySuccessData=[];o.deletedAssumptionData=[];o.deletedTeamsData=[];o.deletedFundingData=[];o.dateFormatlabel=dateLabel;o.dateErrorMsg=InValidDateFormat;var tt=[],k=[],s=[],it=[],rt=[],ut=[],l=[],wt=[],bt=[],kt=[],et=[],ot=[],st=[],ht=0,a=[],dt,ct,c="ProjectCharterCtrl",d={},gt=!1,v=[],w=[],p=[],nt=[],y=[],ft=[],lt=[],ni=[],ti=[],si=[];o.initProjectCharter=eu;o.InitkGridProjectCharterKeySuccessCriteria=ri;o.InitkGridProjectCharterMilestone=ui;o.InitkGridProjectCharterRisk=ei;o.InitkGridProjectTeam=fi;o.InitkGridProjectCharterFunding=oi;o.updateProjectCharterInfo=br;o.openProjectCharterInfo=wr;o.AddNewRow=g;o.gridAddDefaultRows=ii;o.changeAgile=wi;o.onChangeCarbonImpact=or;o.onChangeEnergyCostImpactCharter=sr;o.onChangeWWCostImpactCharter=hr;o.AddMilestoneCharter=iu;o.CheckBulkEditGridUpdate=ru;o.capsProjectTooltipCh=capsProjectTooltip;o.environmentalTootltipCh=environmentalTootltip;at=[];b={};o.localCurrencyAbbrePlaceholder;o.localCurrencyAbbre;o.isCapsProjectChecked=!0;o.isUnitCost=null;o.isUnitCostWWC=null;vt=[];o.options={format:"n1",decimals:1,min:0,restrictDecimals:!0};o.optionsCurrency={format:"n0",decimals:0,min:0,restrictDecimals:!0};o.optionsCostImpact={format:"n0",decimals:0,restrictDecimals:!0};var ou=function(){return o.isEditable==!1?'<input type="checkbox" #= item.IncludeInCharter ? checked="checked" : "" # class="successchkbx" disabled="disabled"/>':'<input type="checkbox" #= item.IncludeInCharter ? \'checked="checked"\' : "" # class="successchkbx" />'},ki=function(n){return o.isEditable==!1?n.IncludeInCharter==!0?h(n,"IncludeInCharter")+'<input disabled="disabled" checked type="checkbox" class="milestoneChkbx" />':h(n,"IncludeInCharter")+'<input disabled="disabled" type="checkbox" class="milestoneChkbx" />':n.IncludeInCharter==!0?h(n,"IncludeInCharter")+'<input type="checkbox" checked class="milestoneChkbx" />':h(n,"IncludeInCharter")+'<input type="checkbox" class="milestoneChkbx" />'},di=function(n){return o.isEditable==!1?n.IncludeInCharter==!0?h(n,"IncludeInCharter")+'<input disabled="disabled" checked type="checkbox" class="teamChkbx" />':h(n,"IncludeInCharter")+'<input disabled="disabled" type="checkbox" class="teamChkbx" />':n.IncludeInCharter==!0?h(n,"IncludeInCharter")+'<input type="checkbox" checked class="teamChkbx" />':h(n,"IncludeInCharter")+'<input type="checkbox" class="teamChkbx" />'},gi=function(n){return o.isEditable==!1?n.IncludeInCharter==!0?h(n,"IncludeInCharter")+'<input disabled="disabled" checked type="checkbox" class="riskChkbx" />':h(n,"IncludeInCharter")+'<input disabled="disabled" type="checkbox" class="riskChkbx" />':n.IncludeInCharter==!0?h(n,"IncludeInCharter")+'<input type="checkbox" checked class="riskChkbx" />':h(n,"IncludeInCharter")+'<input type="checkbox" class="riskChkbx" />'},nr=function(n){return o.isEditable==!1?n.IncludeInCharter==!0?h(n,"IncludeInCharter")+'<input disabled="disabled" checked type="checkbox" class="fundChkbx" />':h(n,"IncludeInCharter")+'<input disabled="disabled" type="checkbox" class="fundChkbx" />':n.IncludeInCharter==!0?h(n,"IncludeInCharter")+'<input type="checkbox" checked class="fundChkbx" />':h(n,"IncludeInCharter")+'<input type="checkbox" class="fundChkbx" />'},tr=function(n){return o.isEditable==!1?n.IncludeInCharter==!0?h(n,"IncludeInCharter")+'<input disabled="disabled" checked type="checkbox" class="assumptionChkbx" />':h(n,"IncludeInCharter")+'<input disabled="disabled" type="checkbox" class="assumptionChkbx" />':n.IncludeInCharter==!0?h(n,"IncludeInCharter")+'<input type="checkbox" checked class="assumptionChkbx" />':h(n,"IncludeInCharter")+'<input type="checkbox" class="assumptionChkbx" />'},h=function(n,t){return n.dirty&&n.dirtyFields[t]?"<span class='k-dirty'><\/span>":""}}angular.module("SPOTApp").controller("ProjectCharterCtrl",ProjectCharterCtrl);ProjectCharterCtrl.$inject=["$rootScope","$filter","$scope","$http","$q","GETPostService"];