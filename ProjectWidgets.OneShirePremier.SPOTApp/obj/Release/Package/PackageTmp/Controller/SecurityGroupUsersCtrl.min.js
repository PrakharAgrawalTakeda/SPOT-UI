function SecurityGroupUsersCtrl(n,t,i,r,u,f){function o(){var n=securityGroup;$.when(f.postDataWCF("getUserPermissionById",currentUserId)).then(function(t){var r=JSON.parse(t.getUserPermissionByIdResult),u=r.filter(function(n){return n.Permission==manageUsers}).length>0?!0:!1;u==!0?$.when(f.postDataWCF("getLookupData",n)).then(function(n){e.dsGroup=JSON.parse(n.getLookupDataResult);e.multiSecurityGroup={placeholder:"Select group...",dataTextField:"LookUpMemberName",dataValueField:"LookUpMemberID",valuePrimitive:!0,autoBind:!1,dataSource:e.dsGroup,filter:"contains"};i.$digest();hideLoading()}):window.location.href=portfolioCenterpath})}function h(){var n=c(),t=new kendo.data.DataSource({data:e.dsUserGroupInfo,batch:!0,pageSize:100,schema:{model:{id:"SecurityGroupId",fields:{UserName:{type:"string"},GroupName:{type:"string"}}}}}),r;$("#GridGroupDetail").kendoGrid({dataSource:t,columns:n,editable:!1,selectable:!0,pageable:!0,change:function(){var o,r,s,t,n,f,u;e.securityGroupSelectorData={};s=this.select();t=this.dataItem(s[0]);e.selectedUser=e.dsUserGroupInfo.filter(function(n){return n.UserADId==t.UserADId});e.selectedUser.length>0?(n={},f=[],n.UserADId=e.selectedUser[0].UserADId,n.UserDisplayName=e.selectedUser[0].UserName,n.UserImageUrl=e.selectedUser[0].UserImageUrl,n.UserEmailAddress=e.selectedUser[0].UserEmailAddress,n.UserDepartment=e.selectedUser[0].UserDepartment,n.UserCountry=e.selectedUser[0].UserCountry,f.push(n),u=$("#securityMembers").data("kendoComboBox"),u.value(e.selectedUser[0].UserADId),u.setDataSource(f),u.refresh(),o=t.SecurityGroupID.split(",").length>=1?t.SecurityGroupID.split(","):t.SecurityGroupID,r=$("#member").data("kendoMultiSelect"),r.value(o)):(r=$("#member").data("kendoMultiSelect"),r.value(""),alert("User is not present in the list"));i.$digest()}});r=$("#GridGroupDetail").data("kendoGrid")}function c(){return[{field:"UserName",title:"User Name"},{field:"GroupName",title:"Group Name"}]}function l(){var t=[],n="",i=[],r;$("#securityMembers").data("kendoComboBox")!=null&&(n=$("#securityMembers").data("kendoComboBox").value());i=e.securityGroupSelectorData.GroupName!=null?e.securityGroupSelectorData.GroupName.join(","):e.securityGroupSelectorData.SecurityGroupID;e.securityGroupSelectorData={UserADId:n!=""?n:null,SecurityGroupID:i,UserIsActive:"true"};t.push(e.securityGroupSelectorData);r=JSON.stringify({UserSecurityGroupData:t});f.postDataWCF("updateUserSecurityGroup",r).then(function(n){n==1&&(console.log(n),s())})}function s(){var n=$("#securityMembers").data("kendoComboBox"),t;n.setDataSource([]);n.value([]);n.refresh();t=$("#member").data("kendoMultiSelect");t.value("")}function a(){var n="";e.dsfilterUserGroup=[];e.dsUserGroupInfo=[];$("#securityMembers").data("kendoComboBox")!=null&&$("#securityMembers").data("kendoComboBox").selectedIndex!=-1&&(n=$("#securityMembers").data("kendoComboBox").value(),$.when(f.postDataWCF("getUserGroupById",n)).then(function(n){if(e.dsUserGroupInfo=JSON.parse(n.getUserGroupByIdResult),e.dsUserGroupInfo.length>0&&$.each(e.dsUserGroupInfo,function(n,t){e.dsfilterUserGroup.push(t.LookUpID)}),e.dsfilterUserGroup!=undefined){var t=$("#member").data("kendoMultiSelect");t.value(e.dsfilterUserGroup);i.$digest()}}))}function v(n){$("#"+n).kendoComboBox({suggest:!0,dataSource:[],minLength:3,filtering:function(n){n.preventDefault()},filter:"contains",dataTextField:"UserDisplayName",dataValueField:"UserADId",placeholder:"Select and/or Type to Search",change:function(){e.MemberOnChange()},headerTemplate:'<div class="dropdown-header k-widget k-header"><span>Photo<\/span><span>Contact info<\/span><\/div>',valueTemplate:'<span class="selected-value" style="background-image: url(\'#: data.UserImageUrl #\')"><\/span><span>#: data.UserDisplayName #<\/span>',template:'<span class="k-state-default" style="background-image: url(\'#: data.UserImageUrl #\')"><\/span><span class="k-state-default"><h3>#: data.UserDisplayName #<\/h3><p>#: data.UserEmailAddress #<\/p><p>#: data.UserDepartment # #: data.UserCountry #<\/p><\/span>'});$("#"+n).data("kendoComboBox").input.on("keydown",function(n){f.searchPeople(n,n.currentTarget.name.replace("_input",""))})}function y(){displayLoading();v("securityMembers");$.when(f.getUserAdID()).then(function(n){n!=""&&o()})}var e=this;e.securityGroupSelectorData={};e.dsUserGroupInfo=[];e.dsGroup=[];e.multiGroup=[];e.initSecurityGroup=y;e.GetSecurityGroupData=o;e.InitkGridGroupDetail=h;e.UpdateSecurityGroup=l;e.MemberOnChange=a;e.UpdatedUserGroupData=s}angular.module("SPOTApp").controller("SecurityGroupUsersCtrl",SecurityGroupUsersCtrl);SecurityGroupUsersCtrl.$inject=["$rootScope","$filter","$scope","$http","$q","GETPostService"];