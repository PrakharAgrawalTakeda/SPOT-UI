function ProjectCenterCtrl(n,t,i,r,u,f){function hr(){e.includeGridView==LocalAttributes?$("#gridPortfolioCenterProjLV").data("kendoGrid").dataSource.sort({}):e.includeGridView==CapitalPortfolioReport?$("#gridPortfolioCenterProjCapitalVw").data("kendoGrid").dataSource.sort({}):$("#gridPortfolioCenterProj").data("kendoGrid").dataSource.sort({})}function cr(n){trackEvent(n)}function lr(){trackEvent("Portfolio center budget/spend tile FxRates button");var n=$("#dialogFxRate");n.kendoWindow({content:"CurrencyFxRate.html?v="+buildNo,modal:!0});$.when(f.getCurrencyFxRate()).then(function(){n.data("kendoWindow").open()})}function oi(){trackEvent("Portfolio center budget/spend tile currency change");e.showLocalCur=e.PortfolioLocalCurrencyValue.LookUpMemberID==OKU_ID?!1:!0;e.showLocalCur==!0?($("#OKU_Div").hide(),$("#Local_Div").show()):($("#OKU_Div").show(),$("#Local_Div").hide())}function ar(){trackEvent("Portfolio center budget/spend tile - Forecast Bulk Edit");n.$emit("portfolioBudgetForecast",JSON.stringify(l))}function vr(){trackEvent("Portfolio center budget/spend tile - Forecast Excel Update");n.$emit("portfolioForecastExcelUpdate",JSON.stringify(l))}function a(n){n.element.length>0&&(n.element[0].id=="gridPortfolioCenterProj"?($("#scroller").remove(),n.wrapper.find(".k-grid-header").append(er),$("#scroller").width(n.wrapper.find(".k-grid-content").width()-parseInt(n.wrapper.find(".k-grid-header").css("padding-right"))),$("#scroller > div").width(n.wrapper.find(".k-grid-content tbody").width()),$("#gridPortfolioCenterProj .k-grid-content").scroll(function(){$("#scroller").scrollLeft($("#gridPortfolioCenterProj .k-grid-content").scrollLeft())}),$("#scroller").scroll(function(){$("#gridPortfolioCenterProj .k-grid-content").scrollLeft($("#scroller").scrollLeft())})):n.element[0].id=="gridPortfolioCenterProjCapitalVw"?($("#scrollerCap").remove(),n.wrapper.find(".k-grid-header").append(or),$("#scrollerCap").width(n.wrapper.find(".k-grid-content").width()-parseInt(n.wrapper.find(".k-grid-header").css("padding-right"))),$("#scrollerCap > div").width(n.wrapper.find(".k-grid-content tbody").width()),$("#gridPortfolioCenterProjCapitalVw .k-grid-content").scroll(function(){$("#scrollerCap").scrollLeft($("#gridPortfolioCenterProjCapitalVw .k-grid-content").scrollLeft())}),$("#scrollerCap").scroll(function(){$("#gridPortfolioCenterProjCapitalVw .k-grid-content").scrollLeft($("#scrollerCap").scrollLeft())})):n.element[0].id=="gridPortfolioCenterProjLV"&&($("#scrollerLv").remove(),n.wrapper.find(".k-grid-header").append(sr),$("#scrollerLv").width(n.wrapper.find(".k-grid-content").width()-parseInt(n.wrapper.find(".k-grid-header").css("padding-right"))),$("#scrollerLv > div").width(n.wrapper.find(".k-grid-content tbody").width()),$("#gridPortfolioCenterProjLV .k-grid-content").scroll(function(){$("#scrollerLv").scrollLeft($("#gridPortfolioCenterProjLV .k-grid-content").scrollLeft())}),$("#scrollerLv").scroll(function(){$("#gridPortfolioCenterProjLV .k-grid-content").scrollLeft($("#scrollerLv").scrollLeft())})))}function si(){var n,v,y,t,r,i,u,c;if(trackEvent("Portfolio center project view changed"),$("div").removeClass("fixed-header"),n=e.includeGridView,localStorage.selectedPortfolioGridView=n,n==LocalAttributes?(e.includeDefault=!1,e.includeLocal=!0,e.includeCapitalReport=!1,$("#gridPortfolioCenterProjLV").show(),$("#gridPortfolioCenterProjCapitalVw").hide(),$("#gridPortfolioCenterProj").hide()):n==CapitalPortfolioReport?(e.includeDefault=!1,e.includeLocal=!1,e.includeCapitalReport=!0,$("#gridPortfolioCenterProjLV").hide(),$("#gridPortfolioCenterProjCapitalVw").show(),$("#gridPortfolioCenterProj").hide()):(e.includeDefault=!0,e.includeLocal=!1,e.includeCapitalReport=!1,$("#gridPortfolioCenterProjLV").hide(),$("#gridPortfolioCenterProjCapitalVw").hide(),$("#gridPortfolioCenterProj").show()),e.includeDefault===!0&&ui===!1)tr(),ui=!0;else if(e.includeLocal==!0&&pi===!1)displayLoading(),v=JSON.stringify([]),$("#gridPortfolioCenterProjLV").show(),$.when(f.postDataWCFAsync("getAllProjectInfoWithLocalVar",l)).then(function(n){var t,i,u,e,r,s,c;try{t=JSON.parse(n);ei==!0&&d===!1&&($("#gridPortfolioCenterProjLV").kendoGrid("destroy").empty(),ei=!1,d===!1);d===!1?(i=col_PortfoliCenter_gridPortfolioCenterProjLocal(),t.length>0&&(u=wr(t).sort(),e=nonConsiderableColumnInPortfolioLocal.split(","),angular.forEach(u,function(n){var r,t;jQuery.inArray(n,e)==-1&&(r=i.filter(function(t){return t.field==n}),r.length==0&&(t={},t.field='["'+n+'"]',t.title=n,t.width=200,i.push(t)))})),rr=$("#gridPortfolioCenterProjLV").kendoGrid({columnShow:function(){a(this)},columnHiede:function(){a(this)},dataSource:{data:t,pageSize:100,sort:[{field:"OverallStatusOrder",dir:"asc"},{field:"ProjectNameWithoutPrefix",dir:"asc"}]},sortable:{mode:"multiple",allowUnsort:!0},filterable:!0,columnMenu:!0,reorderable:!0,resizable:!0,pageable:!0,columns:i,dataBound:function(){function i(){var i=parseInt(n.css("padding-right"));n.css("width",t.width()-i)}function u(){var r=$(this).scrollTop(),i=t.offset().top+n.height(),u=i+t.height()-n.height();r>=i?n.addClass("fixed-header"):n.removeClass("fixed-header")}var t=this.wrapper,n=t.find(".k-grid-header"),r;a(this);i();$(window).resize(i);$(window).scroll(u);r=this;$(".chartPercentageCompleteLv").each(function(){var t=$(this),i=t.closest("tr"),n=r.dataItem(i);t.kendoChart({series:[{type:"bullet",data:[[n.ActualCompletedMilestones,n.TargetToComplete]]}],chartArea:{margin:{left:0}},valueAxis:{min:0,max:n.TotalMilestone,line:{visible:!1},labels:{visible:!1},majorGridLines:{visible:!1}},tooltip:{visible:!0,template:"target: #= value.target # <br /> completed: #= value.current #"}})})},columnMenuInit:function(n){var i=n.container.find(".k-columns-item ul"),t=i.find("li");t.each(function(n,t){$(t).removeClass("k-first k-last")});t.sort(function(n,t){n=$(n);t=$(t);var i=n.find("input[data-field]").attr("title").indexOf(">")>1||n.find("input[data-field]").attr("data-field").indexOf("]")>1?n.find("input[data-field]").attr("data-field"):n.find("input[data-field]").attr("title"),r=t.find("input[data-field]").attr("title").indexOf(">")>1||t.find("input[data-field]").attr("data-field").indexOf("]")>1?t.find("input[data-field]").attr("data-field"):t.find("input[data-field]").attr("title");return i<r?-1:i>r?1:0});t.first().addClass("k-first");t.last().addClass("k-last");t.each(function(n,t){i.append($(t))})}}),d=!0,ei=!0):(r=new kendo.data.DataSource({data:t,pageSize:100,sort:[{field:"OverallStatusOrder",dir:"asc"},{field:"ProjectNameWithoutPrefix",dir:"asc"}]}),s=$("#gridPortfolioCenterProjLV").data("kendoGrid"),r.read(),s.setDataSource(r));hideLoading()}catch(h){hideLoading();c={method:"getGridViewProjects",exceptionMessage:"message:"+h.message+" stack:"+h.stack,ErrorParameter:o};$.when(f.postDataWCFAsync("WriteErrorLog",c)).then(function(){alert(errormessage)})}});else if(e.includeCapitalReport==!0&&fi===!1){displayLoading();y=JSON.stringify([]);$("#gridPortfolioCenterProjCapitalVw").show();try{t=[];angular.copy(s,t);wi===!1?(r=col_PortfoliCenter_gridPortfolioCenterProjCapitalView(),ur=$("#gridPortfolioCenterProjCapitalVw").kendoGrid({columnShow:function(){a(this)},columnHiede:function(){a(this)},dataSource:{data:t,pageSize:100,sort:[{field:"PortfolioOwnerName",dir:"asc"},{field:"AnnualForecastPerformanceAbsolute",dir:"desc"}]},sortable:{mode:"multiple",allowUnsort:!0},filterable:!0,columnMenu:!0,reorderable:!0,resizable:!0,pageable:!0,columns:r,dataBound:function(){function i(){var i=parseInt(n.css("padding-right"));n.css("width",t.width()-i)}function u(){var r=$(this).scrollTop(),i=t.offset().top+n.height(),u=i+t.height()-n.height();r>=i?n.addClass("fixed-header"):n.removeClass("fixed-header")}var t=this.wrapper,n=t.find(".k-grid-header"),r;a(this);i();$(window).resize(i);$(window).scroll(u);r=this;$(".chartPercentageCompleteCV").each(function(){var t=$(this),i=t.closest("tr"),n=r.dataItem(i);t.kendoChart({series:[{type:"bullet",data:[[n.ActualCompletedMilestones,n.TargetToComplete]]}],chartArea:{margin:{left:0}},valueAxis:{min:0,max:n.TotalMilestone,line:{visible:!1},labels:{visible:!1},majorGridLines:{visible:!1}},tooltip:{visible:!0,template:"target: #= value.target # <br /> completed: #= value.current #"}})})},columnMenuInit:function(n){var i=n.container.find(".k-columns-item ul"),t=i.find("li");t.each(function(n,t){$(t).removeClass("k-first k-last")});t.sort(function(n,t){n=$(n);t=$(t);var i=n.find("input[data-field]").attr("title").indexOf(">")>1||n.find("input[data-field]").attr("data-field").indexOf("]")>1?n.find("input[data-field]").attr("data-field"):n.find("input[data-field]").attr("title"),r=t.find("input[data-field]").attr("title").indexOf(">")>1||t.find("input[data-field]").attr("data-field").indexOf("]")>1?t.find("input[data-field]").attr("data-field"):t.find("input[data-field]").attr("title");return i<r?-1:i>r?1:0});t.first().addClass("k-first");t.last().addClass("k-last");t.each(function(n,t){i.append($(t))})}}),wi=!0):(i=new kendo.data.DataSource({data:t,pageSize:100,sort:[{field:"OverallStatusOrder",dir:"asc"},{field:"ProjectNameWithoutPrefix",dir:"asc"}]}),u=$("#gridPortfolioCenterProjCapitalVw").data("kendoGrid"),i.read(),u.setDataSource(i));hideLoading()}catch(h){hideLoading();c={method:"getCapitalViewProjects",exceptionMessage:"message:"+h.message+" stack:"+h.stack,ErrorParameter:o};$.when(f.postDataWCFAsync("WriteErrorLog",c)).then(function(){alert(errormessage)})}fi=!0}else $("div").removeClass("fixed-header")}function yr(){window.open(e.PortfolioPowerBIReport)}function pr(){window.open(e.SpotDataPowerBI)}function wr(n){var t=n[0];return Object.keys(t)}function lt(){var t=[],i="",n,u;try{n=[];$("#gridLocalAttributesFilter").data("kendoGrid")!=undefined?n=$("#gridLocalAttributesFilter").data("kendoGrid").dataSource.data():e.local!=null&&e.local!=undefined&&(n=e.local);angular.forEach(n,function(n){var i,r;(n.DataType=="Lookup"&&n.MultilocalVariableIDArray.length!=0||n.DataType=="People"&&n.localVariablepplID.length!=0||n.DataType=="Number"&&n.LocalVariableValue!==""&&n.LocalVariableValueRangeEnd!==""&&n.LocalVariableValue!==null&&n.LocalVariableValueRangeEnd!==null||n.DataType=="Date"&&n.LocalVariableValue!==""&&n.LocalVariableValueRangeEnd!==""&&n.LocalVariableValue!==null&&n.LocalVariableValueRangeEnd!==null||n.DataType==="Boolean"&&n.LocalVariableValue!==""&&n.LocalVariableValue!=="false"&&n.LocalVariableValue!==!1||n.DataType==="Text"&&n.LocalVariableValue!==""||n.DataType==="Text"&&n.isBlank===!0||n.DataType==="Text"&&n.isNotBlank===!0)&&(i="",n.DataType=="Lookup"?(angular.forEach(n.MultilocalVariableIDArray,function(n){i=i+","+n}),i=i.substring(1)):n.DataType=="Boolean"?i=n.LocalVariableValue==!0||n.LocalVariableValue=="true"?"Yes":"":n.DataType=="Date"?n.LocalVariableValue!=null&&n.LocalVariableValueRangeEnd!=null&&n.LocalVariableValue!==""&&n.LocalVariableValueRangeEnd!==""&&(i=kendo.toString(n.LocalVariableValue,"MM/dd/yyyy")+","+kendo.toString(n.LocalVariableValueRangeEnd,"MM/dd/yyyy")):n.DataType=="Number"?n.LocalVariableValue!=null&&n.LocalVariableValueRangeEnd!=null&&n.LocalVariableValue!==""&&n.LocalVariableValueRangeEnd!==""&&(i=kendo.toString(n.LocalVariableValue)+","+kendo.toString(n.LocalVariableValueRangeEnd)):n.DataType=="People"&&(angular.forEach(n.MultilocalVariableIDArray,function(n){i=i+","+n}),i=i.substring(1)),r={},r.LocalVariableUniqueID=n.LocalVariableUniqueID,r.DataType=n.DataType,r.LocalVariableFilterValue=n.DataType!="Text"?i:n.LocalVariableValue,r.LookupName=n.LookupName,r.isBlank=n.isBlank,r.isNotBlank=n.isNotBlank,t.push(r))})}catch(r){hideLoading();u={method:"UpdateFilter",exceptionMessage:"message:"+r.message+" stack:"+r.stack,ErrorParameter:o};$.when(f.postDataWCFAsync("WriteErrorLog",u)).then(function(){alert(errormessage)})}return i=JSON.stringify(t),localStorage.LocalCnt=t.length,i}function br(){var t,n,i,r,h,yt,u,c,s,l,a,v,y,p,b,k,d,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt,vt;try{t=[];n="";ir=[];i=e.selectedPortfolioOwnerfilter==undefined?"":e.selectedPortfolioOwnerfilter.join(",");r=e.selectedExecutionScopefilter==undefined||e.selectedExecutionScopefilter==null?"":e.selectedExecutionScopefilter.join(",");e.selectedExecutionScopefilter!=null&&(exScope=e.selectedExecutionScopefilter.length>1?e.selectedExecutionScopefilter.join(","):e.selectedExecutionScopefilter[0]);h="";h=r==""&&i==""?"":r==""?i:i==""?r:i+","+r;yt="";e.filterportfolioMultiselect="";e.filterpplMultiselect="";e.filterparentProgramSelect="";e.filterExecutionScopeMultiselect="";e.filterphaseMultiselect="";e.filterproductMultiselect="";e.filterprojStatusMultiselect="";e.filterCapexMultiselect="";e.filterGMSBudgetOwnerMultiselect="";e.filteroETypeMultiselect="";e.filterprojectTypeMultiselect="";e.filterparentProgramSelect="";e.filterFundingStatusMultiselect="";e.filterCapitalPhaseMultiselect="";e.filterOEPhaseMultiselect="";e.filterAGILEWorkstreamMultiselect="";e.filterAGILEWaveMultiselect="";e.filterPrimaryKPIMultiselect="";e.filterTOPSGroupMultiselect="";e.filterCAPSProjectMultiselect="";e.filterProjectProgramMultiselect="";e.filterStrategicYearMultiselect="";e.filterAnnualMustWinMultiselect="";u=$("#ddl_PortfolioOwnerFilterMain").data("kendoMultiSelect").dataItems();u.length>0&&(angular.forEach(u,function(n){e.filterportfolioMultiselect=e.filterportfolioMultiselect+","+n.LookUpMemberName}),e.filterportfolioMultiselect=e.filterportfolioMultiselect.substring(1));c=$("#PeopleFilter").data("kendoMultiSelect").dataItems();c.length>0&&(angular.forEach(c,function(n){e.filterpplMultiselect=e.filterpplMultiselect+","+n.UserDisplayName}),e.filterpplMultiselect=e.filterpplMultiselect.substring(1));s=$("#ddl_ExecutionScopeFilterMain").data("kendoMultiSelect").dataItems();s.length>0&&(angular.forEach(s,function(n){e.filterExecutionScopeMultiselect=e.filterExecutionScopeMultiselect+","+n.LookUpMemberName}),e.filterExecutionScopeMultiselect=e.filterExecutionScopeMultiselect.substring(1));l=$("#ddl_PhaseFilterMain").data("kendoMultiSelect").dataItems();l.length>0&&(angular.forEach(l,function(n){e.filterphaseMultiselect=e.filterphaseMultiselect+","+n.LookUpMemberName}),e.filterphaseMultiselect=e.filterphaseMultiselect.substring(1));a=$("#ProductFilter").data("kendoMultiSelect").dataItems();a.length>0&&(angular.forEach(a,function(n){e.filterproductMultiselect=e.filterproductMultiselect+","+n.LookUpMemberName}),e.filterproductMultiselect=e.filterproductMultiselect.substring(1));v=$("#ddl_ProjStatusFilterMain").data("kendoMultiSelect").dataItems();v.length>0&&(angular.forEach(v,function(n){e.filterprojStatusMultiselect=e.filterprojStatusMultiselect+","+n.LookUpMemberName}),e.filterprojStatusMultiselect=e.filterprojStatusMultiselect.substring(1));y=$("#ddl_CapexFilterMain").data("kendoMultiSelect").dataItems();y.length>0&&(angular.forEach(y,function(n){e.filterCapexMultiselect=e.filterCapexMultiselect+","+n.LookUpMemberName}),e.filterCapexMultiselect=e.filterCapexMultiselect.substring(1));p=$("#GMSBudgetOwnerFilter").data("kendoMultiSelect").dataItems();p.length>0&&(angular.forEach(p,function(n){e.filterGMSBudgetOwnerMultiselect=e.filterGMSBudgetOwnerMultiselect+","+n.LookUpMemberName}),e.filterGMSBudgetOwnerMultiselect=e.filterGMSBudgetOwnerMultiselect.substring(1));b=$("#ddl_OETypeFilterMain").data("kendoMultiSelect").dataItems();b.length>0&&(angular.forEach(b,function(n){e.filteroETypeMultiselect=e.filteroETypeMultiselect+","+n.LookUpMemberName}),e.filteroETypeMultiselect=e.filteroETypeMultiselect.substring(1));k=$("#ddl_ProjectTypeFilterMain").data("kendoMultiSelect").dataItems();k.length>0&&(angular.forEach(k,function(n){e.filterprojectTypeMultiselect=e.filterprojectTypeMultiselect+","+n.LookUpMemberName}),e.filterprojectTypeMultiselect=e.filterprojectTypeMultiselect.substring(1));d=$("#ddl_ParentProgramFilterMain").data("kendoMultiSelect").dataItems();d.length>0&&(angular.forEach(d,function(n){e.filterparentProgramSelect=e.filterparentProgramSelect+","+n.ProjectName}),e.filterparentProgramSelect=e.filterparentProgramSelect.substring(1));nt=$("#ddl_FundingStatusFilterMain").data("kendoMultiSelect").dataItems();nt.length>0&&(angular.forEach(nt,function(n){e.filterFundingStatusMultiselect=e.filterFundingStatusMultiselect+","+n.LookUpMemberName}),e.filterFundingStatusMultiselect=e.filterFundingStatusMultiselect.substring(1));tt=$("#ddl_CapPhaseFilterMain").data("kendoMultiSelect").dataItems();tt.length>0&&(angular.forEach(tt,function(n){e.filterCapitalPhaseMultiselect=e.filterCapitalPhaseMultiselect+","+n.CapitalPhaseName}),e.filterCapitalPhaseMultiselect=e.filterCapitalPhaseMultiselect.substring(1));it=$("#ddl_OEPhaseFilterMain").data("kendoMultiSelect").dataItems();it.length>0&&(angular.forEach(it,function(n){e.filterOEPhaseMultiselect=e.filterOEPhaseMultiselect+","+n.CapitalPhaseName}),e.filterOEPhaseMultiselect=e.filterOEPhaseMultiselect.substring(1));rt=$("#ddl_AGILEWorkstreamFilterMain").data("kendoMultiSelect").dataItems();rt.length>0&&(angular.forEach(rt,function(n){e.filterAGILEWorkstreamMultiselect=e.filterAGILEWorkstreamMultiselect+","+n.LookUpMemberName}),e.filterAGILEWorkstreamMultiselect=e.filterAGILEWorkstreamMultiselect.substring(1));ut=$("#ddl_AGILEWaveFilterMain").data("kendoMultiSelect").dataItems();ut.length>0&&(angular.forEach(ut,function(n){e.filterAGILEWaveMultiselect=e.filterAGILEWaveMultiselect+","+n.LookUpMemberName}),e.filterAGILEWaveMultiselect=e.filterAGILEWaveMultiselect.substring(1));ft=$("#ddl_PrimaryKPIFilterMain").data("kendoMultiSelect").dataItems();ft.length>0&&(angular.forEach(ft,function(n){e.filterPrimaryKPIMultiselect=e.filterPrimaryKPIMultiselect+","+n.LookUpMemberName}),e.filterPrimaryKPIMultiselect=e.filterPrimaryKPIMultiselect.substring(1));et=$("#ddl_TopsGroupFilterMain").data("kendoMultiSelect").dataItems();et.length>0&&(angular.forEach(et,function(n){e.filterTOPSGroupMultiselect=e.filterTOPSGroupMultiselect+","+n.LookUpMemberName}),e.filterTOPSGroupMultiselect=e.filterTOPSGroupMultiselect.substring(1));ot=$("#ddl_IsCAPSProjectFilterMain").data("kendoMultiSelect").dataItems();ot.length>0&&(angular.forEach(ot,function(n){e.filterCAPSProjectMultiselect=e.filterCAPSProjectMultiselect+","+n.LookUpMemberName}),e.filterCAPSProjectMultiselect=e.filterCAPSProjectMultiselect.substring(1));st=$("#ddl_StrategicYearFilterMain").data("kendoMultiSelect").dataItems();st.length>0&&(angular.forEach(st,function(n){e.filterStrategicYearMultiselect=e.filterStrategicYearMultiselect+","+n.LookUpMemberName}),e.filterStrategicYearMultiselect=e.filterStrategicYearMultiselect.substring(1));ht=$("#ddl_AnnualMustWinFilterMain").data("kendoMultiSelect").dataItems();ht.length>0&&(angular.forEach(ht,function(n){e.filterAnnualMustWinMultiselect=e.filterAnnualMustWinMultiselect+","+n.LookUpMemberName}),e.filterAnnualMustWinMultiselect=e.filterAnnualMustWinMultiselect.substring(1));ct=$("#ddl_ParentProgramFilterMain").data("kendoMultiSelect").dataItems();ct.length>0&&(angular.forEach(ct,function(n){e.filterProjectProgramMultiselect=e.filterProjectProgramMultiselect+","+n.ProjectName}),e.filterProjectProgramMultiselect=e.filterProjectProgramMultiselect.substring(1));(e.local==null||e.local==undefined||e.local==[]||e.local.length==0)&&(e.filterPortfolio!={}||angular.equals(u,ai)==!1||angular.equals(s,vi)==!1)?($.when(f.postDataWCFAsync("getLocalVariableForFilter",h)).then(function(i){var r,s;try{e.local=JSON.parse(i.getLocalVariableForFilterResult);w=1;e.local.length>0?(e.NoAttribute=!1,$.each(e.local,function(i,r){if(r.LookupName!=""){var u=$.grep(t,function(n){return r.LookupName===n.LookupName});u.length===0&&(t.push(r),n=n+","+r.LookupName)}r.MultilocalVariableIDArray=[];r.LocalVariableValueRangeEnd="";r.localVariablepplID=[];r.isBlank="";r.isNotBlank=""}),$.when(f.postDataWCFAsync("getLookupData",n.substring(1))).then(function(n){ni=JSON.parse(n.getLookupDataResult);g();var t=$("#dialogFilter");t.data("kendoWindow").open()})):(r=$("#dialogFilter"),r.data("kendoWindow").open())}catch(u){hideLoading();s={method:"getLocalAttributes",exceptionMessage:"message:"+u.message+" stack:"+u.stack,ErrorParameter:o};$.when(f.postDataWCFAsync("WriteErrorLog",s)).then(function(){alert(errormessage)})}}),angular.copy(u,ai),angular.copy(s,vi)):e.local!=null&&e.local!=undefined&&w==0&&e.local!=[]?(e.NoAttribute=!1,$.each(e.local,function(i,r){if(r.LookupName!=""){var u=$.grep(t,function(n){return r.LookupName===n.LookupName});u.length===0&&(t.push(r),n=n+","+r.LookupName)}}),$.when(f.postDataWCFAsync("getLookupData",n.substring(1))).then(function(n){ni=JSON.parse(n.getLookupDataResult);g();var t=$("#dialogFilter");t.data("kendoWindow").open()}),w=1):(lt=$("#dialogFilter"),lt.data("kendoWindow").open())}catch(at){hideLoading();vt={method:"getLocalAttributes",exceptionMessage:"message:"+at.message+" stack:"+at.stack,ErrorParameter:o};$.when(f.postDataWCFAsync("WriteErrorLog",vt)).then(function(){alert(errormessage)})}}function g(){var n,t,r;try{n=new kendo.data.DataSource({data:e.local,group:{field:"PortfolioOwner",dir:"asc"}});t=$("#gridLocalAttributesFilter").data("kendoGrid");n.read();t.setDataSource(n)}catch(i){r={method:"refreshLocalVarGrid",exceptionMessage:"message:"+i.message+" stack:"+i.stack,ErrorParameter:o};$.when(f.postDataWCFAsync("WriteErrorLog",r)).then(function(){alert(errormessage)})}}function kr(){var n,t,r;try{n=[{field:"PortfolioOwner",title:"PortfolioOwner",headerAttributes:{"class":"wrap-header"},hidden:!0,groupHeaderTemplate:"#= value #"},{field:"LocalVariableUniqueID",title:"LocalVariableUniqueID",hidden:!0},{field:"DataType",title:"Type",hidden:!0},{field:"LocalVariableName",title:"Local Variable Name"},{field:"LocalVariableValue",title:"Value",template:dr}];t=new kendo.data.DataSource({data:e.local,group:{field:"PortfolioOwner"},schema:{model:{id:"LocalVariableUniqueID",fields:{LocalVariableUniqueID:{editable:!1,nullable:!0},LocalVariableName:{type:"string",editable:!1},DataType:{type:"string",editable:!1}}}}});$("#gridLocalAttributesFilter").kendoGrid({dataSource:t,columns:n,dataBound:function(){var n=this,i,it,h,r,w,l,u,et,o;$("#gridLocalAttributesFilter .k-grid-content").on("change","input.chkbx",function(n){var i=$("#gridLocalAttributesFilter").data("kendoGrid"),t=i.dataItem($(n.target).closest("tr"));t!=undefined&&t.set("LocalVariableValue",this.checked)});$("#gridLocalAttributesFilter .k-grid-content").on("change","input.textbox",function(n){var i=$("#gridLocalAttributesFilter").data("kendoGrid"),t=i.dataItem($(n.target).closest("tr")[0]);t!=undefined&&(t.LocalVariableValue=this.value,t.isNotBlank=!1,t.isBlank=!1,t.dirty=!0)});$("#gridLocalAttributesFilter .k-grid-content").on("change","input.chkbxTxt",function(n){var i=$("#gridLocalAttributesFilter").data("kendoGrid"),t=i.dataItem($(n.target).closest("tr")[0]);t!=undefined&&(this.checked==!0?(t.set("LocalVariableValue",""),$(this).index()==1?(t.set("isBlank",this.checked),t.set("isNotBlank",!this.checked)):(t.set("isBlank",!this.checked),t.set("isNotBlank",this.checked))):$(this).index()==1?t.set("isBlank",this.checked):t.set("isNotBlank",this.checked))});$("#gridLocalAttributesFilter .k-grid-content").on("click","input.textbox",function(n){var i=$("#gridLocalAttributesFilter").data("kendoGrid"),t=i.dataItem($(n.target).closest("tr")[0]),r=$(this).parent().find(".chkbxTxt")[0],u=$(this).parent().find(".chkbxTxt")[1];t.isBlank=!1;t.isNotBlank=!1;t.dirty=!0;t.dirtyFields={isBlank:!0,isNotBlank:!0};r.checked=!1;u.checked=!1});var s=$(".date"),d=$(".dateValidationMsg"),g=$(".dateRangeEnd"),nt=$(".dateValidationRangeEndMsg");for(i=0;i<s.length;i++){var tt=$(s[i]),a=tt.closest("tr"),t=n.dataItem(a);$(s[i]).attr("id",t.uid.toString());$(d[i]).attr("id",t.uid.toString()+"Msg");$(g[i]).attr("id",t.uid.toString()+"RangeEnd");$(nt[i]).attr("id",t.uid.toString()+"RangeEndMsg");$("#"+t.uid).kendoDatePicker({parseFormats:["MM/dd/yyyy"],placeholder:e.dateFormatlabel,change:function(){var i=this.element.closest("tr"),t=n.dataItem(i),r=this.value()==null?"":kendo.toString(kendo.parseDate(new Date(this.value()),"yyyy-MM-dd"),"MM/dd/yyyy");t.set("LocalVariableValue",r);t.dirty=!0}});$("#"+t.uid).on("keydown",function(t){if(t.keyCode==8){var r=this.closest("tr"),i=n.dataItem(r);i.set("LocalVariableValue","");i.dirty=!0;t.target.value("")}else return!1});$("#"+t.uid+"RangeEnd").kendoDatePicker({parseFormats:["MM/dd/yyyy"],placeholder:e.dateFormatlabel,change:function(){var i=this.element.closest("tr"),t=n.dataItem(i),r=this.value()==null?"":kendo.toString(kendo.parseDate(new Date(this.value()),"yyyy-MM-dd"),"MM/dd/yyyy");t.set("LocalVariableValueRangeEnd",r);t.dirty=!0}});$("#"+t.uid+"RangeEnd").on("keydown",function(t){if(t.keyCode==8){var r=this.closest("tr"),i=n.dataItem(r);i.set("LocalVariableValueRangeEnd","");i.dirty=!0;t.target.value("")}else return!1});it=$("#"+t.uid).kendoValidator({rules:{datepicker:function(){var i=$("#"+t.uid).val(),r,u;parseDate(i)?(at=!0,$("#"+t.uid+"Msg").hide(),r=this.element.closest("tr"),u=n.dataItem(r),u.LocalVariableValue=i):($("#"+t.uid+"Msg").show(),at=!1)}}}).data("kendoValidator")}for($(".numeric0").kendoNumericTextBox({format:"n0",decimals:0,min:0,restrictDecimals:!0,max:999999999999,change:function(){var i=this.element.closest("tr"),t=n.dataItem(i);t.LocalVariableValue=this.value();t.dirty=!0}}),$(".numeric2").kendoNumericTextBox({format:"n2",decimals:2,min:0,restrictDecimals:!0,max:999999999999,change:function(){var i=this.element.closest("tr"),t=n.dataItem(i);t.LocalVariableValue=this.value();t.dirty=!0}}),$(".numeric4").kendoNumericTextBox({format:"n4",decimals:4,min:0,restrictDecimals:!0,max:999999999999,change:function(){var i=this.element.closest("tr"),t=n.dataItem(i);t.LocalVariableValue=this.value();t.dirty=!0}}),$(".numeric13").kendoNumericTextBox({format:"n13",decimals:13,min:0,restrictDecimals:!0,max:999999999999,change:function(){var i=this.element.closest("tr"),t=n.dataItem(i);t.LocalVariableValue=this.value();t.dirty=!0}}),$(".numericRangeEnd0").kendoNumericTextBox({format:"n0",decimals:0,min:0,restrictDecimals:!0,max:999999999999,change:function(){var i=this.element.closest("tr"),t=n.dataItem(i);t.LocalVariableValueRangeEnd=this.value();t.dirty=!0}}),$(".numericRangeEnd2").kendoNumericTextBox({format:"n2",decimals:2,min:0,restrictDecimals:!0,max:999999999999,change:function(){var i=this.element.closest("tr"),t=n.dataItem(i);t.LocalVariableValueRangeEnd=this.value();t.dirty=!0}}),$(".numericRangeEnd4").kendoNumericTextBox({format:"n4",decimals:4,min:0,restrictDecimals:!0,max:999999999999,change:function(){var i=this.element.closest("tr"),t=n.dataItem(i);t.LocalVariableValueRangeEnd=this.value();t.dirty=!0}}),$(".numericRangeEnd13").kendoNumericTextBox({format:"n13",decimals:13,min:0,restrictDecimals:!0,max:999999999999,change:function(){var i=this.element.closest("tr"),t=n.dataItem(i);t.LocalVariableValueRangeEnd=this.value();t.dirty=!0}}),$(".numeric").kendoNumericTextBox({min:"0",change:function(){var i=this.element.closest("tr"),t=n.dataItem(i);t.LocalVariableValue=this.value();t.dirty=!0}}),$(".numericRangeEnd").kendoNumericTextBox({min:"0",change:function(){var i=this.element.closest("tr"),t=n.dataItem(i);t.LocalVariableValueRangeEnd=this.value();t.dirty=!0}}),h=$(".dropdown"),r=0;r<h.length;r++){var v=$(h[r]),rt=v.closest("tr"),y=n.dataItem(rt),p,c,ut=ni.filter(function(n){return n.LookUpName==y.LookupName});p=new kendo.data.DataSource({data:ut});c="LookUpMemberName";w=y.MultilocalVariableIDArray;v.kendoMultiSelect({valuePrimitive:!0,dataTextField:c,dataValueField:c,dataSource:p,value:w,change:function(t){var r,i;if(t.sender.dataItem()==null||t.sender.dataItem()==undefined)r=this.element.closest("tr"),i=n.dataItem(r),i.dirty=!0,i.set("LocalVariableValue",""),i.set("MultilocalVariableIDArray",[]),$("#gridLocalAttributesFilter").data("kendoGrid").refresh();else{var r=this.element.closest("tr"),i=n.dataItem(r),f=this.value(),u=[];angular.forEach(f,function(n){u.push(n)});i.set("MultilocalVariableIDArray",u);i.dirty=!0}}})}for(l=$(".people"),u=0;u<l.length;u++){var ft=$(l[u]),a=ft.closest("tr"),t=n.dataItem(a),b=[],k=t.localVariablepplID;angular.forEach(k,function(n){b.push(n.UserADId)});et=f.searchPeopleMultiselect(t.uid,b,k);o=$("#"+t.uid).data("kendoMultiSelect");o.bind("change",function(){var f=this.value(),u=this.element.closest("tr"),t=n.dataItem(u),i=[],r=[];angular.forEach(this.dataItems(),function(n){i.push(n);r.push(n.UserADId)});t.set("localVariablepplID",i);t.set("MultilocalVariableIDArray",r);t.dirty=!0});o.setOptions({placeholder:"New Placeholder"});o._placeholder()}}})}catch(i){r={method:"InitkendoGridLocal",exceptionMessage:"message:"+i.message+" stack:"+i.stack,ErrorParameter:o};$.when(f.postDataWCFAsync("WriteErrorLog",r)).then(function(){alert(errormessage)})}}function dr(n){if(n==null)return"";switch(n.DataType){case"Date":return"<input class='date' value='"+n.LocalVariableValue+"' /><label class='dateValidationMsg' style='display:none;color:red'>"+e.dateErrorMsg+"<\/label><input class='dateRangeEnd' value='"+n.LocalVariableValueRangeEnd+"' /><label class='dateValidationRangeEndMsg' style='display:none;color:red'>"+e.dateErrorMsg+"<\/label>";case"Boolean":if(n.LocalVariableValue=="true"||n.LocalVariableValue==!0)return"<input type='checkbox' checked class='chkbx' />&nbsp Yes / No";if(n.LocalVariableValue==!1||n.LocalVariableValue=="false")return"<div class='fullWidthAttributes'><input type='checkbox' class='chkbx' />&nbsp Yes / No<\/div> ";break;case"Text":return n.isBlank==!0&&n.isNotBlank==!1?"<div class='fullWidthAttributes'><input class='textbox' value='"+n.LocalVariableValue+"'  /><input type='checkbox' class='chkbxTxt' checked /> Is blank <input type='checkbox' class='chkbxTxt' /> Is not blank<\/div>":n.isBlank==!1&&n.isNotBlank==!0?"<div class='fullWidthAttributes'><input class='textbox' value='"+n.LocalVariableValue+"' /><input type='checkbox' class='chkbxTxt' /> Is blank <input type='checkbox' class='chkbxTxt' checked /> Is not blank<\/div>":"<div class='fullWidthAttributes'><input class='textbox' value='"+n.LocalVariableValue+"' /><input type='checkbox' class='chkbxTxt' /> Is blank <input type='checkbox' class='chkbxTxt' /> Is not blank<\/div>";case"Number":switch(n.LineDecimalCount){case 0:return"<input class='numeric0' value='"+n.LocalVariableValue+"' /> <input class='numericRangeEnd0' value='"+n.LocalVariableValueRangeEnd+"' />";case 2:return"<input class='numeric2' value='"+n.LocalVariableValue+"' /> <input class='numericRangeEnd2' value='"+n.LocalVariableValueRangeEnd+"' />";case 4:return"<input class='numeric4' value='"+n.LocalVariableValue+"' /> <input class='numericRangeEnd4' value='"+n.LocalVariableValueRangeEnd+"' />";case 13:return"<input class='numeric13' value='"+n.LocalVariableValue+"' /> <input class='numericRangeEnd13' value='"+n.LocalVariableValueRangeEnd+"' />";default:return"<input class='numeric' value='"+n.LocalVariableValue+"' /> <input class='numericRangeEnd' value='"+n.LocalVariableValueRangeEnd+"' />"}case"Lookup":return"<div class='fullWidthAttributes'><input class='dropdown' value='"+n.MultilocalVariableIDArray+"' /><\/div>";case"People":return"<div class='fullWidthAttributes'><input class='people' value='"+n.localVariablepplID+"' id='"+n.uid+"'  /><\/div>";default:return n.LocalVariableValue}}function gr(){var n,t,r;try{e.selectedPortfolioOwnerfilter=null;e.selectedExecutionScopefilter=null;e.selectedProjectPhasefilter=null;e.selectedProjectCapPhasefilter=null;e.selectedProjectOEPhasefilter=null;e.objselectedProjectOEPhasefilter=null;e.objselectedProjectCapPhasefilter=null;e.selectedPrimaryProductfilter=null;e.selectedProjectStatusfilter=null;e.selectedCapexRangefilter=null;e.selectedGMSBudgetOwnerfilter=null;e.selectedOETypefilter=null;e.selectedProjectTypefilter=null;e.selectedFundingStatusfilter=null;e.selectedAGILEWorkstreamfilter=null;e.selectedAGILEWavefilter=null;e.selectedPrimaryKPIfilter=null;e.selectedTOPSGroupfilter=null;n=$("#PeopleFilter").data("kendoMultiSelect");t=$("#ddl_ParentProgramFilterMain").data("kendoMultiSelect");e.selectedPeoplefilter=[];e.selectedParentProgramfilter=[];e.selectedIsCAPSProjectfilter=null;e.selectedStrategicYearfilter=null;e.selectedAnnualMustWinfilter=null;n.value([]);t.value([]);e.local=[];w=0;g();e.mainFilterCount=0;e.parentProgramCount=0;e.LocalVariableCnt=0}catch(i){r={method:"clearFilter",exceptionMessage:"message:"+i.message+" stack:"+i.stack,ErrorParameter:o};$.when(f.postDataWCFAsync("WriteErrorLog",r)).then(function(){alert(errormessage)})}}function nu(){displayLoading();tr();hideLoading()}function ki(n){var hi,u,a,w,b,g,nt,tt,it,vi,ut,ft,et,ot,st,at,vt,yt,pt,wt,bt,kt,dt,t,gt,r,ni,ei,ci,ai;trackEvent("ApplyFilter"+n);$("div").removeClass("fixed-header");try{d=!1;ct=0;displayLoading();ui=!1;pi=!1;fi=!1;n=="Update"&&(ct=1,v=v==0?0:1,hi=$("#dialogFilter"),hi.data("kendoWindow").close(),rt=!1);ht===!0&&(rt=!1,e.includeLocal=!1,$("#gridPortfolioCenterProj").show(),y=y==0?0:1,p=p==0?0:1,ti=0,ii=0,ri=0,v=v==0?0:1,vi=[],et=e.includeChild,h="",c="",e.selectedExecutionScopefilter!=null&&(a=e.selectedExecutionScopefilter.length>1?e.selectedExecutionScopefilter.join(","):e.selectedExecutionScopefilter[0]),e.selectedProjectPhasefilter!=null&&(u=e.selectedProjectPhasefilter.length>1?e.selectedProjectPhasefilter.join(","):e.selectedProjectPhasefilter[0]),e.selectedPrimaryProductfilter!=null&&(w=e.selectedPrimaryProductfilter.length>1?e.selectedPrimaryProductfilter.join(","):e.selectedPrimaryProductfilter[0]),e.selectedProjectStatusfilter!=null&&(b=e.selectedProjectStatusfilter.length>1?e.selectedProjectStatusfilter.join(","):e.selectedProjectStatusfilter[0]),e.selectedCapexRangefilter!=null&&(it=e.selectedCapexRangefilter.length>1?e.selectedCapexRangefilter.join(","):e.selectedCapexRangefilter[0]),e.selectedGMSBudgetOwnerfilter!=null&&(g=e.selectedGMSBudgetOwnerfilter.length>1?e.selectedGMSBudgetOwnerfilter.join(","):e.selectedGMSBudgetOwnerfilter[0]),e.selectedOETypefilter!=null&&(nt=e.selectedOETypefilter.length>1?e.selectedOETypefilter.join(","):e.selectedOETypefilter[0]),e.selectedPortfolioOwnerfilter!=null&&(tt=e.selectedPortfolioOwnerfilter.length>1?e.selectedPortfolioOwnerfilter.join(","):e.selectedPortfolioOwnerfilter[0]),e.selectedProjectTypefilter!=null&&(ft=e.selectedProjectTypefilter.length>1?e.selectedProjectTypefilter.join(","):e.selectedProjectTypefilter[0]),e.selectedFundingStatusfilter!=null&&(ut=e.selectedFundingStatusfilter.length>1?e.selectedFundingStatusfilter.join(","):e.selectedFundingStatusfilter[0]),e.selectedProjectCapPhasefilter!=null&&(ot=e.selectedProjectCapPhasefilter.length>1?e.selectedProjectCapPhasefilter.join(","):e.selectedProjectCapPhasefilter[0]),e.selectedProjectOEPhasefilter!=null&&(st=e.selectedProjectOEPhasefilter.length>1?e.selectedProjectOEPhasefilter.join(","):e.selectedProjectOEPhasefilter[0]),e.selectedAGILEWorkstreamfilter!=null&&(at=e.selectedAGILEWorkstreamfilter.length>1?e.selectedAGILEWorkstreamfilter.join(","):e.selectedAGILEWorkstreamfilter[0]),e.selectedAGILEWavefilter!=null&&(vt=e.selectedAGILEWavefilter.length>1?e.selectedAGILEWavefilter.join(","):e.selectedAGILEWavefilter[0]),e.selectedPrimaryKPIfilter!=null&&(yt=e.selectedPrimaryKPIfilter.length>1?e.selectedPrimaryKPIfilter.join(","):e.selectedPrimaryKPIfilter[0]),e.selectedTOPSGroupfilter!=null&&(pt=e.selectedTOPSGroupfilter.length>1?e.selectedTOPSGroupfilter.join(","):e.selectedTOPSGroupfilter[0]),e.selectedIsCAPSProjectfilter!=null&&(wt=e.selectedIsCAPSProjectfilter.length>1?e.selectedIsCAPSProjectfilter.join(","):e.selectedIsCAPSProjectfilter[0]),e.selectedStrategicYearfilter!=null&&(kt=e.selectedStrategicYearfilter.length>1?e.selectedStrategicYearfilter.join(","):e.selectedStrategicYearfilter[0]),e.selectedAnnualMustWinfilter!=null&&(bt=e.selectedAnnualMustWinfilter.length>1?e.selectedAnnualMustWinfilter.join(","):e.selectedAnnualMustWinfilter[0]),dt=$("#ddl_ParentProgramFilterMain").data("kendoMultiSelect"),e.selectedParentProgramfilter=dt.dataItems(),t=dt.value(),t!=null&&t!=undefined&&t.length>0&&(c="",angular.forEach(t,function(n){c=c+","+n}),c=c.substring(1,c.length)),gt=$("#PeopleFilter").data("kendoMultiSelect"),r=gt.value(),e.selectedPeoplefilter=gt.dataItems(),r!=null&&r.length>0&&(h="",angular.forEach(r,function(n){h=h+","+n}),h=h.substring(1,h.length)),k=JSON.stringify([]),k=lt(),ni=[],$("#gridLocalAttributesFilter").data("kendoGrid")!=undefined&&(ni=$("#gridLocalAttributesFilter").data("kendoGrid").dataSource.data()),e.filterPortfolio={ExecutionScopeFilter:a,ProjectPhaseFilter:u,PrimaryProductfilter:w,ProjectStatusfilter:b,CapexRangefilter:it,GMSBudgetOwnerfilter:g,OETypefilter:nt,PortfolioOwnerfilter:tt,Peoplefilter:e.selectedPeoplefilter,ProjectTypefilter:ft,ParentProgramfilter:e.selectedParentProgramfilter,FundingStatusFilter:ut,LocalVariablefilter:ni,includeChild:et,CapitalPhaseFilter:ot,OEPhaseFilter:st,AglWrkStreamfilter:at,AglWavefilter:vt,PrimaryKPI:yt,TopsGroup:pt,IsCAPSProjectfilter:wt,annualMustWinfilter:bt,strategicYearfilter:kt},ei=[],ei.push(e.filterPortfolio),ci=JSON.stringify(ei),localStorage.myKeyFilter=ci,l={strUserAdId:currentUserId,strGMSBudgetOwnerfilter:g,strExecutionScopeFilter:a,strOETypefilter:nt,strProjectPhaseFilter:u,strProjectStatusfilter:b,strPrimaryProductfilter:w,strPortfolioOwnerfilter:tt,struserFilter:h,strCapexRangefilter:it,strProjectTypefilter:ft,strParentProgramfilter:c,strFundingStatusFilter:ut,strIncludeChild:et,objLocalVariable:k,strCapPhasefilter:ot,strOEPhasefilter:st,strAglWrkStreamfilter:at,strAglWavefilter:vt,strPrimaryKPI:yt,strTopsGroupfilter:pt,strIsCAPSProjectfilter:wt,strAnnualMustWinfilter:bt,strStrategicYearfilter:kt},$.when(f.postDataWCFAsync("getAllProjectInfo",l),f.postDataWCFAsync("getPortfolioCenterTileInfo",l),f.postDataWCFAsync("getPhasePriorityDataPortfolio",l)).then(function(n,t,r){var u,h,l;try{n!=undefined&&(s=JSON.parse(n),u=JSON.parse(t),e.tileInfo=u[0],e.ShowLocalDropDown=e.tileInfo.LocalCurrencyAbbreviation!=undefined&&e.tileInfo.LocalCurrencyAbbreviation!=OKU_Text?!0:!1,LocalCurrencyAbbreviationPortfolio=e.tileInfo.LocalCurrencyAbbreviation,showLocalCurrencyDdl=e.ShowLocalDropDown,e.OYAbbreviationPortfolio=OKU_Text,si(),h=JSON.parse(r),nr(h),e.PortfolioLocalCurrencyValue=e.tileInfo.LocalCurrencyAbbreviation==OKU_Text?e.PortfolioLocalCurrencyDS[1]:e.PortfolioLocalCurrencyDS[0],oi());e.searchButtonText="Apply";e.enable="true";i.$digest();hideLoading()}catch(c){hideLoading();l={method:"ApplyFilter",exceptionMessage:"message:"+c.message+" stack:"+c.stack,ErrorParameter:o};$.when(f.postDataWCFAsync("WriteErrorLog",l)).then(function(){alert(errormessage)});e.enable="true"}}))}catch(li){hideLoading();ai={method:"ApplyFilter",exceptionMessage:"message:"+li.message+" stack:"+li.stack,ErrorParameter:o};$.when(f.postDataWCFAsync("WriteErrorLog",ai)).then(function(){alert(errormessage)});e.enable="true"}}function tu(){var n=!1;console.log("Getting User Permission");$.when(f.postDataWCFAsync("getUserPermissionById",currentUserId)).then(function(t){var a,r,v,u,y,k;try{if(console.log("Message after User Permission"),a=JSON.parse(t.getUserPermissionByIdResult),a.length==0)window.location.href=errorPagePath;else if(angular.forEach(a,function(t){(t.Permission==viewProject||t.Permission==editProject)&&(n=!0);t.Permission==forecastBulkEdit&&(e.forecastBulkEdit=!0);t.Permission==forecastBulkEditExcel&&(e.forecastBulkEditExcel=!0)}),n==!1)window.location.href=errorPagePath;else{e.includeLocal=!1;r=new Date;console.log("Local storage call started "+r.toString());var d=projectPhase+","+portfolioOwner+","+projectStatus+","+GMSBudgetOwner+","+capexRange+","+oeProjectType+","+executionScope+","+product+","+fundingStatus+","+projectType+","+PortfolioLocalCurrency+","+agileWave+","+topsPrimaryKpi+","+TOPSRecommendedPriorityGroup+","+IsCAPSProject+","+strategicYear+","+portfolioAnnualMustWin,it=agileAttribute,p={};e.includeGridView=localStorage.selectedPortfolioGridView!==undefined&&localStorage.selectedPortfolioGridView!=null?localStorage.selectedPortfolioGridView:Default;v=localStorage.myKeyFilter;v?(p=JSON.parse(v),e.filterPortfolio=p[0],e.filterPortfolio!=undefined&&e.filterPortfolio!=null?(e.filterPortfolio.ExecutionScopeFilter!=null&&e.filterPortfolio.ExecutionScopeFilter!=undefined&&(e.selectedExecutionScopefilter=e.filterPortfolio.ExecutionScopeFilter.split(",")),e.filterPortfolio.ProjectPhaseFilter!=null&&e.filterPortfolio.ProjectPhaseFilter!=undefined&&(e.selectedProjectPhasefilter=e.filterPortfolio.ProjectPhaseFilter.split(",")),e.filterPortfolio.PrimaryProductfilter!=null&&e.filterPortfolio.PrimaryProductfilter!=undefined&&(e.selectedPrimaryProductfilter=e.filterPortfolio.PrimaryProductfilter.split(",")),e.filterPortfolio.ProjectStatusfilter!=null&&e.filterPortfolio.PrimaryProductfilter!=undefined&&(e.selectedProjectStatusfilter=e.filterPortfolio.ProjectStatusfilter.split(",")),e.filterPortfolio.CapexRangefilter!=null&&e.filterPortfolio.CapexRangefilter!=undefined&&(e.selectedCapexRangefilter=e.filterPortfolio.CapexRangefilter.split(",")),e.filterPortfolio.GMSBudgetOwnerfilter!=null&&e.filterPortfolio.GMSBudgetOwnerfilter!=undefined&&(e.selectedGMSBudgetOwnerfilter=e.filterPortfolio.GMSBudgetOwnerfilter.split(",")),e.filterPortfolio.OETypefilter!=null&&e.filterPortfolio.OETypefilter!=undefined&&(e.selectedOETypefilter=e.filterPortfolio.OETypefilter.split(",")),e.filterPortfolio.PortfolioOwnerfilter!=null&&e.filterPortfolio.PortfolioOwnerfilter!=undefined&&(e.selectedPortfolioOwnerfilter=e.filterPortfolio.PortfolioOwnerfilter.split(",")),e.filterPortfolio.ProjectTypefilter!=null&&e.filterPortfolio.ProjectTypefilter!=undefined&&(e.selectedProjectTypefilter=e.filterPortfolio.ProjectTypefilter.split(",")),e.filterPortfolio.FundingStatusFilter!=null&&e.filterPortfolio.FundingStatusFilter!=undefined&&(e.selectedFundingStatusfilter=e.filterPortfolio.FundingStatusFilter.split(",")),e.filterPortfolio.Peoplefilter!=null&&e.filterPortfolio.Peoplefilter!=undefined&&(e.selectedPeoplefilter=e.filterPortfolio.Peoplefilter,angular.forEach(e.selectedPeoplefilter,function(n){h=h+","+n.UserADId}),h=h.substring(1,h.length)),e.filterPortfolio.ParentProgramfilter!=null&&e.filterPortfolio.ParentProgramfilter!=undefined&&(e.selectedParentProgramfilter=e.filterPortfolio.ParentProgramfilter,angular.forEach(e.selectedParentProgramfilter,function(n){c=c+","+n.ProblemUniqueID}),c=c.substring(1,c.length)),e.filterPortfolio.CapitalPhaseFilter!=null&&e.filterPortfolio.CapitalPhaseFilter!=undefined&&(e.selectedProjectCapPhasefilter=e.filterPortfolio.CapitalPhaseFilter.split(",")),e.filterPortfolio.OEPhaseFilter!=null&&e.filterPortfolio.OEPhaseFilter!=undefined&&(e.selectedProjectOEPhasefilter=e.filterPortfolio.OEPhaseFilter.split(",")),e.includeChild=e.filterPortfolio.includeChild!=null?e.filterPortfolio.includeChild:!1,e.filterPortfolio.LocalVariablefilter!=null&&e.filterPortfolio.LocalVariablefilter!=undefined&&(e.local=e.filterPortfolio.LocalVariablefilter),e.filterPortfolio.AglWrkStreamfilter!=null&&e.filterPortfolio.AglWrkStreamfilter!=undefined&&(e.selectedAGILEWorkstreamfilter=e.filterPortfolio.AglWrkStreamfilter.split(",")),e.filterPortfolio.AglWavefilter!=null&&e.filterPortfolio.AglWavefilter!=undefined&&(e.selectedAGILEWavefilter=e.filterPortfolio.AglWavefilter.split(",")),e.filterPortfolio.PrimaryKPI!=null&&e.filterPortfolio.PrimaryKPI!=undefined&&(e.selectedPrimaryKPIfilter=e.filterPortfolio.PrimaryKPI.split(",")),e.filterPortfolio.TopsGroup!=null&&e.filterPortfolio.TopsGroup!=undefined&&(e.selectedTOPSGroupfilter=e.filterPortfolio.TopsGroup.split(",")),e.filterPortfolio.IsCAPSProjectfilter!=null&&e.filterPortfolio.IsCAPSProjectfilter!=undefined&&(e.selectedIsCAPSProjectfilter=e.filterPortfolio.IsCAPSProjectfilter.split(",")),e.filterPortfolio.annualMustWinfilter!=null&&e.filterPortfolio.annualMustWinfilter!=undefined&&(e.selectedAnnualMustWinfilter=e.filterPortfolio.annualMustWinfilter.split(",")),e.filterPortfolio.strategicYearfilter!=null&&e.filterPortfolio.strategicYearfilter!=undefined&&(e.selectedStrategicYearfilter=e.filterPortfolio.strategicYearfilter.split(",")),e.LocalVariableCnt=localStorage.LocalCnt!=null&&localStorage.LocalCnt!=undefined?localStorage.LocalCnt:0):(e.filterPortfolio.Peoplefilter=currentUserId,h=currentUserId,e.filterPortfolio.ProjectStatusfilter=activeStatus,u={},u.UserADId=currentUserId,u.UserDisplayName=currentUserName,e.selectedPeoplefilter.push(u),e.includeGridView=localStorage.selectedPortfolioGridView!==undefined&&localStorage.selectedPortfolioGridView!=null?localStorage.selectedPortfolioGridView:Default)):(h=currentUserId,e.filterPortfolio.Peoplefilter=currentUserId,e.filterPortfolio.ProjectStatusfilter=activeStatus,u={},u.UserADId=currentUserId,u.UserDisplayName=currentUserName,e.selectedPeoplefilter.push(u),e.includeGridView=localStorage.selectedPortfolioGridView!==undefined&&localStorage.selectedPortfolioGridView!=null?localStorage.selectedPortfolioGridView:Default);r=new Date;console.log("DB call started "+r.toString());y=JSON.stringify([]);y=lt();l={strUserAdId:currentUserId,strGMSBudgetOwnerfilter:e.filterPortfolio.GMSBudgetOwnerfilter,strExecutionScopeFilter:e.filterPortfolio.ExecutionScopeFilter,strOETypefilter:e.filterPortfolio.OETypefilter,strProjectPhaseFilter:e.filterPortfolio.ProjectPhaseFilter,strProjectStatusfilter:e.filterPortfolio.ProjectStatusfilter,strPrimaryProductfilter:e.filterPortfolio.PrimaryProductfilter,strPortfolioOwnerfilter:e.filterPortfolio.PortfolioOwnerfilter,struserFilter:h,strCapexRangefilter:e.filterPortfolio.CapexRangefilter,objLocalVariable:y,strFundingStatusfilter:e.filterPortfolio.FundingStatusfilter,strParentProgramfilter:c,strProjectTypefilter:e.filterPortfolio.ProjectTypefilter,strIncludeChild:e.filterPortfolio.includeChild,strCapPhasefilter:e.filterPortfolio.CapitalPhaseFilter,strOEPhasefilter:e.filterPortfolio.OEPhaseFilter,strAglWrkStreamfilter:e.filterPortfolio.AglWrkStreamfilter,strAglWavefilter:e.filterPortfolio.AglWavefilter,strPrimaryKPI:e.filterPortfolio.PrimaryKPI,strTopsGroupfilter:e.filterPortfolio.TopsGroup,strIsCAPSProjectfilter:e.filterPortfolio.IsCAPSProjectfilter,strAnnualMustWinfilter:e.filterPortfolio.annualMustWinfilter,strStrategicYearfilter:e.filterPortfolio.strategicYearfilter};$.when(f.postDataWCFAsync("getAllProjectInfo",l),f.postDataWCFAsync("getPortfolioCenterTileInfo",l),f.postDataWCFAsync("getLookupData",d),f.postDataWCFAsync("getLookupDataPerformancestatus",it),f.postDataWCFAsync("getPhasePriorityDataPortfolio",l),f.getDataWCF("getCapitalPhase")).then(function(n,t,u,c,l,a){var y,rt,ut,ft,p,et,ot,st,b,k,ht,ct,lt,at,wt,bt,kt,dt,gt,ni,ti,ii,ri,fi;try{r=new Date;console.log("DB call completed "+r.toString());console.log("Dropdown Binding Start "+r.toString());var ei=e.selectedPeoplefilter,it=[],oi=h.split(",");angular.forEach(oi,function(n){it.push(n)});e.selectedPeoplefilter=f.searchPeopleMultiselect("PeopleFilter",it,ei);y=$("#PeopleFilter").data("kendoMultiSelect");y.bind("change",function(){var n=this.value();e.mainFilterCount=n.length;i.$digest()});y.setOptions({placeholder:peoplepickerPlaceholderSmall});y._placeholder();rt=JSON.parse(u.getLookupDataResult).filter(function(n){return n.LookUpName==product});e.dsPrimaryProductMain={placeholder:"Select and/or Type to Search",dataTextField:"LookUpMemberName",dataValueField:"LookUpMemberID",valuePrimitive:!0,autoBind:!1,dataSource:rt,filter:"contains"};e.dsImpactedProducts={placeholder:"Select and/or Type to Search",dataTextField:"LookUpMemberName",dataValueField:"LookUpMemberID",valuePrimitive:!0,autoBind:!1,dataSource:e.dsPrimaryProduct,filter:"contains"};var v=JSON.parse(u.getLookupDataResult),hi=JSON.parse(c.getLookupDataPerformancestatusResult),ci=v.filter(function(n){return n.LookUpName==strategicYear}),li=v.filter(function(n){return n.LookUpName==annualMustWin});e.dsStrategicYearMain={placeholder:"Select and/or Type to Search",dataTextField:"LookUpMemberName",dataValueField:"LookUpMemberID",valuePrimitive:!0,autoBind:!1,dataSource:ci,filter:"contains"};e.dsAnnualMustWinMain={placeholder:"Select and/or Type to Search",dataTextField:"LookUpMemberName",dataValueField:"LookUpMemberID",valuePrimitive:!0,autoBind:!1,dataSource:li,filter:"contains"};ut=v.filter(function(n){return n.LookUpName==portfolioOwner});e.dsPortfolioOwnerMain={placeholder:"Select and/or Type to Search",dataTextField:"LookUpMemberName",dataValueField:"LookUpMemberID",valuePrimitive:!0,autoBind:!1,dataSource:ut,filter:"contains",change:function(){e.local=[];e.LocalVariableCnt=0;w=0;yi=1;g();i.$digest()}};ft=v.filter(function(n){return n.LookUpName==executionScope});e.dsExecutionScopeMainFilter={placeholder:"Select scope...",dataTextField:"LookUpMemberName",dataValueField:"LookUpMemberID",valuePrimitive:!0,autoBind:!1,dataSource:ft,filter:"contains",change:function(){e.local=[];e.LocalVariableCnt=0;w=0;yi=1;g();i.$digest()}};p=JSON.parse(a.getCapitalPhaseResult);vt=p.filter(function(n){return n.IsOEPhase==!0});yt=p.filter(function(n){return n.IsOEPhase==!1});et=v.filter(function(n){return n.LookUpName==projectPhase});e.dsProjectPhaseMain={placeholder:"Select and/or Type to Search",dataTextField:"LookUpMemberName",dataValueField:"LookUpMemberID",valuePrimitive:!0,autoBind:!1,dataSource:et,filter:"contains",change:function(){var r=[],u=[],n,t;tt=yt.filter(function(n){return e.selectedProjectPhasefilter.indexOf(n.AssociatedPhaseID)>-1});nt=vt.filter(function(n){return e.selectedProjectPhasefilter.indexOf(n.AssociatedPhaseID)>-1});n=$("#ddl_CapPhaseFilterMain").data("kendoMultiSelect");t=$("#ddl_OEPhaseFilterMain").data("kendoMultiSelect");r=n.dataItems();u=t.dataItems();e.selectedProjectCapPhasefilter=[];e.selectedProjectOEPhasefilter=[];angular.forEach(r,function(n){e.selectedProjectPhasefilter.indexOf(n.AssociatedPhaseID)>-1&&e.selectedProjectCapPhasefilter.push(n.CapitalPhaseID)});angular.forEach(u,function(n){e.selectedProjectPhasefilter.indexOf(n.AssociatedPhaseID)>-1&&e.selectedProjectOEPhasefilter.push(n.CapitalPhaseID)});n==undefined?gi():(n.setDataSource(tt),n.value(e.selectedProjectCapPhasefilter));t==undefined?di():(t.setDataSource(nt),t.value(e.selectedProjectOEPhasefilter));i.$digest()}};e.objselectedProjectCapPhasefilter=[];e.objselectedProjectOEPhasefilter=[];angular.forEach(yt,function(n){e.selectedProjectPhasefilter.indexOf(n.AssociatedPhaseID)>-1&&tt.push(n);e.selectedProjectCapPhasefilter.indexOf(n.CapitalPhaseID)>-1&&e.objselectedProjectCapPhasefilter.push(n)});angular.forEach(vt,function(n){e.selectedProjectPhasefilter.indexOf(n.AssociatedPhaseID)>-1&&nt.push(n);e.selectedProjectOEPhasefilter.indexOf(n.CapitalPhaseID)>-1&&e.objselectedProjectOEPhasefilter.push(n)});ot=$("#ddl_CapPhaseFilterMain").data("kendoMultiSelect");ot==undefined&&gi();st=$("#ddl_OEPhaseFilterMain").data("kendoMultiSelect");st==undefined&&di();b=v.filter(function(n){return n.LookUpName==projectStatus});e.dsProjectStatus={placeholder:"Select and/or Type to Search",dataTextField:"LookUpMemberName",dataValueField:"LookUpMemberID",valuePrimitive:!0,autoBind:!1,dataSource:b,filter:"contains"};(e.selectedProjectStatusfilter==undefined||e.selectedProjectStatusfilter==null||e.selectedProjectStatusfilter=="")&&(k=b.filter(function(n){return n.LookUpMemberID===e.filterPortfolio.ProjectStatusfilter}),k.length>0&&e.selectedProjectStatusfilter.push(k[0].LookUpMemberID));ht=v.filter(function(n){return n.LookUpName==GMSBudgetOwner});e.dsGMSBudgetOwnerMain={placeholder:"Select and/or Type to Search",dataTextField:"LookUpMemberName",dataValueField:"LookUpMemberID",valuePrimitive:!0,autoBind:!1,dataSource:ht,filter:"contains"};ct=v.filter(function(n){return n.LookUpName==capexRange});e.dsCapexRange={placeholder:"Select and/or Type to Search",dataTextField:"LookUpMemberName",dataValueField:"LookUpMemberID",valuePrimitive:!0,autoBind:!1,dataSource:ct,filter:"contains"};lt=v.filter(function(n){return n.LookUpName==oeProjectType});e.dsOETypeMain={placeholder:"Select and/or Type to Search",dataTextField:"LookUpMemberName",dataValueField:"LookUpMemberID",valuePrimitive:!0,autoBind:!1,dataSource:lt,filter:"contains"};at=v.filter(function(n){return n.LookUpName==projectType});e.dsProjectTypeMain={placeholder:"Select and/or Type to Search",dataTextField:"LookUpMemberName",dataValueField:"LookUpMemberID",valuePrimitive:!0,autoBind:!1,dataSource:at,filter:"contains"};var pt=[],d=e.selectedParentProgramfilter;e.selectedParentProgramfilter!=null&&e.selectedParentProgramfilter!=undefined&&(e.parentProgramCount=d.length,angular.forEach(d,function(n){pt.push(n)}));e.selectedParentProgramfilter=f.searchProjectParentMultiselect("ddl_ParentProgramFilterMain",pt,"ParentWithBudget",d,currentUserId);wt=$("#ddl_ParentProgramFilterMain").data("kendoMultiSelect");wt.bind("change",function(){var n=this.value();e.parentProgramCount=n.length;i.$digest()});bt=v.filter(function(n){return n.LookUpName==fundingStatus});e.dsFundingStatusMain={placeholder:"Select and/or Type to Search",dataTextField:"LookUpMemberName",dataValueField:"LookUpMemberID",valuePrimitive:!0,autoBind:!1,dataSource:bt,filter:"contains"};kt=hi.filter(function(n){return n.LookUpName==agileAttribute});e.dsAgileWorkStreamMain={placeholder:"Select and/or Type to Search",dataTextField:"LookUpMemberName",dataValueField:"LookUpMemberID",valuePrimitive:!0,autoBind:!1,dataSource:kt,filter:"contains"};dt=v.filter(function(n){return n.LookUpName==agileWave});e.dsAGILEWaveMain={placeholder:"Select and/or Type to Search",dataTextField:"LookUpMemberName",dataValueField:"LookUpMemberID",valuePrimitive:!0,autoBind:!1,dataSource:dt,filter:"contains"};gt=v.filter(function(n){return n.LookUpName==topsPrimaryKpi});e.dsPrimaryKPIMain={placeholder:"Select and/or Type to Search",dataTextField:"LookUpMemberName",dataValueField:"LookUpMemberID",valuePrimitive:!0,autoBind:!1,dataSource:gt,filter:"contains"};ni=v.filter(function(n){return n.LookUpName==TOPSRecommendedPriorityGroup});e.dsTopsGroupMain={placeholder:"Select and/or Type to Search",dataTextField:"LookUpMemberName",dataValueField:"LookUpMemberName",valuePrimitive:!0,autoBind:!1,dataSource:ni,filter:"contains"};e.PortfolioLocalCurrencyDS=v.filter(function(n){return n.LookUpName==PortfolioLocalCurrency});ti=v.filter(function(n){return n.LookUpName==IsCAPSProject});e.dsIsCAPSProjectMain={placeholder:"Select and/or Type to Search",dataTextField:"LookUpMemberName",dataValueField:"LookUpMemberID",valuePrimitive:!0,autoBind:!1,dataSource:ti,filter:"contains"};ii=JSON.parse(t);e.tileInfo=ii[0];r=new Date;console.log("Dropdown binding completed "+r.toString());console.log("Project Grid Creation Start "+r.toString());n!=undefined&&(s=JSON.parse(n));si();displayLoading();e.PortfolioLocalCurrencyValue=e.tileInfo.LocalCurrencyAbbreviation==OKU_Text?e.PortfolioLocalCurrencyDS[1]:e.PortfolioLocalCurrencyDS[0];e.ShowLocalDropDown=e.tileInfo.LocalCurrencyAbbreviation!=undefined&&e.tileInfo.LocalCurrencyAbbreviation!=OKU_Text?!0:!1;LocalCurrencyAbbreviationPortfolio=e.tileInfo.LocalCurrencyAbbreviation;showLocalCurrencyDdl=e.ShowLocalDropDown;e.OYAbbreviationPortfolio=OKU_Text;r=new Date;console.log("Project Grid Creation Complete "+r.toString());ri=JSON.parse(l);nr(ri);i.$digest();r=new Date;console.log("UI completed "+r.toString());hideLoading()}catch(ui){hideLoading();fi={method:"prepareDataForPortfolioCenter",exceptionMessage:"message:"+ui.message+" stack:"+ui.stack,ErrorParameter:o};$.when(f.postDataWCFAsync("WriteErrorLog",fi)).then(function(){alert(errormessage)})}})}kr();$("#dialogFilter").data("kendoWindow").bind("close",function(n){var u,f,r,o,t;if($("#gridLocalAttributesFilter").data("kendoGrid")!=undefined){for(u=$("#gridLocalAttributesFilter").data("kendoGrid").dataSource.data(),f=0,ht=!0,r=0,o=u.length;r<o;r++){if(t=u[r],t.DataType=="Number"&&(t.LocalVariableValue!==""&&t.LocalVariableValue!==null&&(t.LocalVariableValueRangeEnd===""||t.LocalVariableValueRangeEnd===null)||(t.LocalVariableValue===""||t.LocalVariableValue===null)&&t.LocalVariableValueRangeEnd!==""&&t.LocalVariableValueRangeEnd!==null)||t.DataType=="Date"&&(t.LocalVariableValue!==""&&t.LocalVariableValue!==null&&(t.LocalVariableValueRangeEnd===""||t.LocalVariableValueRangeEnd===null)||(t.LocalVariableValue===""||t.LocalVariableValue===null)&&t.LocalVariableValueRangeEnd!==""&&t.LocalVariableValueRangeEnd!==null)){alert(errorMessageForLimitSelection);n.preventDefault();ht=!1;hideLoading();break}(t.DataType=="Lookup"&&t.MultilocalVariableIDArray.length!=0||t.DataType=="People"&&t.localVariablepplID.length!=0||t.DataType=="Number"&&t.LocalVariableValue!==""&&t.LocalVariableValueRangeEnd!==""&&t.LocalVariableValue!==null&&t.LocalVariableValueRangeEnd!==null||t.DataType=="Date"&&t.LocalVariableValue!==""&&t.LocalVariableValueRangeEnd!==""&&t.LocalVariableValue!==null&&t.LocalVariableValueRangeEnd!==null||t.DataType==="Boolean"&&t.LocalVariableValue!==""&&t.LocalVariableValue!=="false"&&t.LocalVariableValue!==!1||t.DataType==="Text"&&t.LocalVariableValue!==""||t.DataType==="Text"&&t.isBlank===!0||t.DataType==="Text"&&t.isNotBlank===!0)&&f++}ht==!0&&(e.LocalVariableCnt=f,ct!=1&&i.$digest());ct=0}})}catch(b){hideLoading();k={method:"prepareDataForPortfolioCenter",exceptionMessage:"message:"+b.message+" stack:"+b.stack,ErrorParameter:o};$.when(f.postDataWCFAsync("WriteErrorLog",k)).then(function(){alert(errormessage)})}})}function di(){$("#ddl_OEPhaseFilterMain").kendoMultiSelect({placeholder:"Select and/or Type to Search",dataTextField:"CapitalPhaseName",dataValueField:"CapitalPhaseID",valuePrimitive:!0,autoBind:!1,dataSource:nt,filter:"contains",value:e.objselectedProjectOEPhasefilter,change:function(){var n=[];e.selectedProjectOEPhasefilter=[];e.objselectedProjectOEPhasefilter=[];n=$("#ddl_OEPhaseFilterMain")[0].selectedOptions;angular.forEach(n,function(n){e.selectedProjectOEPhasefilter.push(n.value);e.objselectedProjectOEPhasefilter.push(n)});i.$digest()}})}function gi(){$("#ddl_CapPhaseFilterMain").kendoMultiSelect({placeholder:"Select and/or Type to Search",dataTextField:"CapitalPhaseName",dataValueField:"CapitalPhaseID",valuePrimitive:!0,autoBind:!1,dataSource:tt,filter:"contains",value:e.objselectedProjectCapPhasefilter,change:function(){var n=[];e.selectedProjectCapPhasefilter=[];e.objselectedProjectCapPhasefilter=[];n=$("#ddl_CapPhaseFilterMain")[0].selectedOptions;angular.forEach(n,function(n){e.selectedProjectCapPhasefilter.push(n.value);e.objselectedProjectCapPhasefilter.push(n)});i.$digest()}})}function hi(){if(rt==!1){uu();displayLoading();k=lt();var n={strUserAdId:currentUserId,strGMSBudgetOwnerfilter:e.filterPortfolio.GMSBudgetOwnerfilter,strExecutionScopeFilter:e.filterPortfolio.ExecutionScopeFilter,strOETypefilter:e.filterPortfolio.OETypefilter,strProjectPhaseFilter:e.filterPortfolio.ProjectPhaseFilter,strProjectStatusfilter:e.filterPortfolio.ProjectStatusfilter,strPrimaryProductfilter:e.filterPortfolio.PrimaryProductfilter,strPortfolioOwnerfilter:e.filterPortfolio.PortfolioOwnerfilter,struserFilter:h,strCapexRangefilter:e.filterPortfolio.CapexRangefilter,objLocalVariable:k,strFundingStatusfilter:e.filterPortfolio.FundingStatusfilter,strParentProgramfilter:c,strProjectTypefilter:e.filterPortfolio.ProjectTypefilter,strIncludeChild:e.filterPortfolio.includeChild,strCapPhasefilter:e.filterPortfolio.CapitalPhaseFilter,strOEPhasefilter:e.filterPortfolio.OEPhaseFilter,strAglWrkStreamfilter:e.filterPortfolio.AglWrkStreamfilter,strAglWavefilter:e.filterPortfolio.AglWavefilter,strTopsGroupfilter:e.filterPortfolio.TOPSGroup},t=new Date;console.log("Milestone DB call started "+t.toString());$.when(f.postDataWCFAsync("getAllMilestonesPortfolioCenter",n),f.postDataWCFAsync("getRiskIssuePortfolio",n),f.postDataWCFAsync("getAskNeedPortfolio",n)).then(function(n,t,i){var r,u,a,e,v,s,y,h,p,c,w,l,b,d;try{r=JSON.parse(n);it=r.filter(function(n){return n.Late=="1"});li=r.filter(function(n){return n.PredictedLate=="1"});bt=r.filter(function(n){return n.Last3MonthsMilestonesCompleted=="1"});wt=r.filter(function(n){return n.Next3MonthsMilestonesCompleting=="1"});u=new kendo.data.DataSource({data:it,sort:{field:"Variance",dir:"desc"}});a=$("#gridLateMilestonePopUp").data("kendoGrid");u.read();a.setDataSource(u);e=new kendo.data.DataSource({data:li,sort:{field:"Variance",dir:"desc"}});v=$("#gridPreLateMilestonePopUp").data("kendoGrid");e.read();v.setDataSource(e);s=new kendo.data.DataSource({data:wt,sort:[{field:"BaselineFinish",dir:"asc"},{field:"PlannedFinish",dir:"asc"}]});y=$("#gridNxtThreeMnthsMilestonePopUp").data("kendoGrid");s.read();y.setDataSource(s);h=new kendo.data.DataSource({data:bt,sort:{field:"CompletionDate",dir:"desc"}});p=$("#gridLstThreeMnthsMileCompletedPopUp").data("kendoGrid");h.read();p.setDataSource(h);dt=JSON.parse(t);gt=JSON.parse(i);c=new kendo.data.DataSource({data:dt,sort:{field:"DueDate",dir:"asc"}});w=$("#gridNxtThreeMnthsRiskIssue").data("kendoGrid");c.read();w.setDataSource(c);l=new kendo.data.DataSource({data:gt,sort:{field:"NeedByDate",dir:"asc"}});b=$("#gridNxtThreeMnthsAskNeed").data("kendoGrid");l.read();b.setDataSource(l);hideLoading()}catch(k){hideLoading();d={method:"getMilestoneData",exceptionMessage:"message:"+k.message+" stack:"+k.stack,ErrorParameter:o};$.when(f.postDataWCFAsync("WriteErrorLog",d)).then(function(){alert(errormessage)})}});rt=!0}}function nr(n){var r=new Date,u,f,i;console.log("UpdateDataWithFiltered Started"+r.toString());u=n.filter(function(n){return n.DateType=="Phase"});f=n.filter(function(n){return n.DateType=="Priority"});pt=[];angular.forEach(f,function(n){var t={};t={name:n.name,data:[n.data],color:n.color};pt.push(t)});b=[];angular.forEach(u,function(n){i={};kt[n.name]=[];kt[n.name]=t("orderBy")(s.filter(function(t){return t.Phase==n.name}),"-daysInPhase");i.PhaseName=n.name;i.ProjectCnt=n.data;b.push(i)});ou(pt);eu(b);r=new Date;console.log("UpdateDataWithFiltered Completed"+r.toString())}function iu(){var n,t;trackEvent("Portfolio center priority tile");displayLoading();n=$("#dialog");n.data("kendoWindow").open();ii==0&&(t=col_PortfolioCenter_gridPriorityPopUp(),$("#gridPriorityPopUp").kendoGrid({dataSource:{data:s,sort:[{field:"OverallStatusOrder",dir:"asc"},{field:"ProjectNameWithoutPrefix",dir:"asc"}]},height:370,sortable:!0,schema:{model:{fields:{Tops:{type:"string"},Phase:{type:"string"},ProblemID:{type:"string"},BudgetID:{type:"string"},ProjectName:{type:"string"},OverallStatus:{type:"string"},PortfolioOwnerName:{type:"string"},PM:{type:"string"},DataFreshness:{type:"string"},ProjectNameWithoutPrefix:{type:"string"}}}},columns:t}),ii=1);hideLoading()}function tr(){var n,i,t,r,e;try{n=new Date;console.log("getting column "+n.toString());i=col_PortfoliCenter_gridPortfolioCenterProj();n=new Date;console.log("getting column completed"+n.toString());console.log("grid binding started"+n.toString());bi==!1?(fr=$("#gridPortfolioCenterProj").kendoGrid({columnShow:function(){a(this)},columnHiede:function(){a(this)},dataSource:{data:s,pageSize:100,sort:[{field:"OverallStatusOrder",dir:"asc"},{field:"ProjectNameWithoutPrefix",dir:"asc"}]},columns:i,sortable:{mode:"multiple",allowUnsort:!0},filterable:!0,columnMenu:!0,reorderable:!0,resizable:!0,pageable:!0,schema:{model:{fields:{ProjectName:{type:"string"},OverallStatus:{type:"string"},Tops:{type:"string"},Phase:{type:"string"},PM:{type:"string"},Sponsor:{type:"string"},ScheduleIndicator:{type:"string"},RiskIndicator:{type:"string"},BudgetIndicator:{type:"string"},AskNeedIndicator:{type:"string"},ApprovedAmount:{type:"string"},NextMilestone:{type:"string"},ProjectNameWithoutPrefix:{type:"string"}}}},dataBound:function(){function r(){var n=parseInt(t.css("padding-right"));t.css("width",i.width()-n)}function f(){var r=$(this).scrollTop(),n=i.offset().top+t.height(),u=n+i.height()-t.height();r>=n?t.addClass("fixed-header"):t.removeClass("fixed-header")}var u;n=new Date;console.log("databound started "+n.toString());var i=this.wrapper,t=i.find(".k-grid-header"),e=i.find(".k-grid-pager");a(this);r();$(window).resize(r);$(window).scroll(f);u=this;$(".chartPercentageComplete").each(function(){var t=$(this),i=t.closest("tr"),n=u.dataItem(i);t.kendoChart({series:[{type:"bullet",data:[[n.ActualCompletedMilestones,n.TargetToComplete]]}],chartArea:{margin:{left:0}},valueAxis:{min:0,max:n.TotalMilestone,line:{visible:!1},labels:{visible:!1},majorGridLines:{visible:!1}},tooltip:{visible:!0,template:"target: #= value.target # <br /> completed: #= value.current #"}})})},columnMenuInit:function(n){var i=n.container.find(".k-columns-item ul"),t=i.find("li");t.each(function(n,t){$(t).removeClass("k-first k-last")});t.sort(function(n,t){n=$(n);t=$(t);var i=n.find("input[data-field]").attr("title").indexOf(">")>1||n.find("input[data-field]").attr("data-field").indexOf("]")>1?n.find("input[data-field]").attr("data-field"):n.find("input[data-field]").attr("title"),r=t.find("input[data-field]").attr("title").indexOf(">")>1||t.find("input[data-field]").attr("data-field").indexOf("]")>1?t.find("input[data-field]").attr("data-field"):t.find("input[data-field]").attr("title");return i<r?-1:i>r?1:0});t.first().addClass("k-first");t.last().addClass("k-last");t.each(function(n,t){i.append($(t))})}}),bi=!0):(t=new kendo.data.DataSource({data:s,pageSize:100,sort:[{field:"OverallStatusOrder",dir:"asc"},{field:"ProjectNameWithoutPrefix",dir:"asc"}]}),r=$("#gridPortfolioCenterProj").data("kendoGrid"),t.read(),r.setDataSource(t));$("#gridPortfolioCenterProj").kendoTooltip({filter:"td:nth-child(1)",content:function(n){var t=$("#gridPortfolioCenterProj").data("kendoGrid").dataItem(n.target.closest("tr"));return t.DataFreshness==""?"":t.DataFreshness+" Days"}}).data("kendoTooltip");$("#gridPortfolioCenterProj th:nth-child(1) a:nth-child(1)").hide();n=new Date;console.log("databound finish "+n.toString())}catch(u){hideLoading();e={method:"InitKendoGridProj",exceptionMessage:"message:"+u.message+" stack:"+u.stack,ErrorParameter:o};$.when(f.postDataWCFAsync("WriteErrorLog",e)).then(function(){alert(errormessage)})}}function ru(){var t=$("#milestoneTile").kendoTabStrip().data("kendoTabStrip"),i=t.select()[0].textContent,n;trackEvent("Portfolio center Milestone performance Tile");trackEvent("Portfolio center milestone performance tile - "+i);hi();ri==0&&(ri=1);n=$("#dialogMile");n.data("kendoWindow").open()}function uu(){var n=col_PortfolioCenter_gridLateMilestonePopUp(),t,i,r;$("#gridLateMilestonePopUp").kendoGrid({dataSource:it,height:190,sortable:!0,schema:{model:{fields:{StatusIndicator:{type:"string"},Milestone:{type:"string"},ProjectName:{type:"string"},FunctionalGroupOwner:{type:"string"},BaselineFinish:{type:"date"},PlannedFinish:{type:"date"}}}},columns:n});$("#gridPreLateMilestonePopUp").kendoGrid({dataSource:it,height:190,sortable:!0,schema:{model:{fields:{Milestone:{type:"string"},ProjectName:{type:"string"},FunctionalGroupOwner:{type:"string"},BaselineFinish:{type:"date"},PlannedFinish:{type:"date"}}}},columns:n});t=ds_PortfolioCenter_gridNxtThreeMnthsMilestonePopUp(wt);n=col_PortfolioCenter_gridNxtThreeMnthsMilestonePopUp();$("#gridNxtThreeMnthsMilestonePopUp").kendoGrid({dataSource:t,columns:n,height:300,sortable:!0});i=col_PortfolioCenter_gridLstThreeMnthsMileCompletedPopUp();r=ds_PortfolioCenter_gridLstThreeMnthsMileCompletedPopUp(bt);$("#gridLstThreeMnthsMileCompletedPopUp").kendoGrid({dataSource:r,height:250,groupable:!1,sortable:!0,columns:i});$("#gridNxtThreeMnthsRiskIssue").kendoGrid({dataSource:{data:dt,sort:{field:"DueDate",dir:"asc"}},sortable:!0,height:300,schema:{model:{fields:{StatusIndicator:{type:"string"},DueDate:{type:"string"},IfHappens:{type:"string"},RiskIssueTypeID:{type:"string"},RiskIssueResult:{type:"string"},Mitigation:{type:"string"},OwnerName:{type:"string"},FunctionGroup:{type:"string"}}}},columns:[{template:"",field:"StatusIndicator",title:" ",width:"1%",attributes:{"class":"#:StatusIndicator#"}},{template:"#if(linkLevel>0) {#<span class='k-icon k-i-link-vertical'><\/span>#}#",title:" ",width:"4%"},{field:"ProjectName",title:"Project Name",width:"25%",template:"<a href='${navigateHubUrl}' target='_blank'>#: ProjectName #<\/a>"},{field:"PM",title:"Project Manager",width:"20%"},{field:"RiskIssueTypeName",title:"Type",width:"10%"},{field:"IfHappens",title:"If This Happens",headerAttributes:{"class":"wrap-header"},width:"30%"},{field:"DueDate",title:"Due Date",headerAttributes:{"class":"wrap-header"},width:"10%",template:"#= DueDate ==null ? '' :  kendo.toString(kendo.parseDate(new Date(DueDate), 'yyyy-MM-dd'), 'dd-MMM-yy') #"}],detailTemplate:kendo.template($("#riskIssuedetail-template").html())});$("#gridNxtThreeMnthsAskNeed").kendoGrid({dataSource:{data:gt,sort:{field:"NeedByDate",dir:"asc"}},sortable:!0,height:300,schema:{model:{fields:{StatusIndicator:{type:"string"},AskNeed:{type:"string"},NeedFromName:{type:"string"},NeedByDate:{type:"date"},Comments:{type:"string"}}}},columns:[{template:"",field:"StatusIndicator",title:" ",width:"1%",attributes:{"class":"#:StatusIndicator#"}},{template:"#if(linkLevel>0) {#<span class='k-icon k-i-link-vertical'><\/span>#}#",title:" ",width:"4%"},{field:"ProjectName",title:"Project Name",width:"25%",template:"<a href='${navigateHubUrl}' target='_blank'>#: ProjectName #<\/a>"},{field:"PM",title:"Project Manager",width:"20%"},{field:"AskNeed",title:"Ask or Need",width:"25%"},{field:"NeedFromName",title:"Need From"},{field:"NeedByDate",title:"Need Date",template:"#= NeedByDate ==null ? '' : kendo.toString(kendo.parseDate(new Date(NeedByDate), 'yyyy-MM-dd'), 'dd-MMM-yy') #"}],detailTemplate:kendo.template($("#askNNeed-template").html())})}function fu(){var u=$("#nextThreeMonthTab").kendoTabStrip().data("kendoTabStrip"),f=u.select()[0].textContent,t,n,i,r;trackEvent("Portfolio center next three month tile");trackEvent("Portfolio center next three month tile - "+f);hi();y==0?(ut=s.filter(function(n){return n.Next3MonthsProjectCompleting=="1"}),n=ds_PortfolioCenter_gridNxtThreeMnthsProjectPopUp(ut),t=col_PortfolioCenter_gridNxtThreeMnthsProjectPopUp(),$("#gridNxtThreeMnthsProjectPopUp").kendoGrid({dataSource:n,columns:t,height:300,groupable:!1,sortable:!0}),y=1):y==1&&(ut=s.filter(function(n){return n.Next3MonthsProjectCompleting=="1"}),n=ds_PortfolioCenter_gridNxtThreeMnthsProjectPopUp(ut),i=$("#gridNxtThreeMnthsProjectPopUp").data("kendoGrid"),n.read(),i.setDataSource(n),y=2);r=$("#dialogNxtMnth");r.data("kendoWindow").open()}function eu(){$("#PhaseChartMain").kendoChart({dataSource:{data:b},legend:{visible:!1},seriesDefaults:{type:"column",labels:{visible:!0,background:"transparent"}},series:[{field:"ProjectCnt",categoryField:"PhaseName",color:"#7d7d7d"}],valueAxis:{majorGridLines:{visible:!1},visible:!1},categoryAxis:{majorGridLines:{visible:!1},line:{visible:!1}}});$("#PhaseChartPop").kendoChart({dataSource:{data:b},legend:{visible:!1},seriesDefaults:{type:"column",labels:{visible:!0,background:"transparent"}},series:[{field:"ProjectCnt",categoryField:"PhaseName",color:"#7d7d7d"}],valueAxis:{majorGridLines:{visible:!1},visible:!1},categoryAxis:{majorGridLines:{visible:!1},line:{visible:!1}}})}function ou(n){$("#PriorityChart").kendoChart({legend:{position:"bottom"},seriesDefaults:{type:"bar",stack:{type:"100%"}},series:n,valueAxis:{majorGridLines:{visible:!1},visible:!1},categoryAxis:{categories:[2012],majorGridLines:{visible:!1},visible:!1},tooltip:{visible:!0,template:"TOPS Group: #= series.name # <br /> Projects in that group: #= series.data #"}});$("#PriorityChartPopUp").kendoChart({legend:{position:"right"},seriesDefaults:{type:"bar",stack:{type:"100%"}},series:n,valueAxis:{majorGridLines:{visible:!1},visible:!1},categoryAxis:{categories:[2012],majorGridLines:{visible:!1},visible:!1},tooltip:{visible:!0,template:"TOPS Group: #= series.name # <br /> Projects in that group: #= series.data[0] #"}})}function su(){var t,i,u,s;trackEvent("Portfolio center phase tile");displayLoading();try{if(ti==0){var n=kt,h=Math.max(n.Initiate.length,n.Define.length,n.Plan.length,n.Execute.length,n.Close.length,n.Track.length),r=[];for(t=0;t<h;t+=1)i={},n.Initiate.length>t?(i.Initiate=n.Initiate[t]!=undefined?n.Initiate[t].ProjectName.substring(0,60):"",i.IPhaseName=n.Initiate[t].CapitalPhaseName,i.IDays=n.Initiate[t].daysInPhase+" d",i.IIcon=n.Initiate[t].OverallStatusArrow=="RedDown"?"k-icon k-i-arrow-down arrow arrow-red":n.Initiate[t].OverallStatusArrow=="RedStop"?"k-icon k-i-stop arrow-red":n.Initiate[t].OverallStatusArrow=="GreenStop"?"k-icon k-i-stop arrow-green":n.Initiate[t].OverallStatusArrow=="GreenUp"?"k-icon k-i-arrow-up arrow arrow-green":n.Initiate[t].OverallStatusArrow=="YellowStop"?"k-icon k-i-stop arrow-yellow":n.Initiate[t].OverallStatusArrow=="YellowUp"?"k-icon k-i-arrow-up arrow arrow-yellow":n.Initiate[t].OverallStatusArrow=="YellowDown"?"k-icon k-i-arrow-down arrow-yellow":"k-icon k-i-stop arrow-grey",i.IStatus="<span class='k-icon k-i-arrow-60-right'><\/span>"+n.Initiate[t].ProjStatus):(i.Initiate="",i.IPhaseName="",i.IDays="",i.IIcon="",i.IStatus=""),n.Define.length>t?(i.Define=n.Define[t]!=undefined?n.Define[t].ProjectName.substring(0,60):"",i.DPhaseName=n.Define[t].CapitalPhaseName,i.DDays=n.Define[t].daysInPhase+" d",i.DIcon=n.Define[t].OverallStatusArrow=="RedDown"?"k-icon k-i-arrow-down arrow arrow-red":n.Define[t].OverallStatusArrow=="RedStop"?"k-icon k-i-stop arrow-red":n.Define[t].OverallStatusArrow=="GreenStop"?"k-icon k-i-stop arrow-green":n.Define[t].OverallStatusArrow=="GreenUp"?"k-icon k-i-arrow-up arrow arrow-green":n.Define[t].OverallStatusArrow=="YellowStop"?"k-icon k-i-stop arrow-yellow":n.Define[t].OverallStatusArrow=="YellowUp"?"k-icon k-i-arrow-up arrow arrow-yellow":n.Define[t].OverallStatusArrow=="YellowDown"?"k-icon k-i-arrow-down arrow-yellow":"k-icon k-i-stop arrow-grey",i.DStatus="<span class='k-icon k-i-arrow-60-right'><\/span>"+n.Define[t].ProjStatus):(i.Define="",i.DPhaseName="",i.DDays="",i.DIcon="",i.DStatus=""),n.Plan.length>t?(i.Plan=n.Plan[t]!=undefined?n.Plan[t].ProjectName.substring(0,60):"",i.PPhaseName=n.Plan[t].CapitalPhaseName,i.PDays=n.Plan[t].daysInPhase+" d",i.PIcon=n.Plan[t].OverallStatusArrow=="RedDown"?"k-icon k-i-arrow-down arrow arrow-red":n.Plan[t].OverallStatusArrow=="RedStop"?"k-icon k-i-stop arrow-red":n.Plan[t].OverallStatusArrow=="GreenStop"?"k-icon k-i-stop arrow-green":n.Plan[t].OverallStatusArrow=="GreenUp"?"k-icon k-i-arrow-up arrow arrow-green":n.Plan[t].OverallStatusArrow=="YellowStop"?"k-icon k-i-stop arrow-yellow":n.Plan[t].OverallStatusArrow=="YellowUp"?"k-icon k-i-arrow-up arrow arrow-yellow":n.Plan[t].OverallStatusArrow=="YellowDown"?"k-icon k-i-arrow-down arrow-yellow":"k-icon k-i-stop arrow-grey",i.PStatus="<span class='k-icon k-i-arrow-60-right'><\/span>"+n.Plan[t].ProjStatus):(i.Plan="",i.PPhaseName="",i.PDays="",i.PIcon="",i.PStatus=""),n.Execute.length>t?(i.Execute=n.Execute[t]!=undefined?n.Execute[t].ProjectName.substring(0,60):"",i.EPhaseName=n.Execute[t].CapitalPhaseName,i.EDays=n.Execute[t].daysInPhase+" d",i.EIcon=n.Execute[t].OverallStatusArrow=="RedDown"?"k-icon k-i-arrow-down arrow arrow-red":n.Execute[t].OverallStatusArrow=="RedStop"?"k-icon k-i-stop arrow-red":n.Execute[t].OverallStatusArrow=="GreenStop"?"k-icon k-i-stop arrow-green":n.Execute[t].OverallStatusArrow=="GreenUp"?"k-icon k-i-arrow-up arrow arrow-green":n.Execute[t].OverallStatusArrow=="YellowStop"?"k-icon k-i-stop arrow-yellow":n.Execute[t].OverallStatusArrow=="YellowUp"?"k-icon k-i-arrow-up arrow arrow-yellow":n.Execute[t].OverallStatusArrow=="YellowDown"?"k-icon k-i-arrow-down arrow-yellow":"k-icon k-i-stop arrow-grey",i.EStatus="<span class='k-icon k-i-arrow-60-right'><\/span>"+n.Execute[t].ProjStatus):(i.Execute="",i.EPhaseName="",i.EDays="",i.EIcon="",i.EStatus=""),n.Close.length>t?(i.Close=n.Close[t]!=undefined?n.Close[t].ProjectName.substring(0,60):"",i.CPhaseName=n.Close[t].CapitalPhaseName,i.CDays=n.Close[t].daysInPhase+" d",i.CIcon=n.Close[t].OverallStatusArrow=="RedDown"?"k-icon k-i-arrow-down arrow arrow-red":n.Close[t].OverallStatusArrow=="RedStop"?"k-icon k-i-stop arrow-red":n.Close[t].OverallStatusArrow=="GreenStop"?"k-icon k-i-stop arrow-green":n.Close[t].OverallStatusArrow=="GreenUp"?"k-icon k-i-arrow-up arrow arrow-green":n.Close[t].OverallStatusArrow=="YellowStop"?"k-icon k-i-stop arrow-yellow":n.Close[t].OverallStatusArrow=="YellowUp"?"k-icon k-i-arrow-up arrow arrow-yellow":n.Close[t].OverallStatusArrow=="YellowDown"?"k-icon k-i-arrow-down arrow-yellow":"k-icon k-i-stop arrow-grey",i.CStatus="<span class='k-icon k-i-arrow-60-right'><\/span>"+n.Close[t].ProjStatus):(i.Close="",i.CPhaseName="",i.CDays="",i.CIcon="",i.CStatus=""),n.Track.length>t?(i.Track=n.Track[t].ProjectName.substring(0,60),i.TPhaseName=n.Track[t].CapitalPhaseName,i.TDays=n.Track[t].daysInPhase+" d",i.TIcon=n.Track[t].OverallStatus=="RedDown"?"k-icon k-i-arrow-down arrow arrow-red":n.Track[t].OverallStatus=="RedStop"?"k-icon k-i-stop arrow-red":n.Track[t].OverallStatus=="GreenStop"?"k-icon k-i-stop arrow-green":n.Track[t].OverallStatus=="GreenUp"?"k-icon k-i-arrow-up arrow arrow-green":n.Track[t].OverallStatus=="YellowStop"?"k-icon k-i-stop arrow-yellow":n.Track[t].OverallStatus=="YellowUp"?"k-icon k-i-arrow-up arrow arrow-yellow":n.Track[t].OverallStatus=="YellowDown"?"k-icon k-i-arrow-down arrow-yellow":"k-icon k-i-stop arrow-grey",i.TStatus="<span class='k-icon k-i-arrow-60-right'><\/span>"+n.Track[t].ProjStatus):(i.Track="",i.TPhaseName="",i.TDays="",i.TIcon="",i.TStatus=""),r.push(i);$("#PhGrid").kendoGrid({dataSource:{data:r},columns:[{template:"<div class='row'><div class='col-xs-2 padR0 padL0'><div class='col-xs-12 padL0 padR0'><span class='#= IIcon #'><\/span><\/div><div class='col-xs-12 padL0 padR0'>#= IDays #<\/div><\/div><div class='col-xs-10 padR0 padL0'><div class='col-xs-12 padL0 padR0 gridCellBT'>#= Initiate #<\/div><div class='col-xs-12 padL0 padR0 catPhaseName'>#= IPhaseName #<\/div><div class='col-xs-12 padL0 padR0 catPhaseStatus'>#= IStatus #<\/div><\/div><\/div>",field:"Initiate",title:"Initiate"},{template:"<div class='row'><div class='col-xs-2 padR0 padL0'><div class='col-xs-12 padL0 padR0'><span class='#= DIcon #'><\/span><\/div><div class='col-xs-12 padL0 padR0'>#= DDays #<\/div><\/div><div class='col-xs-10 padR0 padL0'><div class='col-xs-12 padL0 padR0 gridCellBT'>#= Define #<\/div><div class='col-xs-12 padL0 padR0 catPhaseName'>#= DPhaseName #<\/div><div class='col-xs-12 padL0 padR0 catPhaseStatus'>#= DStatus #<\/div><\/div><\/div>",field:"Define",title:"Define"},{template:"<div class='row'><div class='col-xs-2 padR0 padL0'><div class='col-xs-12 padL0 padR0'><span class='#= PIcon #'><\/span><\/div><div class='col-xs-12 padL0 padR0'>#= PDays #<\/div><\/div><div class='col-xs-10 padR0 padL0'><div class='col-xs-12 padL0 padR0 gridCellBT'>#= Plan #<\/div><div class='col-xs-12 padL0 padR0 catPhaseName'>#= PPhaseName #<\/div><div class='col-xs-12 padL0 padR0 catPhaseStatus'>#= PStatus #<\/div><\/div><\/div>",field:"Plan",title:"Plan"},{template:"<div class='row'><div class='col-xs-2 padR0 padL0'><div class='col-xs-12 padL0 padR0'><span class='#= EIcon #'><\/span><\/div><div class='col-xs-12 padL0 padR0'>#= EDays #<\/div><\/div><div class='col-xs-10 padR0 padL0'><div class='col-xs-12 padL0 padR0 gridCellBT'>#= Execute #<\/div><div class='col-xs-12 padL0 padR0 catPhaseName'>#= EPhaseName #<\/div><div class='col-xs-12 padL0 padR0 catPhaseStatus'>#= EStatus #<\/div><\/div><\/div>",field:"Execute",title:"Execute"},{template:"<div class='row'><div class='col-xs-2 padR0 padL0'><div class='col-xs-12 padL0 padR0'><span class='#= CIcon #'><\/span><\/div><div class='col-xs-12 padL0 padR0'>#= CDays #<\/div><\/div><div class='col-xs-10 padR0 padL0'><div class='col-xs-12 padL0 padR0 gridCellBT'>#= Close #<\/div><div class='col-xs-12 padL0 padR0 catPhaseName'>#= CPhaseName #<\/div><div class='col-xs-12 padL0 padR0 catPhaseStatus'>#= CStatus #<\/div><\/div><\/div>",field:"Close",title:"Close"},{template:"<div class='row'><div class='col-xs-2 padR0 padL0'><div class='col-xs-12 padL0 padR0'><span class='#= TIcon #'><\/span><\/div><div class='col-xs-12 padL0 padR0'>#= TDays #<\/div><\/div><div class='col-xs-10 padR0 padL0'><div class='col-xs-12 padL0 padR0 gridCellBT'>#= Track #<\/div><div class='col-xs-12 padL0 padR0 catPhaseName'>#= TPhaseName #<\/div><div class='col-xs-12 padL0 padR0 catPhaseStatus'>#= TStatus #<\/div><\/div><\/div>",field:"Track",title:"Track"}],height:300,sortable:!0,dataBound:function(n){var t=n.sender.content.find("tr"),i=this.wrapper.find(".k-grid-header [data-field=Initiate]").index(),r=n.sender.wrapper.find(".k-grid-header [data-field=Define]").index(),u=n.sender.wrapper.find(".k-grid-header [data-field=Plan]").index(),f=n.sender.wrapper.find(".k-grid-header [data-field=Execute]").index(),e=n.sender.wrapper.find(".k-grid-header [data-field=Close]").index(),o=n.sender.wrapper.find(".k-grid-header [data-field=Track]").index();t.each(function(t,s){var h=n.sender.dataItem(s);h.Initiate&&$(s).children("td:eq("+i+")").addClass("setborder");h.Define&&$(s).children("td:eq("+r+")").addClass("setborder");h.Plan&&$(s).children("td:eq("+u+")").addClass("setborder");h.Execute&&$(s).children("td:eq("+f+")").addClass("setborder");h.Close&&$(s).children("td:eq("+e+")").addClass("setborder");h.Track&&$(s).children("td:eq("+o+")").addClass("setborder")})}});ti=1}u=$("#dialogPhGrid");u.data("kendoWindow").open()}catch(e){hideLoading();s={method:"InitPhaseWindow",exceptionMessage:"message:"+e.message+" stack:"+e.stack,ErrorParameter:o};$.when(f.postDataWCFAsync("WriteErrorLog",s)).then(function(){alert(errormessage)})}hideLoading()}function hu(){var a=$("#portfolioBudgetTabstrip").kendoTabStrip().data("kendoTabStrip"),y=a.select()[0].textContent,r,u,n,h,i,c,l;if(trackEvent("Portfolio center budget tile"),trackEvent("Portfolio center budget/spend tile - "+y),r=e.tileInfo.PreliminaryPeriod>0?!0:!1,displayLoading(),v===0){ci();try{u=col_PortfolioCenter_gridProjectPerformance(r);n=ds_PortfolioCenter_gridProjectPerformance(s);$("#gridProjectPerformance").kendoGrid({dataSource:n,groupable:!1,sortable:!0,columns:u,pageable:!0});v=1}catch(t){hideLoading();i={method:"InitBudgetWindow",exceptionMessage:"message:"+t.message+" stack:"+t.stack,ErrorParameter:o};$.when(f.postDataWCFAsync("WriteErrorLog",i)).then(function(){alert(errormessage)})}}else if(v===1){ci();try{n=ds_PortfolioCenter_gridProjectPerformance(s);h=$("#gridProjectPerformance").data("kendoGrid");n.read();h.setDataSource(n);v=2}catch(t){hideLoading();i={method:"InitBudgetWindow",exceptionMessage:"message:"+t.message+" stack:"+t.stack,ErrorParameter:o};$.when(f.postDataWCFAsync("WriteErrorLog",i)).then(function(){alert(errormessage)})}}c=$("#dialogBudget");c.data("kendoWindow").open();l=$("#portfolioBudgetTabstrip").data("kendoTabStrip");l.select(0);hideLoading()}function ci(){$.when(f.postDataWCFAsync("getBudgetChartData",l)).then(function(n){var t,i,c;try{$("#OKU_Div").show();$("#Local_Div").show();var s=JSON.parse(n),r=s.length>0?s[s.length-1]:0,u=0,e=0;r.BudgetCummTotal>=r.PlanCummTotal?r.BudgetCummTotal>r.ActualForecastCummTotal?(u=r.BudgetCummTotal,e=r.BudgetCummTotalLocal):(u=r.ActualForecastCummTotal,e=r.ActualForecastCummTotalLocal):r.PlanCummTotal>r.ActualForecastCummTotal?(u=r.PlanCummTotal,e=r.PlanCummTotalLocal):(u=r.ActualForecastCummTotal,e=r.ActualForecastCummTotalLocal);t="";u>1e9?t="B":u>1e6?t="M":u>1e3&&(t="K");i="";e>1e9?i="B":e>1e6?i="M":e>1e3&&(i="K");var y=function(n){console.log(1);var i=n.value;if(t===undefined)return kendo.format("{0:N4}",kendo.parseInt(i));if(t.length>0&&t=="B")return kendo.toString(i/1e9,"n4")+t;if(t.length>0&&t=="M")return kendo.toString(i/1e6,"n4")+t;if(t.length>0&&t=="K")return kendo.toString(i/1e3,"n4")+t;if(t.length>0&&t=="")return kendo.toString(i,"n4")+t;kendo.toString(i,"n4")},l=function(n){console.log(1);var i=n.value;return t===undefined?kendo.format("{0:N4}",kendo.parseInt(i)):t.length>0&&t=="B"?kendo.toString(i/1e9,"n4")+t:t.length>0&&t=="M"?kendo.toString(i/1e6,"n4")+t:t.length>0&&t=="K"?kendo.toString(i/1e3,"n4")+t:t.length>0&&t==""?kendo.toString(i,"n4")+t:kendo.toString(i,"n4")},a=function(n){console.log(1);var t=n.value;return i===undefined?kendo.format("{0:N0}",kendo.parseInt(t)):i.length>0&&i=="B"?kendo.toString(t/1e9,"n0")+i:i.length>0&&i=="M"?kendo.toString(t/1e6,"n0")+i:i.length>0&&i=="K"?kendo.toString(t/1e3,"n0")+i:kendo.format("{0:N0}",kendo.parseInt(t))},v=function(n){console.log(1);var t=n.value;return i===undefined?kendo.format("{0:N0}",kendo.parseInt(t)):i.length>0&&i=="B"?kendo.toString(t/1e9,"n0")+i:i.length>0&&i=="M"?kendo.toString(t/1e6,"n0")+i:i.length>0&&i=="K"?kendo.toString(t/1e3,"n0")+i:kendo.format("{0:N0}",kendo.parseInt(t))},p=function(){return LocalCurrencyAbbreviationPortfolio};$("#budgetChart").kendoChart({dataSource:{data:s},legend:{position:"bottom"},yAxis:{title:{text:"OY"}},title:{text:"Fiscal Year CAPEX Performance"},seriesDefaults:{type:"line",labels:{visible:!0,template:l,background:"transparent"}},series:[{name:"Plan Cum. Total",field:"PlanCummTotal",categoryField:"Month",style:"smooth",color:"Blue"},{name:"Current Cum. Total",field:"ActualForecastCummTotal",categoryField:"Month",style:"smooth",color:"Green"}],valueAxis:{title:{text:"OY"}},tooltip:{visible:!0,template:"#= (series.name=='Current Cum. Total'?'Current ':'Plan') #:#= (kendo.toString(value, 'n4').trim())#"},categoryAxis:{majorGridLines:{visible:!1}}});$("#budgetChartLocal").kendoChart({dataSource:{data:s},legend:{position:"bottom"},yAxis:{title:{text:"$K USD"}},title:{text:"Fiscal Year CAPEX Performance"},seriesDefaults:{type:"line",labels:{visible:!0,template:v,background:"transparent"}},series:[{name:"Plan Cum. Total",field:"PlanCummTotalLocal",categoryField:"Month",style:"smooth",color:"Blue"},{name:"Current Cum. Total",field:"ActualForecastCummTotalLocal",categoryField:"Month",style:"smooth",color:"Green"}],valueAxis:{labels:{template:a},title:{text:LocalCurrencyAbbreviationPortfolio}},tooltip:{visible:!0,template:"#= (series.name=='Current Cum. Total'?'Current ':'Plan') #: #=  (kendo.toString(value, 'n0').trim())#"},categoryAxis:{majorGridLines:{visible:!1}}});oi()}catch(h){hideLoading();c={method:"CreateCapexPerformanceChart",exceptionMessage:"message:"+h.message+" stack:"+h.stack,ErrorParameter:o};$.when(f.postDataWCFAsync("WriteErrorLog",c)).then(function(){alert(errormessage)})}})}function cu(){var h=$("#lastThreeMonthTab").kendoTabStrip().data("kendoTabStrip"),c=h.select()[0].textContent,u,f,e,o;if(trackEvent("Portfolio center last three month tile"),trackEvent("Portfolio center last three month tile - "+c),hi(),p==0){ft=s.filter(function(n){return n.Last3MonthsProjectsFinishExecution=="1"});et=s.filter(function(n){return n.Last3MonthsProjectsInitiated=="1"});ot=s.filter(function(n){return n.Last3MonthsProjectCompleted=="1"});st=s.filter(function(n){return n.Last3MonthsProjectOnHold=="1"});var l=col_PortfolioCenter_gridLstThreeMnthsProjFinishExecPopUp(),n=ds_PortfolioCenter_gridLstThreeMnthsProjFinishExecPopUp(ft),a=col_PortfolioCenter_gridLstThreeMnthsProjCompletedPopUp(),t=ds_PortfolioCenter_gridLstThreeMnthsProjCompletedPopUp(ot),v=col_PortfolioCenter_gridLstThreeMnthsProjInitiatedPopUp(),i=ds_PortfolioCenter_gridLstThreeMnthsProjInitiatedPopUp(et),y=col_PortfolioCenter_gridLstThreeMnthsProjHoldPopUp(),r=ds_PortfolioCenter_gridLstThreeMnthsProjHoldPopUp(st);$("#gridLstThreeMnthsProjFinishExecPopUp").kendoGrid({dataSource:n,height:250,groupable:!1,sortable:!0,columns:l});$("#gridLstThreeMnthsProjCompletedPopUp").kendoGrid({dataSource:t,height:250,groupable:!1,sortable:!0,columns:a});$("#gridLstThreeMnthsProjInitiatedPopUp").kendoGrid({dataSource:i,height:250,groupable:!1,sortable:!0,columns:v});$("#gridLstThreeMnthsProjHoldPopUp").kendoGrid({dataSource:r,height:250,groupable:!1,sortable:!0,columns:y});p=1}else if(p==1){ft=s.filter(function(n){return n.Last3MonthsProjectsFinishExecution=="1"});et=s.filter(function(n){return n.Last3MonthsProjectsInitiated=="1"});ot=s.filter(function(n){return n.Last3MonthsProjectCompleted=="1"});st=s.filter(function(n){return n.Last3MonthsProjectOnHold=="1"});var n=ds_PortfolioCenter_gridLstThreeMnthsProjFinishExecPopUp(ft),t=ds_PortfolioCenter_gridLstThreeMnthsProjCompletedPopUp(ot),i=ds_PortfolioCenter_gridLstThreeMnthsProjInitiatedPopUp(et),r=ds_PortfolioCenter_gridLstThreeMnthsProjHoldPopUp(st),w=$("#gridLstThreeMnthsProjFinishExecPopUp").data("kendoGrid");n.read();w.setDataSource(n);u=$("#gridLstThreeMnthsProjCompletedPopUp").data("kendoGrid");t.read();u.setDataSource(t);f=$("#gridLstThreeMnthsProjInitiatedPopUp").data("kendoGrid");i.read();f.setDataSource(i);e=$("#gridLstThreeMnthsProjHoldPopUp").data("kendoGrid");r.read();e.setDataSource(r);p=2}o=$("#dialogLstMnth");o.data("kendoWindow").open()}function lu(){localStorage.selectedPortfolioGridView=Default;localStorage.myKeyFilter=[];localStorage.LocalCnt=null}function au(){displayLoading();console.log("Getting user AD Id");buildNo!=localStorage.buildNo&&(lu(),localStorage.buildNo=buildNo,window.location.href=portfolioCenterpath);$.when(f.getUserAdID()).then(function(n){console.log("Got user AD Id");n!=""&&tu()})}var e=this,at,o;e.tileInfo={};e.buildNo=buildNo;e.releaseDate=releaseDate;e.includeLocal=!1;e.includeDefault=!0;e.includeCapitalReport=!1;e.searchButtonText="Apply";at=!0;e.forecastBulkEdit=!1;e.includeChild=!1;e.OYAbbreviationPortfolio="";o="PortfolioCenterCtrl";e.selectedPeoplefilter=[];e.selectedParentProgramfilter=[];e.selectedProjectStatusfilter=[];e.filterPortfolio=[];e.selectedProjectCapPhasefilter=[];e.selectedProjectOEPhasefilter=[];e.selectedProjectPhasefilter=[];e.objselectedProjectOEPhasefilter=[];e.objselectedProjectCapPhasefilter=[];var vt=[],nt=[],yt=[],tt=[],it=[],li=[],ir=[],b=[],pt=[],rt=!1;e.initProjectCenter=au;e.InitKendoGridPriority=iu;e.InitKendoGridLate=ru;e.InitNextThreeMnth=fu;e.InitPhaseWindow=su;e.InitBudgetWindow=hu;e.InitLstThreeMnthWindow=cu;e.getLocalAttributes=br;e.ApplyFilter=ki;e.bindGridChart=nu;e.clearFilter=gr;e.ExportToExcel=pr;e.SpotDataPowerBI=SpotDataPowerBI;e.UpdateFilter=lt;e.insertReports=yr;e.getGridViewProjects=si;e.getCapexData=ar;e.getExcelBudgetData=vr;e.checkAll=checkAll;e.GetFxRates=lr;e.trackEventFunc=cr;e.ClearAllSort=hr;e.capsProjectTooltipPcr=capsProjectTooltip;e.currencyChange=oi;e.showLocalCur=!1;e.ShowLocalDropDown=!1;e.PortfolioPowerBIReport=PortfolioPowerBIReport;var wt=[],ut=[],bt=[],ft=[],et=[],ot=[],st=[],kt=[],s=[],h="",c="",dt=[],gt=[],ni=[],k=JSON.stringify([]),ai=[],vi=[],y=0,p=0,ti=0,ii=0,ri=0,v=0,w=0,l={};e.mainFilterCount=0;e.parentProgramCount=0;e.LocalVariableCnt=0;var rr=null,ur=null,fr=null,yi=0,ht=!0,ct=0,ui=!1,pi=!1,fi=!1,d=!1,ei=!1,wi=!1,bi=!1,er='<div style="width:1300px; height:22px; overflow-x: scroll; margin-left: auto;" id="scroller"><div style="height:1px"> <\/div><\/div>',or='<div style="width:1300px; height:22px; overflow-x: scroll; margin-left: auto;" id="scrollerCap"><div style="height:1px"> <\/div><\/div>',sr='<div style="width:1300px; height:22px; overflow-x: scroll; margin-left: auto;" id="scrollerLv"><div style="height:1px"> <\/div><\/div>';n.$on("applyFilterFunc",function(){ki("Apply");ci()})}angular.module("SPOTApp").controller("ProjectCenterCtrl",ProjectCenterCtrl);ProjectCenterCtrl.$inject=["$rootScope","$filter","$scope","$http","$q","GETPostService"];